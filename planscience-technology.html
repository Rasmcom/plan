<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مجال العلوم والتقنية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Sakkal Majalla';
            src: local('Sakkal Majalla'),
                 url('https://fonts.cdnfonts.com/s/72921/Sakkal Majalla.woff') format('woff');
        }

        @font-face {
            font-family: 'AL Mohanad';
            src: local('AL Mohanad'),
                 url('https://alfont.net/fonts/a-l-mohanad-340/AL-Mohanad-Light.woff') format('woff');
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f7fafc;
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            border-radius: 8px 8px 0 0;
            background-color: #e2e8f0;
            color: #4a5568;
        }
        .tab-button.active {
            border-color: #38a169;
            background-color: #ffffff;
            color: #2c7a7b;
            font-weight: 700;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 5mm;
            margin: 1cm auto;
            border: 1px #D1D5DB solid;
            border-radius: 5px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        .a4-page main {
            flex-grow: 1;
        }
        .report-label {
            color: #067693;
            background-color: #f0f9ff;
            font-weight: bold;
            padding: 8px;
            border-left: 4px solid #0891b2;
        }
        /* --- تعديل تنسيق الجداول --- */
        .table-bordered th, .table-bordered td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: right;
            vertical-align: top;
            font-size: 0.8rem;
        }
        .table-bordered th {
            background-color: #2c5aa0;
            color: white;
        }
        /* ------------------------- */
        #date-picker-modal .week-grid .day.selected {
            background-color: #0d9488;
            color: white;
            border-color: #0f766e;
        }
        #date-picker-modal .week-grid .day.disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }
        .evaluation-table input[type="radio"], .evaluation-table input[type="checkbox"] {
            transform: scale(1.2);
        }

        .print-header-container, .print-footer-container {
            display: none;
        }

        .gradient-line {
            height: 5px;
            background: linear-gradient(to left, #28a745, #007bff);
            border-radius: 2.5px;
        }

        /* Responsive Styles for Mobile */
        @media screen and (max-width: 768px) {
            .container {
                padding-left: 0;
                padding-right: 0;
            }
            .a4-page {
                width: 100%;
                min-height: 0;
                padding: 16px;
                margin: 0;
                border: none;
                box-shadow: none;
            }
            .no-print, header.no-print {
                padding-left: 1rem;
                padding-right: 1rem;
            }
             h1 {
                font-size: 1.5rem; /* 24px */
            }
            .tab-button {
                font-size: 0.875rem; /* 14px */
                padding: 8px 12px;
            }
            .table-bordered {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            .a4-page .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            .flex-1 {
                 min-width: 0;
            }
            #output-plan footer .grid-cols-2, #output-report footer .grid-cols-2 {
                 grid-template-columns: repeat(1, minmax(0, 1fr));
                 gap: 1rem;
            }
        }

        /* --- PRINT STYLES --- */
        @page {
            size: A4 portrait;
            margin: 0.3cm;
        }

        @media print {
            .no-print {
                display: none !important;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            html, body {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                font-size: 8pt;
            }
            
            .container, .a4-page {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: 100% !important;
                width: 100% !important; 
                margin: 0 !important;
                border: none !important;
                padding: 1cm 5mm;
                page-break-inside: avoid;
                height: auto;
                min-height: 0;
            }
            
            .a4-page main {
                flex-grow: 1;
            }

            .content-section {
                display: none !important;
            }

            .content-section.printable-active {
                display: block !important;
            }
            
            /* --- توحيد تنسيق الجداول للطباعة --- */
            .table-bordered th, .table-bordered td {
                border: 1px solid #ddd !important;
                padding: 4px !important;
                font-size: 8pt;
                white-space: normal;
                word-wrap: break-word;
                vertical-align: top;
            }
            .table-bordered th {
                background-color: #0c7894 !important;
                color: white !important;
            }
            /* ---------------------------------- */

            textarea, input[type="text"] {
                overflow: hidden !important;
                height: auto !important;
                resize: none;
                border: none !important;
                background: transparent !important;
                padding: 0 !important;
                font-size: 8pt !important;
                color: #000 !important;
                font-family: inherit !important;
            }

            .report-label {
                background-color: #f0f9ff !important;
                color: #000 !important;
                border-left: 1px solid #000 !important;
            }

            .print-header-container, .print-footer-container {
                display: block !important;
            }
            
            h2 {
                font-size: 14pt;
                color: #000 !important;
            }
            
            .header img {
                height: 50px !important;
            }

            .image-upload-slot {
                height: 5cm;
                aspect-ratio: auto;
            }
            
            .image-upload-slot img {
                object-fit: contain;
            }
            
            .image-upload-slot:not(.has-image) {
                display: none !important;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-8 pb-4 border-b-2 border-teal-600 no-print">
            <div class="flex items-center gap-4">
                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                <div>
                    <h1 class="text-3xl font-bold text-teal-800">مجال العلوم والتقنية</h1>
                    <p class="text-slate-600">إدارة خطط وتقارير برامج المجال</p>
                </div>
            </div>
        </header>

        <div class="flex justify-center gap-2 mb-8 no-print">
            <button id="tab-btn-plan" class="tab-button active flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                خطة برامج النشاط
            </button>
            <button id="tab-btn-reports" class="tab-button flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 17h20"></path><path d="M6 17v-7a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v7"></path><path d="M12 7V4H8v3"></path><path d="M18 17v-5a2 2 0 0 0-2-2h-4"></path></svg>
                التقارير
            </button>
        </div>

        <main>
            <div id="content-plan" class="content-section active">
                <div id="setup-screen-plan" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <input type="text" id="education-admin" placeholder="الإدارة التعليمية: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                            <input type="text" id="school-name" placeholder="المدرسة: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                        </div>

                        <div class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">1. اختر المنطقة</h3>
                                    <div class="flex gap-3">
                                        <button id="btn-region-other" class="w-full p-3 border rounded-lg transition">باقي المناطق</button>
                                        <button id="btn-region-western" class="w-full p-3 border rounded-lg transition">المنطقة الغربية</button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">2. اختر المرحلة</h3>
                                    <select id="stage-select-plan" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <option value="">-- اختر مرحلة دراسية --</option>
                                        <option value="primary">الابتدائية (الأولية)</option>
                                        <option value="upper-primary">الابتدائية (العليا)</option>
                                        <option value="middle">المتوسطة</option>
                                        <option value="high-2">الثانوية</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">3. اختر البرنامج</h3>
                                <div class="grid grid-cols-1 gap-4">
                                    <select id="program-select-plan" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                        <option value="">-- اختر البرنامج --</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">4. اختر الهدف من البرنامج</h3>
                                <select id="objective-select" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50" disabled>
                                    <option value="">-- اختر الهدف --</option>
                                </select>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">5. حدد تواريخ التنفيذ</h3>
                                    <button id="date-picker-btn" class="w-full p-3 border border-slate-300 rounded-lg text-right text-slate-500 hover:bg-slate-50 transition" disabled>اختر تواريخ الحصص</button>
                                    <div id="program-details-plan" class="border-2 border-teal-100 bg-teal-50/50 p-3 rounded-lg mt-4 text-sm min-h-[60px]"></div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">6. أدخل البيانات الأساسية</h3>
                                    <div class="space-y-4">
                                        <input type="text" id="teacher-name" placeholder="المعلم/ة المنفذ/ة" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="leader-name" placeholder="رائد/ة النشاط: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="director-name" placeholder="مدير/ة المدرسة: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">7. تفاصيل إضافية (مقترحة)</h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <textarea id="additional-achievements" placeholder="الإنجازات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="strengths" placeholder="نقاط القوة" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="difficulties" placeholder="الصعوبات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="remedial-actions" placeholder="الإجراءات العلاجية" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">8. اختيار الخط</h3>
                                <select id="font-select" class="w-full p-3 border border-slate-300 rounded-lg">
                                    <option value="Tajawal">الخط الافتراضي (Tajawal)</option>
                                    <option value="Sakkal Majalla">Sakkal Majalla</option>
                                    <option value="AL Mohanad">AL Mohanad</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-10 text-center flex gap-4">
                            <button id="generate-plan-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg">إعداد الخطة للطباعة</button>
                             <button id="reset-plan-btn" class="w-auto bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition">إعادة تعيين</button>
                        </div>
                    </div>
                </div>

                <div id="output-plan" class="hidden">
                    <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-plan')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة الخطة</button>
                        <button onclick="document.getElementById('output-plan').classList.add('hidden'); document.getElementById('setup-screen-plan').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page">
                        <header class="mb-4">
                            <div class="flex justify-between items-center pb-2">
                                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                                <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                     <p id="report-education-admin-plan" class="font-bold"></p>
                                     <p id="report-school-name-plan" class="font-bold"></p>
                                </div>
                            </div>
                            <div class="gradient-line mt-2"></div>
                            <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">خطة تنفيذ برنامج النشاط الطلابي</h2>
                        </header>
                        <main>
                            <table class="w-full mb-4 text-sm border-collapse">
                                <tbody>
                                    <tr>
                                        <td class="report-label w-1/5">اسم البرنامج:</td>
                                        <td class="p-0 border border-slate-200 w-3/10"><textarea id="report-program-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label w-1/5">تفاصيل البرنامج:</td>
                                        <td class="p-0 border border-slate-200 w-3/10"><textarea id="report-program-details-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">الهدف من البرنامج:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-objective-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">الفئة المستهدفة:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-program-target-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">المعلم/ة المنفذ/ة:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-teacher-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">مدة التنفيذ:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-duration-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">مكان التنفيذ:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line"><textarea id="report-location-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">أدوات التنفيذ:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line"><textarea id="report-tools-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label align-top">نواتج التعلم:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3"><textarea id="report-learning-outcomes-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label w-1/4">أساليب التقويم:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3"><textarea id="report-assessment-methods-plan" class="w-full border-none p-2 resize-none" rows="2"></textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w-full table-bordered mb-6">
                                <thead class="bg-teal-50 font-bold">
                                    <tr><th class="w-[15%]">الأسبوع</th><th class="w-[20%]">التاريخ</th><th class="w-[20%]">عنوان الحصة</th><th class="w-[30%]">المحتوى والإجراءات</th><th class="w-[15%]">الحالة</th></tr>
                                </thead>
                                <tbody id="plan-table-body"></tbody>
                            </table>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><h4 class="report-label mb-1">الإنجازات</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-additional-achievements-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">نقاط القوة</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-strengths-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">الصعوبات</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-difficulties-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">الإجراءات العلاجية</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-remedial-actions-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                            </div>
                        </main>
                        <footer class="pt-8 text-center text-xs">
                            <div class="gradient-line mb-4"></div>
                            <div class="grid grid-cols-2 gap-16">
                                <div class="pt-2 mt-2"><p id="report-leader-name-plan" class="font-bold h-6"></p></div>
                                <div class="pt-2 mt-2"><p id="report-director-name-plan" class="font-bold h-6"></p></div>
                            </div>

                        </footer>
                    </div>
                </div>
            </div>

            <div id="content-reports" class="content-section">
                <div id="setup-screen-reports" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <h2 class="text-2xl font-bold text-teal-800 mb-6">إعداد تقرير برنامج النشاط</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <select id="stage-select-reports" class="w-full p-3 border border-slate-300 rounded-lg">
                                 <option value="">-- اختر المرحلة الدراسية --</option>
                            </select>
                            <select id="program-select-reports" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                <option value="">-- اختر البرنامج --</option>
                            </select>
                        </div>
                        <div id="report-dates-display" class="mt-4 text-center text-slate-600 bg-slate-100 p-3 rounded-lg">اختر مرحلة وبرنامج لعرض التواريخ</div>
                         <div class="mt-6 text-center">
                            <button id="generate-report-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg" disabled>إنشاء نموذج التقرير</button>
                        </div>
                    </div>
                </div>
                <div id="output-report" class="hidden">
                     <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-report')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة التقرير</button>
                        <button onclick="document.getElementById('output-report').classList.add('hidden'); document.getElementById('setup-screen-reports').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page" id="report-page-content">
                        </div>
                </div>
            </div>

        </main>
    </div>
<footer class="text-center py-6 mt-12 border-t border-slate-200 no-print">
    <a href="https://www.rasmcom.com" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-3 text-sm text-gray-600 hover:text-teal-700 transition" style="text-decoration: none;">
        <img src="https://e.top4top.io/p_3463x5tj40.png" alt="شعار رسم" class="h-10 w-auto" style="height: 2.5rem; width: auto; border: none;">
        <span>جميع الحقوق محفوظة لقناة رسم للتصميم والخدمات التعليمية 2025</span>
    </a>
</footer>
    <div id="date-picker-modal" class="fixed inset-0 z-50 items-center justify-center p-4 bg-black bg-opacity-50 hidden no-print">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full">
            <h3 id="modal-title" class="text-xl font-bold mb-4">اختر تواريخ التنفيذ</h3>
            <div id="modal-weeks-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeDatePicker()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">إلغاء</button>
                <button onclick="saveDates()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">حفظ التواريخ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const programDefinitions = {
                'science_tech': {
                    field: "العلوم والتقنية",
                    programs: {
                        'iot_challenge': "برنامج تحدي إنترنت الأشياء",
                        'ai_program': "برنامج الذكاء الاصطناعي",
                        'sci_tech_designs': "برنامج التصاميم العلمية التقنية",
                        'stem_apps': "برنامج تطبيقات STEAM",
                        'future_space_pioneers': "برنامج رواد فضاء المستقبل",
                        'future_cities': "برنامج مدن المستقبل"
                    }
                }
            };
            
            let fieldsData = {};

            fieldsData.iot_challenge = {
                name: "برنامج تحدي إنترنت الأشياء",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج تحدي إنترنت الأشياء – الصفوف الأولية", sessions: 3, duration: "135 دقيقة (3 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات بسيطة، صور، فيديو",
                        learningOutcomes: "• التمييز بين استخدامات جهازين ذكيين شائعين في بيئته.\n• التعبير عن فكرة «المنزل الذكي».\n• مناقشة فائدة تطبيق تقني واحد في حياته اليومية.\n• المشاركة في تصميم نموذج ذكي ضمن مجموعة صغيرة.\n• المشاركة في تحدٍ صفي مبسط.",
                        assessmentMethods: "الملاحظة، المشاركة الصفية",
                        details: [
                            { title: "ما هي الأجهزة الذكية؟", content: "تهيئة بنقاش مبسط: من يستخدم جهازًا ذكيًا؟ – عرض صور لأجهزة (هاتف – ساعة – تابلت) – توضيح مفهوم \"المنزل الذكي\" – نشاط جماعي: يرسم الطالب جهازًا يعرفه ويقول فائدته." },
                            { title: "فكرة المنزل الذكي", content: "عرض فيديو قصير عن بيت ذكي – تقسيم الطلاب مجموعات (مطبخ – غرفة – حديقة) – كل مجموعة تقترح جهازًا ذكيًا مفيدًا – مناقشة الفوائد (توفير طاقة – راحة – أمان)." },
                            { title: "نموذج منزل ذكي مبسط", content: "نشاط عملي: تصميم منزل بسيط بالورق/المكعبات – إضافة عنصر ذكي (مصباح – حساس حركة – مروحة) – كل مجموعة تعرض مجسمها وتشرح الفكرة بكلمات بسيطة." }
                        ],
                        strengths: "تفاعل الطلاب مع مفهوم التكنولوجيا الحديثة.", difficulties: "الحاجة إلى تبسيط المفاهيم التقنية.", achievements: "تصميم الطلاب لنماذج مبتكرة للمنازل الذكية.", remedial_actions: "استخدام المزيد من الوسائل البصرية والأمثلة الملموسة."
                    },
                    'upper-primary': {
                        name: "برنامج تحدي إنترنت الأشياء – الصفوف العليا", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف العليا", location: "معمل الحاسب/نادي العلوم", tools: "مجسمات، أدوات بناء",
                        learningOutcomes: "• مناقشة فكرتين جديدتين لتطوير المنزل الذكي.\n• تحديد وظيفة ثلاثة أجهزة ذكية في مجسم.\n• تطبيق مفهومين أساسيين في الكهرباء أو التقنية.\n• تحليل أدوار الأجهزة الذكية في نموذج منزله.\n• عرض مشروعه في فعالية مدرسية.\n• المشاركة بفكرته في منافسة مدرسية.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                           { title: "مقدمة إلى إنترنت الأشياء", content: "تهيئة: نقاش \"ماذا لو كان كل جهاز في بيتك متصلاً بالإنترنت؟\" – عرض فيديو قصير – توضيح الفكرة بمثال (المصباح الذكي)." },
                           { title: "التعرف على الأجهزة الذكية", content: "عرض صور/مجسمات لأجهزة ذكية (الثلاجة – الكاميرا – المكيف) – نشاط مجموعات: يختار كل فريق جهازًا ويشرح فائدته." },
                           { title: "تطبيق عملي: تصميم فكرة", content: "نشاط عملي: كل مجموعة ترسم مخطط غرفة ذكية وتحدد 3 أجهزة ذكية بداخلها – نقاش حول كيف تساعد الأجهزة في الراحة/الأمان/توفير الطاقة." },
                           { title: "عرض المشاريع الصغيرة", content: "كل مجموعة تعرض فكرتها (مخطط أو مجسم ورقي) – مناقشة مع المعلم وزملائهم – تعزيز مفهوم الإبداع والعمل التعاوني." }
                        ],
                        strengths: "قدرة الطلاب على الربط بين المفاهيم النظرية والتطبيق العملي.", difficulties: "توفير الأدوات والمكونات الإلكترونية اللازمة.", achievements: "بناء نماذج عملية للمنازل الذكية.", remedial_actions: "البحث عن بدائل منخفضة التكلفة للمكونات الإلكترونية."
                    },
                    'middle': {
                        name: "برنامج تحدي إنترنت الأشياء – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب", tools: "أدوات برمجة، حساسات",
                        learningOutcomes: "• مناقشة أثر تقنيات المنزل الذكي في تقليل استهلاك الطاقة.\n• تصميم نموذج أولي لمنزل ذكي.\n• تحليل الظاهرة التقنية التي يتحكم بها مشروعه.\n• تطبيق مهارات رياضية وعلمية في برمجة جهاز ذكي.\n• عرض مشروعه ضمن مسابقة مدرسية.\n• المشاركة في فعالية محلية وكتابة تقرير.",
                        assessmentMethods: "تقييم النماذج الأولية، تقارير المشاريع",
                        details: [
                            { title: "ما هو إنترنت الأشياء؟", content: "تهيئة: عصف ذهني \"كيف تتواصل الأجهزة مع بعضها؟\" – عرض فيديو قصير – نقاش مبسط حول تعريف إنترنت الأشياء." },
                            { title: "أمثلة من حياتنا اليومية", content: "عرض صور/مقاطع عن أجهزة ذكية (السيارات – البيوت الذكية – الأجهزة الطبية) – نشاط مجموعات: استخراج فوائد ومخاطر." },
                            { title: "المستشعرات ودورها", content: "توضيح مفهوم المستشعرات – تجربة مبسطة (مستشعر حركة/ضوء إن أمكن أو عبر محاكاة) – نقاش كيف تساعد المستشعرات في جعل الأجهزة \"أذكى\"." },
                            { title: "تطبيق عملي مصغر", content: "نشاط جماعي: تصميم مخطط بيت ذكي يضم 4 أجهزة – يوضح كل فريق وظيفة جهاز واحد وأثره في توفير الوقت/الطاقة." },
                            { title: "تحديات إنترنت الأشياء", content: "مناقشة مشكلات مثل (الخصوصية – الأمان – الأعطال) – نشاط صفّي: \"لو كنت مصمم مدينة ذكية، كيف تحمي المعلومات؟\"." },
                            { title: "تصميم مشروع جماعي", content: "مجموعات الطلاب تضع فكرة مشروع (مثل حديقة ذكية – صف ذكي – غرفة نوم ذكية) – رسم مخطط أو تصميم أولي باستخدام أدوات ورقية/رقمية." },
                            { title: "عرض المشاريع والتقييم", content: "كل مجموعة تعرض مشروعها أمام الصف – مناقشة إيجابيات الأفكار – التقييم وفق معايير (الإبداع – الفائدة – التعاون)." }
                        ],
                        strengths: "قدرة الطلاب على التعامل مع البرمجة البسيطة.", difficulties: "فهم المفاهيم البرمجية المتقدمة.", achievements: "برمجة سلوكيات معقدة للأجهزة الذكية.", remedial_actions: "توفير ورش عمل إضافية في البرمجة."
                    },
                    'high-2': {
                        name: "برنامج تحدي إنترنت الأشياء – المرحلة الثانوية", sessions: 9, duration: "405 دقيقة (9 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/قاعة النشاط", tools: "عتاد مفتوح المصدر, أدوات برمجة",
                        learningOutcomes: "• عرض مشكلة محلية واقتراح حل تقني يعتمد على إنترنت الأشياء.\n• توظيف خطوات البحث العلمي في اقتراح حل.\n• تحليل أثر الحل التقني المقترح على جودة الحياة.\n• تطوير نموذج أولي باستخدام أدوات برمجة وعتاد مفتوح المصدر.\n• إظهار مهارات التفكير النقدي والقيادة ضمن فريق العمل.\n• المشاركة في مسابقة علمية أو تقنية.",
                        assessmentMethods: "تقييم المشاريع، البحث العلمي",
                        details: [
                           { title: "مقدمة في إنترنت الأشياء", content: "تهيئة: أسئلة نقاشية (كيف سيكون العالم بلا أجهزة ذكية؟) – تعريف المفهوم – عرض فيديو قصير يلخص الفكرة." },
                           { title: "بنية إنترنت الأشياء", content: "شرح عناصر النظام (المستشعرات – الاتصال – معالجة البيانات – التطبيق) – رسم مخطط مبسط يوضح العلاقة بينها." },
                           { title: "التطبيقات الواقعية لإنترنت الأشياء", content: "استعراض أمثلة محلية وعالمية (مدن ذكية – الصحة – الصناعة – البيئة) – نقاش جماعي حول الفوائد لكل مجال." },
                           { title: "التحديات التقنية والأمنية", content: "عرض مشكلات الأمان والخصوصية – دراسة حالة (اختراق أجهزة ذكية) – نشاط: اقتراح حلول عملية." },
                           { title: "الربط مع الذكاء الاصطناعي والبيانات", content: "توضيح كيف يدعم الذكاء الاصطناعي إنترنت الأشياء – تجربة مبسطة عبر منصة محاكاة أو فيديو توضيحي." },
                           { title: "ورشة تصميم مشروع أولي", content: "تقسيم الطلاب لمجموعات – اختيار فكرة (مثل مستشفى ذكي/مزرعة ذكية) – إعداد مخطط أولي للأجهزة والمستشعرات." },
                           { title: "تطوير المشروع", content: "تدريب على استخدام أدوات رقمية (تصميم/محاكاة) – كل فريق يضيف تفاصيل (مصدر الطاقة – آلية الاتصال – الأمان)." },
                           { title: "العرض التجريبي", content: "المجموعات تعرض النسخة الأولية لمشاريعها – تبادل التغذية الراجعة – تحسين التصميم وفق الملاحظات." },
                           { title: "العرض النهائي والتقييم", content: "تقديم المشاريع أمام لجنة/زملاء – مناقشة الأسلوب العلمي والتقني – التقييم وفق معايير (الابتكار – الجدوى – العمل الجماعي)." }
                        ],
                        strengths: "قدرة الطلاب على البحث العلمي وتطوير حلول مبتكرة.", difficulties: "الحاجة إلى دعم تقني متخصص.", achievements: "تطوير حلول تقنية لمشكلات واقعية.", remedial_actions: "التواصل مع خبراء في مجال إنترنت الأشياء."
                    }
                }
            };
            
            fieldsData.ai_program = {
                name: "برنامج الذكاء الاصطناعي",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج الذكاء الاصطناعي – الصفوف الأولية", sessions: 10, duration: "450 دقيقة (10 حصص)", target: "الصفوف الأولية", location: "معمل الحاسب", tools: "مساعد صوتي، صور",
                        learningOutcomes: "• معرفة المفاهيم الأساسية للذكاء الاصطناعي.\n• التمييز بين البرمجة التقليدية والذكاء الاصطناعي.\n• الربط بين الحواس البشرية ومدخلات الذكاء الاصطناعي.\n• استخدام أداة مبنية على الذكاء الاصطناعي.\n• تطبيق خوارزميات بسيطة.\n• إدراك أهمية الاستخدام الأخلاقي.",
                        assessmentMethods: "الملاحظة، المشاركة",
                        details: [
                            { title: "ما هو الذكاء الاصطناعي؟", content: "تهيئة بنقاش مبسط حول الفرق بين الحاسب والإنسان – عرض فيديو قصير يوضح مفهوم الذكاء الاصطناعي – نشاط جماعي: تصنيف صور \"أشياء ذكية/غير ذكية\"." },
                            { title: "استخدامات الذكاء الاصطناعي في حياتنا", content: "عرض أمثلة (سيري – أليكسا – خرائط جوجل) – مناقشة كيف تساعد هذه الأدوات – نشاط تلوين/رسم جهاز ذكي." },
                            { title: "كيف يفكر الذكاء الاصطناعي؟", content: "شرح مبسط للفكرة (يتعلم من البيانات) – تجربة صفية: لعبة \"إذا/فإن\" (إذا سمعت تصفيقًا → ارفع يدك) – ربطها بالخوارزميات." },
                            { title: "الذكاء الاصطناعي والحواس", content: "مناقشة حواس الإنسان – عرض كيف يستخدم الذكاء الاصطناعي الكاميرا والمايكروفون – نشاط صفّي: تقليد الروبوت في \"التعرف على الصوت/الصورة\"." },
                            { title: "الروبوتات الذكية", content: "عرض صور وفيديو لروبوتات – نقاش حول وظائفها – نشاط عملي: بناء روبوت ورقي أو باستخدام مكعبات." },
                            { title: "الذكاء الاصطناعي في الألعاب", content: "تشغيل لعبة بسيطة بالذكاء الاصطناعي – مناقشة كيف يتفاعل الحاسب مع اللاعب – نشاط جماعي: لعبة تحديات \"من الأسرع؟\"." },
                            { title: "الخوارزميات المبسطة", content: "شرح مبسط لمفهوم الخطوات – نشاط عملي: \"كيف نصنع شطيرة؟\" بترتيب الخطوات – ربطها بعمل الذكاء الاصطناعي." },
                            { title: "الاستخدام الآمن للذكاء الاصطناعي", content: "مناقشة أهمية إشراف الأهل والمعلم – عرض فيديو قصير عن الخصوصية – نشاط: كتابة/رسم قاعدة واحدة للأمان." },
                            { title: "مشروع مصغر – أداة ذكية", content: "تقسيم الطلاب لمجموعات – تصميم فكرة أداة ذكية (رسم/نمذجة بسيطة) – مناقشة فائدتها للحياة اليومية." },
                            { title: "عرض المشاريع والتقييم", content: "تقديم المجموعات لمشاريعها – مشاركة زملائهم بالتعليق – توزيع شهادات/ملصقات تحفيزية." }
                        ],
                        strengths: "اهتمام الطلاب بموضوع الذكاء الاصطناعي.", difficulties: "شرح المفاهيم المجردة.", achievements: "فهم الطلاب للمفاهيم الأساسية للذكاء الاصطناعي.", remedial_actions: "استخدام الألعاب والأنشطة التفاعلية."
                    },
                    'upper-primary': {
                        name: "برنامج الذكاء الاصطناعي – الصفوف العليا", sessions: 10, duration: "450 دقيقة (10 حصص)", target: "الصفوف العليا", location: "معمل الحاسب", tools: "منصة Teachable Machine",
                        learningOutcomes: "• شرح مفاهيم الذكاء الاصطناعي وتعلم الآلة.\n• التمييز بين طرق تمثيل البيانات.\n• تطبيق خطوات التدريب والتوقع.\n• تصميم نظام تصنيف مبسط.\n• احترام الخصوصية وحقوق البيانات.\n• ملاحظة أخطاء النتائج وتبعاتها.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "ما هو الذكاء الاصطناعي وتعلم الآلة؟", content: "نقاش مبسط حول الفرق بين البرمجة العادية والذكاء الاصطناعي – فيديو تعريفي – نشاط تصنيف: \"أوامر ثابتة\" vs \"ذكاء يتعلم\"." },
                            { title: "تمثيل البيانات", content: "شرح كيف يرى الحاسب الصور (بكسلات) – تجربة عملية: رسم نفس الصورة بمربعات – مناقشة الفكرة." },
                            { title: "الذكاء الاصطناعي والبيانات", content: "عرض أمثلة (التعرف على الوجه/الصوت) – نشاط جماعي: تصنيف صور بسيطة – نقاش أهمية البيانات." },
                            { title: "خطوات تعلم الآلة", content: "عرض ٣ خطوات: تدريب – اختبار – توقع – نشاط صفّي باستخدام لعبة (مثال: بطاقات فواكه)." },
                            { title: "مشروع مبسط للتصنيف", content: "تكوين مجموعات – جمع صور مرسومة/مكتوبة – تدريب يدوي لتصنيف (تفاح/موز) – نقاش النتائج." },
                            { title: "أهمية تمثيل البيانات الصحيح", content: "نشاط جماعي: إعطاء تعليمات خاطئة/ناقصة للزميل – ملاحظة النتيجة – ربطها بالذكاء الاصطناعي." },
                            { title: "أخطاء الذكاء الاصطناعي", content: "عرض فيديو قصير عن أخطاء الذكاء الاصطناعي (مثل خطأ التعرف على صور) – نقاش تبعاتها." },
                            { title: "قضايا الخصوصية والحقوق", content: "مناقشة ما يجوز وما لا يجوز مشاركته – نشاط: ورشة صغيرة \"قواعد الخصوصية\"." },
                            { title: "مشروع مصغر – نظام تصنيف", content: "المجموعات تنفذ تصنيف مبسط (صور/بطاقات/أصوات) – توثيق النتائج." },
                            { title: "عرض المشاريع والتقييم", content: "تقديم المجموعات لمشاريعها – مشاركة زملائهم بالتعليق – توزيع شهادات/ملصقات تحفيزية." }
                        ],
                        strengths: "قدرة الطلاب على فهم مفاهيم تعلم الآلة.", difficulties: "التعامل مع البيانات وتحضيرها.", achievements: "بناء نماذج تصنيف بسيطة.", remedial_actions: "التركيز على مشاريع عملية ومبسطة."
                    },
                    'middle': {
                        name: "برنامج الذكاء الاصطناعي – المرحلة المتوسطة", sessions: 10, duration: "450 دقيقة (10 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب", tools: "أدوات برمجية، روبوتات بسيطة",
                        learningOutcomes: "• معرفة استراتيجيات تعلم الآلة.\n• وصف خوارزميات البحث وإيجاد المسار الأفضل.\n• استخدام منصات تدريب النماذج.\n• تطبيق خطوات التدريب وحساب الدقة.\n• مناقشة التحديات والأخلاقيات.",
                        assessmentMethods: "تقييم المشاريع، عروض تقديمية",
                        details: [
                            { title: "مقدمة عن استراتيجيات تعلم الآلة", content: "عرض أمثلة تطبيقية – نقاش كيف يتعلم الحاسب من الأخطاء." },
                            { title: "خوارزميات البحث", content: "شرح مبسط لخوارزمية البحث (المسار الأقصر) – نشاط ورقي: متاهة + إيجاد المسار." },
                            { title: "استخدامات الذكاء الاصطناعي", content: "نقاش حول المجالات (الصحة – النقل – التعليم) – عصف ذهني حول التحديات." },
                            { title: "تدريب نموذج بسيط", content: "تطبيق تدريبي (منصة تجريبية مبسطة) – تدريب نموذج على بيانات أرقام أو صور." },
                            { title: "تقييم النموذج", content: "شرح دقة النموذج – تطبيق حساب نسبة نجاح التجربة – مقارنة النتائج." },
                            { title: "التمثيل البياني للخوارزميات", content: "نشاط رسم مخطط خطوات لحل مشكلة (مثال: اختيار وجبة)." },
                            { title: "مشكلة ضعف البيانات", content: "نقاش حول مثال عملي – نشاط جماعي: مقارنة بيانات قليلة vs كثيرة." },
                            { title: "الذكاء الاصطناعي القابل للشرح", content: "مناقشة لماذا يجب أن نفهم قرارات الذكاء الاصطناعي – نشاط: \"اشرح قرارك\"." },
                            { title: "مشروع مصغر", content: "إعداد نموذج أو مخطط يوضح فكرة توظيف الذكاء الاصطناعي لحل مشكلة بسيطة." },
                            { title: "عرض المشاريع والتقييم", content: "العروض الجماعية – نقاش مفتوح – تقييم الأداء." }
                        ],
                        strengths: "قدرة الطلاب على تصميم حلول تقنية.", difficulties: "تطبيق الخوارزميات المعقدة.", achievements: "تصميم وتنفيذ حلول بسيطة لمشكلات واقعية.", remedial_actions: "البدء بمشاريع موجهة وتوفير الدعم المستمر."
                    },
                    'high-2': {
                        name: "برنامج الذكاء الاصطناعي – المرحلة الثانوية", sessions: 10, duration: "450 دقيقة (10 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب", tools: "مصادر بحث، أدوات برمجية",
                        learningOutcomes: "• توضيح مجالات الذكاء الاصطناعي وتطبيقاته.\n• مناقشة إمكاناته وتحدياته.\n• تصميم برنامج بسيط بخوارزمية ذكاء اصطناعي.\n• تقييم جودة النماذج بمبادئ رياضية/إحصائية.\n• البحث في مصادر موثوقة.\n• المشاركة في مسابقات علمية.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "مجالات الذكاء الاصطناعي", content: "عرض تقديمي – نقاش أمثلة من السعودية والعالم." },
                            { title: "ارتباط الذكاء الاصطناعي بالمجالات الأخرى", content: "مناقشة علاقته بالرياضيات والعلوم – نشاط تطبيقي صغير." },
                            { title: "تحديات الذكاء الاصطناعي", content: "نقاش مفتوح حول التحديات – كتابة ورقة قصيرة." },
                            { title: "خوارزميات الذكاء الاصطناعي", content: "شرح مبسط لخوارزمية تصنيف/تجميع – نشاط تطبيقي باستخدام بيانات بسيطة." },
                            { title: "تصميم برنامج مبسط", content: "تدريب على استخدام منصة تجريبية – تصميم نموذج ذكاء اصطناعي مصغر." },
                            { title: "تقييم النماذج", content: "تطبيق مبادئ رياضية وإحصائية لحساب دقة نموذج – مناقشة النتائج." },
                            { title: "البحث والتقصي", content: "الطلاب يبحثون عن أحدث استخدامات الذكاء الاصطناعي – إعداد ملخص قصير." },
                            { title: "الذكاء الاصطناعي والأخلاقيات", content: "نقاش جماعي حول قضايا الخصوصية والتحيز – نشاط \"دراسة حالة\"." },
                            { title: "مشروع جماعي", content: "تصميم مشروع مصغر يخدم قضية محلية (مثل الصحة أو المرور) – استخدام أدوات برمجية." },
                            { title: "العروض والتقييم", content: "تقديم المشاريع – أسئلة وأجوبة – تقييم جماعي وفردي." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتحليل.", difficulties: "فهم الجوانب الرياضية والإحصائية.", achievements: "تطوير مشاريع متكاملة وتقديمها في مسابقات.", remedial_actions: "تنظيم ورش عمل متخصصة."
                    }
                }
            };

            fieldsData.sci_tech_designs = {
                name: "برنامج التصاميم العلمية والتقنية",
                field: "العلوم والتقنية",
                 stages: {
                    'primary': {
                        name: "برنامج التصاميم العلمية والتقنية – الصفوف الأولية", sessions: 2, duration: "90 دقيقة (حصتان)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات فنية بسيطة",
                        learningOutcomes: "• التمييز بين مادتين أو أكثر في بناء نموذج.\n• وصف وظيفة أداة تقنية واحدة.\n• رسم صورة لأداة من تصميمه.\n• شرح كيفية استخدام الأشكال أو الأعداد في التصميم.\n• طرح سؤال واحد على الأقل حول كيفية عمل أداة.\n• المشاركة في تصميم نموذج ضمن مجموعة.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات",
                        details: [
                            { title: "أستكشف أدوات من بيئتي", content: "قصص وصور لأدوات يومية بسيطة (مغطس ماء، علبة، عجلة) وربطها بوظائفها؛ فرز مواد (ورق/بلاستيك/خشب) وتجربة “أيها أصلب/أخف” ثم رسم فكرة أداة بسيطة وما مادتها." },
                            { title: "أصمّم أداة وأعرضها", content: "تنفيذ نموذج مبسّط (مثال: ممسك كتاب/حامل قلم) بمواد محلية آمنة؛ تجربة وظيفته وتعديل واحد لتحسين الثبات، توثيق برسم وعنوان، وعرض شفهي قصير أمام الزملاء." }
                        ],
                        strengths: "إبداع الطلاب في تصميم أدوات جديدة.", difficulties: "ربط التصميم بالوظيفة بشكل دقيق.", achievements: "فهم الطلاب للعلاقة بين المواد والأدوات.", remedial_actions: "عرض المزيد من الأمثلة العملية."
                    },
                    'upper-primary': {
                        name: "برنامج التصاميم العلمية والتقنية – الصفوف العليا", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "الصفوف العليا", location: "معمل العلوم", tools: "أدوات بناء بسيطة",
                        learningOutcomes: "• وصف تصميم أداة تقنية بسيطة.\n• الربط بين الأداة المصممة ومشكلة من واقعه.\n• استخدام قياسات وأشكال هندسية بسيطة.\n• استنتاج العلاقة بين شكل التصميم والوظيفة.\n• المشاركة في مناقشة حول أهمية العلوم والتقنية.\n• إظهار سلوك قيادي أثناء العمل في المجموعة.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "مدخل التصميم الهندسي", content: "تمهيد عن خطوات التصميم (مشكلة–تصور–نموذج–اختبار–تحسين) مع أمثلة محلية؛ اختيار مشكلة بسيطة من الواقع (ترتيب طاولة/حامل جوال) وصياغة هدف قابل للقياس." },
                            { title: "تخطيط وتصميم أولي", content: "رسم تخطيطي يوضّح الأجزاء والمواد وقياسات بسيطة؛ تحديد وظيفة جزء واحد على الأقل وكيف يعمل، ووضع قائمة أدوات وآلية سلامة أثناء التنفيذ." },
                            { title: "نموذج أولي وتجربة", content: "بناء نموذج أولي بمواد متاحة (كرتون/عيدان/مشابك) أو أداة رقمية بسيطة؛ اختبار وظيفة أساسية وتسجيل ملاحظة واحدة عن الأداء (ثبات/سهولة استخدام)." },
                            { title: "تحسين وتوثيق", content: "تنفيذ تعديل مبني على الملاحظة (تقوية مفصل/تغيير مادة)؛ تعبئة بطاقة مشروع قصيرة: المشكلة، الفكرة، المواد، ما تغيّّر ولماذا." },
                            { title: "عرض وتقييم", content: "عرض النماذج في “زاوية تصميمي”؛ أسئلة زملاء مركزة، وتقييم مبسّط بمعايير (وضوح الفكرة–سلامة الاستخدام–تعاون الفريق–تحسن بعد الاختبار)." }
                        ],
                        strengths: "قدرة الطلاب على حل المشكلات.", difficulties: "الحاجة إلى مهارات يدوية دقيقة.", achievements: "بناء نماذج أولية فعالة.", remedial_actions: "توفير تدريب على استخدام الأدوات."
                    },
                    'middle': {
                        name: "برنامج التصاميم العلمية والتقنية – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب/المكتبة", tools: "أدوات برمجية، مصادر بحث",
                        learningOutcomes: "• تحليل مشكلة بيئية أو اجتماعية واقتراح حل تقني.\n• توظيف مصدرين علميين موثوقين لدعم فكرة المشروع.\n• دمج مفاهيم من البرمجة والعلوم والهندسة في التصميم.\n• اقتراح تحسين واحد على الأقل بناءً על الملاحظة.\n• توضيح إسهام المشروع في خدمة المجتمع.\n• عرض النتائج بشكل منظم.",
                        assessmentMethods: "تقييم المشاريع، البحث العلمي",
                        details: [
                            { title: "من المشكلة إلى الفكرة", content: "أمثلة لحلول تقنية تخدم المجتمع/البيئة؛ تكوين فرق، اختيار مشكلة محلية محددة وصياغة فرضية وأهداف قابلة للقياس." },
                            { title: "بحث مدعوم بالمصادر", content: "جمع معلومات من مصدرين موثوقين (كتاب/موقع تعليمي) مع توثيق مبسّط؛ استخراج متطلبات الحل وقيوده ووضع معايير نجاح." },
                            { title: "تصميم الحل", content: "رسم مخطط إنسيابي/تصميمي يوضح آلية العمل، تحديد المدخلات/المخرجات، وخطة مواد وأدوات (ورقية أو رقمية) مع تعليمات سلامة." },
                            { title: "بناء النموذج الأولي", content: "تنفيذ نموذج أولي (فيزيائي أو رقمي) وفق الخطة؛ تحديد بروتوكول اختبار (كم عدد المحاولات؟ ما الذي سيُقاس أو يُلاحظ؟)." },
                            { title: "اختبار وجمع بيانات", content: "إجراء الاختبارات وتسجيل بيانات في جدول بسيط؛ تحليل أولي (متوسط/أفضل نتيجة) وتحديد نقاط القوة والقصور." },
                            { title: "تحسين وتكامل STEM", content: "تطبيق تحسينين على الأقل بناءً على البيانات؛ إبراز التكامل بين العلوم/الرياضيات/التقنية/الهندسة في التعديل." },
                            { title: "عرض مُنظَّم وتقييم", content: "إعداد ملصق/عرض قصير يتضمن المشكلة، الفكرة، البيانات، التحسين؛ تقديم أمام زملاء/لجنة وتلقي تغذية راجعة موثّقة." }
                        ],
                        strengths: "قدرة الطلاب על البحث والتصميم.", difficulties: "دمج البرمجة في المشاريع.", achievements: "تطوير حلول تقنية لمشكلات مجتمعية.", remedial_actions: "تنظيم ورش عمل في البرمجة والتصميم."
                    },
                    'high-2': {
                        name: "برنامج التصاميم العلمية والتقنية – المرحلة الثانوية", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/قاعة النشاط", tools: "منصات برمجة، أدوات عرض",
                        learningOutcomes: "• استعراض نموذجين عالميين لحلول تقنية والمقارنة بينهما.\n• اختيار قضية محلية وتطوير حل تقني مبتكر.\n• توظيف خطوات التصميم الهندسي ومهارات البرمجة.\n• اقتراح تطوير للمشروع بناء على الملاحظات.\n• عرض المشروع يوضح تكامل التخصصات العلمية.\n• تقديم المشروع بثقة أمام لجنة.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                            { title: "إلهام ومفاهيم أساسية", content: "توضيح مفاهيم التقنيات البيئية الحديثة، إعادة التدوير، والنفايات الإلكترونية مع أمثلة تطبيقية؛ اختيار قضية محلية وصياغة مشكلة دقيقة ومؤشرات نجاح." },
                            { title: "تحليل وحلول بديلة", content: "تحديد أصحاب المصلحة والمعايير (الكلفة/الأثر/الاستدامة)؛ توليد 2–3 حلول بديلة واختيار الأفضل عبر مصفوفة قرار." },
                            { title: "تخطيط تقني ونمذجة", content: "إعداد مخطط تشغيلي/نموذج ثلاثي الأبعاد أو مخطط برمجي يوضح آلية العمل؛ خطة موارد وزمن ومخاطر وسلامة." },
                            { title: "تطوير نموذج أولي", content: "بناء Prototype (أدوات برمجة/تصميم رقمي أو مواد فعلية) مع تعريف حالات الاختبار ومقاييس التقييم (وظيفة/اعتمادية/سهولة استخدام)." },
                            { title: "اختبار وتحليل بيانات", content: "تنفيذ اختبارات منهجية، جمع بيانات، إجراء تحليل رياضي/إحصائي مبسّط (متوسط/نسبة تحسن) واستنتاجات مرتبطة بالمعايير." },
                            { title: "تحسين وتوثيق تكاملي", content: "تطبيق تحسينات مبنية على النتائج، وتوثيق التكامل بين العلوم/الرياضيات/الهندسة/التقنية في الحل؛ إعداد ملف مشروع منظّم." },
                            { title: "إعداد العروض", content: "تجهيز عرض احترافي ومراعاة معايير الإلقاء والوقت ولُغة الجسد وجودة الوسائط." },
                            { title: "عرض تجريبي (Rehearsal)", content: "بروفة أمام زملاء مع تغذية راجعة وفق مؤشرات: وضوح/تنظيم/ابتكار/تنفيذ/نتائج." },
                            { title: "معرض/تحكيم ختامي", content: "تنظيم معرض داخلي لعرض نماذج المدن الذكية ومناقشة تأثيرها المستقبلي؛ توثيق نهائي." }
                        ],
                        strengths: "قدرة الطلاب על تطوير حلول مستدامة.", difficulties: "الحاجة إلى دعم فني متخصص.", achievements: "تطوير مشاريع متكاملة للمدن الذكية والمستدامة.", remedial_actions: "التواصل مع خبراء في مجال المدن الذكية."
                    }
                }
            };
            
            fieldsData.future_space_pioneers = {
                name: "برنامج رواد فضاء المستقبل",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة الأولية", sessions: 3, duration: "135 دقيقة (3 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "قصص، صور، أدوات رسم",
                        learningOutcomes: "• التحدث عن رائد فضاء أو عالم بطريقة قصصية.\n• التمييز بين الفضاء والأرض.\n• وصف فكرته في تصميم صاروخ فضائي.\n• التعبير عن الفضول العلمي بسؤال.\n• رسم صاروخ وتوضيح استخدام الأشكال والألوان.\n• المشاركة في تصميم صاروخ ضمن فريق.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات",
                        details: [
                            { title: "التعرف על الفضاء ورواده", content: "عرض فيديو قصير عن الفضاء، مناقشة الفرق بين الأرض والفضاء، نشاط رسم صاروخ مبسط." },
                            { title: "تصميم صاروخ مبسط", content: "استخدام أدوات بسيطة (ورق، ألوان، كرتون) لتصميم صاروخ، مشاركة بالرسم أو التلوين ضمن مجموعات." },
                            { title: "استعراض وتقييم", content: "تقديم كل مجموعة لنموذجها، حوار حول أهمية الفضاء، مشاركة الطلاب بأفكار: ماذا يريد أن يكون لو كان رائد فضاء؟" }
                        ],
                        strengths: "شغف الطلاب بموضوع الفضاء.", difficulties: "تبسيط المفاهيم الفلكية المعقدة.", achievements: "تنمية خيال الطلاب وإبداعهم.", remedial_actions: "استخدام القصص والأفلام الوثائقية المبسطة."
                    },
                    'upper-primary': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة العليا", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "الصفوف العليا", location: "معمل العلوم", tools: "أدوات بناء نماذج",
                        learningOutcomes: "• تمييز ثلاث من خصائص الفضاء.\n• تصميم نموذج مبسط لبدلة أو مركبة فضائية.\n• توظيف أدوات بسيطة ومحلية في التصميم.\n• المشاركة في نشاط تمثيلي بدور رائد فضاء.\n• مناقشة جهود عالم أو مهندس فضاء.\n• التعاون مع الزملاء في تنفيذ تصميم مشترك.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "خصائص الفضاء والرحلات الفضائية", content: "نشاط افتتاحي (مقارنة بين الأرض والفضاء من حيث الجاذبية/الأكسجين/الحرارة) – مشاهدة مقطع قصير عن رحلات الفضاء – مناقشة أهمية الاستكشاف." },
                            { title: "تصميم نموذج مبسط (بدلة أو مركبة)", content: "رسم توضيحي أو استخدام مواد بسيطة لتصميم جزء من مركبة/بدلة فضائية – شرح وظيفة جزء واحد على الأقل – تبادل الأفكار داخل المجموعات." },
                            { title: "ابتكار فكرة باستخدام أدوات محلية", content: "استخدام أدوات متوفرة (ورق، كرتون، عبوات) لتطوير فكرة بدلة/مركبة ذكية – نقاش جماعي حول كيف ساعدهم الخيال في تحسين التصميم." },
                            { title: "حياتي كـرائد فضاء", content: "نشاط تمثيلي: لعب أدوار (رائد فضاء) يصف مهمتين داخل المحطة أو في الفضاء – تبادل الحوار حول الصعوبات اليومية لرائد الفضاء." },
                            { title: "علماء ومهندسو الفضاء", content: "عرض قصير عن عالم أو مهندس فضاء (سعودي أو عالمي) – توضيح أثر إنجازه في تطوير تقنيات الفضاء – نشاط ختامي: تصميم بطاقة شكر/لوحة إنجاز." }
                        ],
                        strengths: "قدرة الطلاب على التصميم والبناء.", difficulties: "توفير مواد متنوعة للبناء.", achievements: "تصميم نماذج مبتكرة للمركبات الفضائية.", remedial_actions: "تشجيع استخدام المواد المعاد تدويرها."
                    },
                    'middle': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل العلوم/المكتبة", tools: "أدوات تجارب، مصادر بحث",
                        learningOutcomes: "• تفسير ظاهرة تقنية مرتبطة بالفضاء.\n• المقارنة بين بيئة الأرض والفضاء.\n• تصميم تجربة مبسطة توضح أثر الجاذبية.\n• تطبيق خطوات البحث العلمي.\n• توضيح العلاقة بين الرياضيات والعلوم.\n• المشاركة في معرض مدرسي أو مسابقة علمية.",
                        assessmentMethods: "تقييم المشاريع، التقارير العلمية",
                        details: [
                            { title: "التعرف على بيئة الفضاء", content: "فيديو عن الفضاء، نقاش حول الفرق بين الأرض والفضاء (الجاذبية، الأكسجين)." },
                            { title: "ظواهر وتقنيات فضائية", content: "شرح مبسط للاتصالات، GPS، التصوير الفضائي، ومخاطر النفايات الفضائية." },
                            { title: "تجربة الطفو والجاذبية", content: "نشاط عملي: قياس الوزن على الأرض وتجربة الطفو في الماء لشرح انعدام الوزن." },
                            { title: "الطاقة في الفضاء", content: "فيديو عن الألواح الشمسية، نشاط رسم لوحة شمسية لمركبة، شرح تحول الطاقة." },
                            { title: "تصميم تجربة علمية", content: "مجموعات تصمم تجربة (نمو نبات في بيئة معزولة)، تسجيل فرضية وخطوات ونتائج." },
                            { title: "الرياضيات والفضاء", content: "قراءة جداول دوران الكواكب، نشاط رياضي (مقارنة طول اليوم في الأرض والمشتري)." },
                            { title: "المعرض العلمي", content: "الطلاب يقدمون مشاريعهم (تجارب – نماذج – عروض) في معرض علمي مبسط داخل الصف." }
                        ],
                        strengths: "قدرة الطلاب על إجراء التجارب والبحث.", difficulties: "فهم المفاهيم الفيزيائية المعقدة.", achievements: "تنفيذ تجارب علمية ناجحة وتقديم تقارير عنها.", remedial_actions: "استخدام برامج المحاكاة لتوضيح المفاهيم."
                    },
                    'high-2': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة الثانوية", sessions: 9, duration: "405 دقيقة (9 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/المكتبة الرقمية", tools: "مصادر بحث، أدوات تصميم",
                        learningOutcomes: "• توظيف مهارات البحث لشرح خصائص بيئة الفضاء.\n• تحديد مشكلة حقيقية واقتراح حل تقني مبتكر.\n• تطبيق مفاهيم من العلوم والتقنية والهندسة في التصميم.\n• تصميم نموذج أولي أو عرض رقمي.\n• المشاركة في منافسة علمية.\n• إظهار مهارات القيادة والتخطيط.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "خصائص الفضاء وتقنياته", content: "فيديو وصور حول بيئة الفضاء، مناقشة تأثيرها על الإنسان والمعدات." },
                            { title: "استكشاف إنجازات", content: "بحث قصير حول عالم أو مهندس فضاء (مثال: كاثرين جونسون – إيلون ماسك)." },
                            { title: "التحديات في الفضاء", content: "نقاش جماعي: نقص الجاذبية – صعوبة الحركة – البعد عن الأرض، كتابة استنتاجات." },
                            { title: "تصميم مشروع أولي", content: "مجموعات تخطط لمشروع (حل لمشكلة تواجه الإنسان في الفضاء)." },
                            { title: "نموذج عملي", content: "تصميم نموذج أولي (Prototype) باستخدام أدوات تصميم أو برامج رقمية." },
                            { title: "التجربة والتوثيق", content: "تطبيق خطوات البحث العلمي في المشروع، وتوثيق رقمي (صور/عروض)." },
                            { title: "الرياضيات في الفضاء", content: "استخدام جداول وقياسات لتوضيح العلاقة بين العلوم والرياضيات." },
                            { title: "عرض أولي للمشاريع", content: "المجموعات تقدم مشاريعها، مع تغذية راجعة من المعلم وزملائهم." },
                            { title: "العرض النهائي والمنافسة", content: "عرض المشاريع بشكل نهائي أمام لجنة مبسطة أو الزملاء، تقييم وفق معايير (ابتكار – تنظيم – أثر)." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتصميم المتقدم.", difficulties: "الحاجة إلى دعم تقني متخصص.", achievements: "تطوير حلول مبتكرة لمشكلات فضائية.", remedial_actions: "التواصل مع خبراء في مجال الفضاء."
                    }
                }
            };
            
            fieldsData.future_cities = {
                name: "برنامج مدن المستقبل",
                field: "العلوم والتقنية",
                 stages: {
                    'primary': {
                        name: "برنامج مدن المستقبل – الصفوف الأولية", sessions: 3, duration: "135 دقيقة (3 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات فنية، أدوات تقنية بسيطة",
                        learningOutcomes: "• مناقشة دور التقنية في تحسين الحياة.\n• تسمية ثلاثة موارد طبيعية في بيئته.\n• رسم نموذج لمدينة المستقبل.\n• استخدام أدوات بسيطة لتصميم أولي لمدينة.\n• المشاركة في بناء مجسم جماعي.\n• عرض مجسمه وشرح حل بسيط لمدينته.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات والمجسمات",
                        details: [
                            { title: "مدينتي اليوم… ومدينتي غدًا", content: "تهيئة مصورة عن المدينة الذكية vs. التقليدية؛ نشاط جماعي لفرز أدوات/مواد بسيطة «ورق/كرتون/بلاستيك» والتحدث عن وظيفة أداة تقنية بلغة سهلة." },
                            { title: "موارد وطاقة نظيفة", content: "قصة مصغّرة عن الشمس/الرياح والادخار في الماء؛ نشاط رسم «شكل أداة» وتوضيح أهمية شكلها في وظيفتها (قص/لصق/تلوين) مع مراعاة السلامة." },
                            { title: "أصمّم ركنًا ذكيًا", content: "تنفيذ مجسّم «زاوية ذكية» (مدرسة/حديقة/مبنى تقني) بأدوار موزعة داخل الفريق، ثم عرض شفهي قصير وملف إنجاز (صورة+سطر عمّا تعلمه)." }
                        ],
                        strengths: "إبداع الطلاب في تخيل مدن المستقبل.", difficulties: "توفير أدوات تقنية بسيطة.", achievements: "بناء مجسمات مبتكرة للمدن الذكية.", remedial_actions: "تشجيع استخدام المواد المعاد تدويرها."
                    },
                    'upper-primary': {
                        name: "برنامج مدن المستقبل – الصفوف العليا", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف العليا", location: "معمل الحاسب/نادي العلوم", tools: "أدوات بناء، برمجيات تصميم",
                        learningOutcomes: "• تحديد ثلاثة موارد طبيعية ووصف دورها.\n• مقارنة تقنية واحدة في المدن الحالية والمستقبلية.\n• الربط بين مفاهيم العلوم والرياضيات والتقنية.\n• تنفيذ تصميم أولي لمدينة ذكية.\n• المشاركة في مناقشة جماعية واقتراح حل مبتكر.\n• عرض مشروعه أمام زملائه.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "مفاهيم مدن المستقبل", content: "مقارنة مبسطة «ذكية/تقليدية» (طاقة، مواصلات، نفايات، مياه) + مشاهدة لمحة عن «ذا لاين»؛ عصف ذهني لموردين طبيعيين وكيف يفيدان المدينة." },
                            { title: "رسم الفكرة وتصميم أولي", content: "اسكتش تخطيطي لحيّ ذكي (سكني/خدمي/تقني) ووسم العناصر؛ تجربة سريعة על أداة رقمية (Tinkercad أو MinecraftEdu) لبناء جزء بسيط." },
                            { title: "نموذج ثلاثي الأبعاد", content: "عمل مجموعي لبناء نموذج ورقي/كرتوني أو رقمي مبسّط مع أدوار واضحة؛ توثيق الخطوات بصور قصيرة." },
                            { title: "عرض وتقويم", content: "عرض الفكرة الرئيسة، وصف الابتكار، وبيان خطوات التنفيذ؛ تغذية راجعة وفق مؤشرات: وضوح الفكرة/تنظيم/ابتكار/نتائج." }
                        ],
                        strengths: "قدرة الطلاب على استخدام برامج التصميم.", difficulties: "الحاجة إلى أجهزة حاسوب بمواصفات جيدة.", achievements: "تصميم نماذج رقمية للمدن الذكية.", remedial_actions: "استخدام برامج تصميم مجانية ومفتوحة المصدر."
                    },
                    'middle': {
                        name: "برنامج مدن المستقبل – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب/المكتبة", tools: "برامج تصميم، وسائل عرض",
                        learningOutcomes: "• إعداد عرض قصير لسيرة عالم تقني.\n• مناقشة أثر استخدام موردين طبيعيين في التصميم.\n• التقييم لتأثير 3 تقنيات ذكية על جودة الحياة.\n• استخدام برنامج تصميم رقمي لرسم نموذج أولي.\n• تقديم مشروع يوظف مفاهيم متعددة.\n• المشاركة في نقد بنّاء وإظهار قيادة.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                            { title: "مدخل ومفاهيم STEM", content: "تقديم مفهوم المدينة الذكية وربط العلوم والرياضيات والهندسة بحلول المرور/الطاقة/المياه؛ نشاط قياس مبسّط (استهلاك/توزيع)." },
                            { title: "استكشاف المشكلة", content: "اختيار مشكلة محلية (ازدحام/نفايات/مياه) وتحديد مؤشرات بسيطة لنجاح الحل؛ جمع بيانات أولية قصيرة." },
                            { title: "أفكار وتصاميم", content: "توليد حلول، رسم خرائط تدفّق/شبكات بسيطة، تحديد مكوّنات ذكية مطلوبة؛ خطة عمل أولية." },
                            { title: "نموذج أولي (1)", content: "بناء جزء من «نموذج مدينة ذكية» بأدوات بسيطة؛ اختبار مبدئي وتدوين ملاحظات التحسين." },
                            { title: "نموذج أولي (2)", content: "تحسين التصميم (تعديل توزيع المرافق أو خفض استهلاك طاقة افتراضيًا) وتوثيق التغييرات." },
                            { title: "محاكاة وعرض رقمي", content: "إعداد عرض تقديمي موجز يشرح الحل والابتكارات والقياسات/الجداول المستخدمة." },
                            { title: "عرض ختامي وتقييم", content: "معرض صفّي/مسابقة مصغّرة لأفضل تصميم؛ تغذية راجعة جماعية ومعايير ابتكار/فعالية/استدامة." }
                        ],
                        strengths: "قدرة الطلاب על التقييم والتحليل.", difficulties: "الحاجة إلى وقت كافٍ لتطوير المشاريع.", achievements: "تقديم عروض متكاملة للمشاريع.", remedial_actions: "تنظيم وقت العمل وتوزيع المهام بشكل فعال."
                    },
                    'high-2': {
                        name: "برنامج مدن المستقبل – المرحلة الثانوية", sessions: 9, duration: "405 دقيقة (9 حصص)", target: "المرحلة الثانوية", location: "معامل الحاسب/قاعات النشاط", tools: "أدوات بناء نماذج، أدوات رقمية",
                        learningOutcomes: "• إعداد عرض تقديمي لسيرة عالم.\n• تحليل مدى توافق تصميم مدينة ذكية مع معايير الاستدامة.\n• تحليل نموذج حقيقي/افتراضي لمدينة ذكية.\n• تطوير نموذج أولي باستخدام أدوات التصميم والبرمجة.\n• إظهار روح التعاون والمسؤولية ضمن فريق.\n• تقديم عرض بحثي أمام لجنة.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "مدن ذكية: رؤى وباحثون", content: "قراءة حالة عن Carlo Ratti ومدن حسّاسة للبيانات؛ نقاش أثر الذكاء الاصطناعي על الحركة/الطاقة/النفايات." },
                            { title: "تحديد المشكلة", content: "اختيار مشكلة حضرية محلية وصياغة سؤال بحث/هدف مشروع ومعايير نجاح قابلة للقياس." },
                            { title: "تصميم الحل", content: "مخطط مشروع (تصميم/أدوات/برمجيات/خطة اختبار) وتقسيم الأدوار داخل الفريق." },
                            { title: "بناء النموذج (1)", content: "إنشاء نموذج أولي (مادي أو رقمي) لعُنصر ذكي في المدينة؛ توثيق الخطوات والصعوبات." },
                            { title: "بناء النموذج (2)", content: "تحسين الخوارزمية/التصميم (مثلاً منطق إشارات ذكية أو إدارة مياه) وإعادة الاختبار." },
                            { title: "تحليل الأثر والاستدامة", content: "تحليل موجز لتوافق الحل مع الاستدامة (طاقة/مياه/نفايات) وكتابة ملخص علمي قصير." },
                            { title: "التحضير للعرض", content: "تجهيز عرض علمي احترافي: مشكلة/حل/نتائج، وضبط اللغة والدقة والوقت." },
                            { title: "عرض تجريبي (Rehearsal)", content: "بروفة أمام زملاء مع تغذية راجعة وفق مؤشرات: وضوح/تنظيم/ابتكار/تنفيذ/نتائج." },
                            { title: "معرض/تحكيم ختامي", content: "تنظيم معرض داخلي لعرض نماذج المدن الذكية ومناقشة تأثيرها المستقبلي؛ توثيق نهائي." }
                        ],
                        strengths: "قدرة الطلاب על تطوير حلول مستدامة.", difficulties: "الحاجة إلى دعم فني متخصص.", achievements: "تطوير مشاريع متكاملة للمدن الذكية والمستدامة.", remedial_actions: "التواصل مع خبراء في مجال المدن الذكية."
                    }
                }
            };
            
            const weeksDataDefault = {
                'week1': { name: 'الأسبوع الأول', days: { 'الأحد': '1 / 3', 'الاثنين': '2 / 3', 'الثلاثاء': '3 / 3', 'الأربعاء': '4 / 3', 'الخميس': '5 / 3' } },
                'week2': { name: 'الأسبوع الثاني', days: { 'الأحد': '8 / 3', 'الاثنين': '9 / 3', 'الثلاثاء': '10 / 3', 'الأربعاء': '11 / 3', 'الخميس': '12 / 3' } },
                'week3': { name: 'الأسبوع الثالث', days: { 'الأحد': '15 / 3', 'الاثنين': '16 / 3', 'الثلاثاء': '17 / 3', 'الأربعاء': '18 / 3', 'الخميس': '19 / 3' } },
                'week4': { name: 'الأسبوع الرابع', days: { 'الأحد': '22 / 3', 'الاثنين': '23 / 3', 'الثلاثاء': '24 / 3', 'الأربعاء': '25 / 3', 'الخميس': '26 / 3' } },
                'week5': { name: 'الأسبوع الخامس', days: { 'الأحد': '29 / 3', 'الاثنين': '30 / 3', 'الثلاثاء': '1 / 4', 'الأربعاء': '2 / 4', 'الخميس': '3 / 4' }, specialDays: { '1 / 4': { name: 'إجازة' } } },
                'week6': { name: 'الأسبوع السادس', days: { 'الأحد': '6 / 4', 'الاثنين': '7 / 4', 'الثلاثاء': '8 / 4', 'الأربعاء': '9 / 4', 'الخميس': '10 / 4' } },
                'week7': { name: 'الأسبوع السابع', days: { 'الأحد': '13 / 4', 'الاثنين': '14 / 4', 'الثلاثاء': '15 / 4', 'الأربعاء': '16 / 4', 'الخميس': '17 / 4' } },
                'week8': { name: 'الأسبوع الثامن', days: { 'الأحد': '20 / 4', 'الاثنين': '21 / 4', 'الثلاثاء': '22 / 4', 'الأربعاء': '23 / 4', 'الخميس': '24 / 4' } },
                'week9': { name: 'الأسبوع التاسع', days: { 'الأحد': '27 / 4', 'الاثنين': '28 / 4', 'الثلاثاء': '29 / 4', 'الأربعاء': '30 / 4', 'الخميس': '1 / 5' } },
                'week10': { name: 'الأسبوع العاشر', days: { 'الأحد': '4 / 5', 'الاثنين': '5 / 5', 'الثلاثاء': '6 / 5', 'الأربعاء': '7 / 5', 'الخميس': '8 / 5' } },
                'week11': { name: 'الأسبوع الحادي عشر', days: { 'الأحد': '11 / 5', 'الاثنين': '12 / 5', 'الثلاثاء': '13 / 5', 'الأربعاء': '14 / 5', 'الخميس': '15 / 5' } },
                'week12': { name: 'الأسبوع الثاني عشر', days: { 'الأحد': '18 / 5', 'الاثنين': '19 / 5', 'الثلاثاء': '20 / 5', 'الأربعاء': '21 / 5', 'الخميس': '22 / 5' } },
                'week13': { name: 'الأسبوع الثالث عشر', days: { 'الأحد': '25 / 5', 'الاثنين': '26 / 5', 'الثلاثاء': '27 / 5', 'الأربعاء': '28 / 5', 'الخميس': '29 / 5' } },
                'week14': { name: 'الأسبوع الرابع عشر', days: { 'الأحد': '9 / 6', 'الاثنين': '10 / 6', 'الثلاثاء': '11 / 6', 'الأربعاء': '12 / 6', 'الخميس': '13 / 6' } },
                'week15': { name: 'الأسبوع الخامس عشر', days: { 'الأحد': '16 / 6', 'الاثنين': '17 / 6', 'الثلاثاء': '18 / 6', 'الأربعاء': '19 / 6', 'الخميس': '20 / 6' }, specialDays: { '20 / 6': { name: 'إجازة إضافية' } } },
                'week16': { name: 'الأسبوع السادس عشر', days: { 'الأحد': '23 / 6', 'الاثنين': '24 / 6', 'الثلاثاء': '25 / 6', 'الأربعاء': '26 / 6', 'الخميس': '27 / 6' }, specialDays: { '23 / 6': { name: 'إجازة إضافية' } } },
                'week17': { name: 'الأسبوع السابع عشر', days: { 'الأحد': '1 / 7', 'الاثنين': '2 / 7', 'الثلاثاء': '3 / 7', 'الأربعاء': '4 / 7', 'الخميس': '5 / 7' } },
                'week18': { name: 'الأسبوع الثامن عشر', days: { 'الأحد': '8 / 7', 'الاثنين': '9 / 7', 'الثلاثاء': '10 / 7', 'الأربعاء': '11 / 7', 'الخميس': '12 / 7' } },
            };
            const weekNames = ['الأول','الثاني','الثالث','الرابع','الخامس','السادس','السابع','الثامن','التاسع','العاشر','الحادي عشر','الثاني عشر', 'الثالث عشر', 'الرابع عشر', 'الخامس عشر', 'السادس عشر', 'السابع عشر', 'الثامن عشر'];
            const weeksDataWestern = Object.fromEntries(Object.entries(weeksDataDefault).slice(1).map(([k, v], i) => [k, {...v, name: `الأسبوع ${weekNames[i]}` }]));
            
            let activeWeeksData = weeksDataDefault;
            let tempSelectedDates = [];
            let state = {};

            const tabButtons = document.querySelectorAll('.tab-button');
            const contentSections = document.querySelectorAll('.content-section');
            const stageSelectPlan = document.getElementById('stage-select-plan');
            const programSelectPlan = document.getElementById('program-select-plan');
            const objectiveSelect = document.getElementById('objective-select');
            const datePickerBtn = document.getElementById('date-picker-btn');
            const stageSelectReports = document.getElementById('stage-select-reports');
            const programSelectReports = document.getElementById('program-select-reports');
            const generateReportBtn = document.getElementById('generate-report-btn');
            const fontSelect = document.getElementById('font-select');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(sec => sec.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.id.replace('tab-btn-', 'content-')).classList.add('active');
                });
            });

            function populateStages(selectElement) {
                const stages = { 'primary': 'الابتدائية (الأولية)', 'upper-primary': 'الابتدائية (العليا)', 'middle': 'المتوسطة', 'high-2': 'الثانوية' };
                selectElement.innerHTML = '<option value="">-- اختر المرحلة الدراسية --</option>';
                for (const key in stages) {
                    selectElement.innerHTML += `<option value="${key}">${stages[key]}</option>`;
                }
            }

            function populateProgramsByStage(stage, programSelectElement, useGenericName = false) {
                programSelectElement.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                programSelectElement.disabled = true;
                if (!stage) return;
                
                Object.entries(fieldsData).forEach(([progKey, progData]) => {
                    if (progData.stages && progData.stages[stage]) {
                        const option = document.createElement('option');
                        option.value = `${progKey}|${stage}`;
                        option.textContent = useGenericName ? progData.name : (progData.stages[stage].name || progData.name);
                        programSelectElement.appendChild(option);
                    }
                });
                programSelectElement.disabled = false;
            }

            function setupPlanTab() {
                stageSelectPlan.addEventListener('change', () => {
                    const stage = stageSelectPlan.value;
                    programSelectPlan.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                    programSelectPlan.disabled = true;
                    objectiveSelect.innerHTML = '<option value="">-- اختر الهدف --</option>';
                    objectiveSelect.disabled = true;

                    if (!stage) {
                        return;
                    }

                    const scienceField = "العلوم والتقنية";
                    Object.entries(fieldsData).forEach(([key, program]) => {
                        if (program.field === scienceField && program.stages[stage]) {
                            programSelectPlan.innerHTML += `<option value="${key}">${program.name}</option>`;
                        }
                    });
                    programSelectPlan.disabled = false;

                    const objectives = { 
                        'تعزيز المدرسة للشراكة المجتمعية': '١- تعزيز المدرسة للشراكة المجتمعية',
                        'دعم الأنشطة الطلابية للسلوك الإيجابي': '٢- دعم الأنشطة الطلابية للسلوك الإيجابي',
                        'تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية': '٣- تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية',
                        'زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة': '٤- زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة',
                        'تعزيز الأنشطة الطلابية للانضباط المدرسي': '٥- تعزيز الأنشطة الطلابية للانضباط المدرسي',
                        'أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين': '٦- أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين',
                        'تحسين الأنشطة الطلابية لنواتج التعلم': '٧- تحسين الأنشطة الطلابية لنواتج التعلم',
                        'اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي': '٨- اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي',
                        'تفعيل المناسبات الوطنية والأسابيع والأيام العالمية': '٩- تفعيل المناسبات الوطنية والأسابيع والأيام العالمية'
                    };
                    for (const [value, text] of Object.entries(objectives)) {
                        objectiveSelect.innerHTML += `<option value="${value}">${text}</option>`;
                    }
                });

                programSelectPlan.addEventListener('change', () => {
                    state.programKey = programSelectPlan.value;
                    state.stage = stageSelectPlan.value;
                    state.planDates = [];
                    updateProgramDisplay();
                });
                 ['btn-region-other', 'btn-region-western'].forEach(id => document.getElementById(id).addEventListener('click', (e) => { state.region = id.includes('other') ? 'other' : 'western'; updateRegionUI(); }));
                datePickerBtn.addEventListener('click', () => openDatePicker());
                document.getElementById('reset-plan-btn').addEventListener('click', () => { if(confirm('هل أنت متأكد؟ سيتم حذف جميع البيانات المدخلة.')) { localStorage.removeItem('planGeneratorState'); location.reload(); }});
                document.getElementById('generate-plan-btn').addEventListener('click', generatePlan);
                fontSelect.addEventListener('change', (e) => {
                    document.body.style.fontFamily = e.target.value;
                    state.fontFamily = e.target.value;
                    saveState();
                });
            }
             function updateProgramDisplay() {
                if (!state.programKey || !state.stage) return;
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                document.getElementById('program-details-plan').innerHTML = `<p><strong class="font-semibold">البرنامج:</strong> ${programData.name}</p><p><strong class="font-semibold">عدد الحصص المقترح:</strong> ${programData.sessions} حصص</p>`;
                objectiveSelect.disabled = false;
                if (programData.duration && (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة"))) {
                    datePickerBtn.disabled = true;
                    datePickerBtn.textContent = 'البرنامج مستمر أو بمدة مرنة';
                    state.planDates = programData.details.map(d => d.date);
                } else {
                    datePickerBtn.disabled = false;
                    updateDatePickerButton();
                }
                ['strengths', 'difficulties', 'remedial_actions', 'achievements'].forEach(key => { 
                    const elementId = key === 'achievements' ? 'additional-achievements' : key.replace('_', '-');
                    const element = document.getElementById(elementId);
                    if (element) element.value = programData[key] || ''; 
                });
            }

            function updateDatePickerButton() {
                if (!state.programKey || !state.stage) { datePickerBtn.textContent = 'اختر تواريخ الحصص'; return; }
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                const count = state.planDates ? state.planDates.filter(d => d !== 'يحدد لاحقًا').length : 0;
                datePickerBtn.textContent = `اختر تواريخ الحصص (${count} / ${programData.sessions})`;
            }

            function setupReportsTab() {
                populateStages(stageSelectReports);
                stageSelectReports.addEventListener('change', () => {
                    populateProgramsByStage(stageSelectReports.value, programSelectReports, true);
                    generateReportBtn.disabled = true;
                    document.getElementById('report-dates-display').textContent = 'اختر مرحلة وبرنامج لعرض التواريخ';
                });
                programSelectReports.addEventListener('change', () => {
                    generateReportBtn.disabled = !programSelectReports.value;
                    const datesDisplay = document.getElementById('report-dates-display');
                    if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                        state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                        const dateRange = `تواريخ الخطة المحددة: من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                        datesDisplay.textContent = dateRange;
                        datesDisplay.classList.remove('text-red-500');
                    } else {
                        datesDisplay.textContent = 'ملاحظة: لم يتم تحديد تواريخ تنفيذ في تبويب الخطة أو أن البرنامج مستمر. سيظهر التاريخ فارغاً في التقرير.';
                        datesDisplay.classList.add('text-red-500');
                    }
                });
                generateReportBtn.addEventListener('click', generateReport);
            }
            
            function generateReport() {
                const [progKey, stageKey] = programSelectReports.value.split('|');
                const programData = fieldsData[progKey].stages[stageKey];
                const leaderName = document.getElementById('leader-name').value;
                const directorName = document.getElementById('director-name').value;
                const educationAdmin = document.getElementById('education-admin').value;
                const schoolName = document.getElementById('school-name').value;

                let dateRange = "لم يتم تحديد التواريخ في الخطة";
                if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                     state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                     dateRange = `من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                } else if (programData.duration && (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة"))) {
                    dateRange = "على مدار العام الدراسي أو بمدة مرنة";
                }
                
                const locationLines = (programData.location.match(/\n/g) || []).length + 1;

                const reportHTML = `
                    <header class="mb-4">
                        <div class="flex justify-between items-center pb-2">
                            <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                            <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                <p class="font-bold">${educationAdmin}</p>
                                <p class="font-bold">${schoolName}</p>
                            </div>
                        </div>
                        <div class="gradient-line mt-2"></div>
                        <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">تقرير تنفيذ برنامج نشاط</h2>
                    </header>
                    <main>
                        <h3 class="text-xl font-bold mb-3 text-teal-700 text-center">${programData.name}</h3>
                        <table class="w-full mb-4 text-sm border-collapse table-bordered">
                            <tbody>
                                <tr><td class="font-bold bg-slate-50 w-1/5">المرحلة:</td><td colspan="3"><textarea id="report-stage-report" class="w-full border-none p-2 resize-none" rows="1">${stageSelectReports.options[stageSelectReports.selectedIndex].text}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">الهدف من البرنامج:</td><td colspan="3"><textarea id="report-objective-report" class="w-full border-none p-2 resize-none" rows="1">${state.objective || 'لم يحدد في الخطة'}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">تاريخ التنفيذ:</td><td><textarea id="report-date-report" class="w-full border-none p-2 resize-none" rows="1">${dateRange}</textarea></td><td class="font-bold bg-slate-50 w-1/5">مكان التنفيذ:</td><td><textarea id="report-location-report" rows="${locationLines}" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' class="w-full border-none p-1 bg-transparent" style="overflow-y:hidden; resize:none;">${programData.location}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">عدد الطلاب المستفيدين:</td><td><input type="text" class="w-full border-none p-1" placeholder="للتعبئة"></td><td class="font-bold bg-slate-50 w-1/5">المعلم/ة المنفذ/ة:</td><td><input type="text" class="w-full border-none p-1" value="${document.getElementById('teacher-name').value}"></td></tr>
                                <tr>
                                    <td class="report-label align-top">نواتج التعلم:</td>
                                    <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3">
                                        <textarea id="report-learning-outcomes-report" class="w-full border-none p-2 resize-none" rows="3">${programData.learningOutcomes}</textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="report-label align-top">إجراءات التنفيذ (ملخص):</td>
                                    <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3">
                                        <textarea id="report-details-report" class="w-full border-none p-2 resize-none" rows="3">${programData.details.map(d => `- ${d.content}`).join('\n')}</textarea>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="space-y-4 text-sm">
                            <div>
                                <h4 class="report-label mb-1 mt-8">صور للشواهد</h4>
                                <div id="image-upload-grid" class="grid grid-cols-3 gap-4 mt-2">
                                    ${Array(6).fill(0).map((_, i) => `
                                        <div class="aspect-square border-2 border-dashed rounded-lg flex items-center justify-center text-slate-400 relative image-upload-slot">
                                            <label for="image-input-${i}" class="cursor-pointer absolute inset-0 flex flex-col items-center justify-center z-10">
                                                <svg class="w-8 h-8 mb-1" fill="none" stroke="currentColor" viewBox="0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg><span>إضافة صورة ${i + 1}</span></label>
                                            <input type="file" id="image-input-${i}" class="hidden" accept="image/*" onchange="previewImage(event, 'image-preview-${i}')">
                                            <img id="image-preview-${i}" class="absolute inset-0 w-full h-full object-cover rounded-lg hidden z-0">
                                        </div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer class="pt-8 text-center text-xs">
                        <div class="gradient-line mb-4"></div>
                        <div class="grid grid-cols-2 gap-16">
                            <div class="pt-2 mt-2"><p class="font-bold h-6">${leaderName}</p></div>
                            <div class="pt-2 mt-2"><p class="font-bold h-6">${directorName}</p></div>
                        </div>
                    </footer>`;
                document.getElementById('report-page-content').innerHTML = reportHTML;
                document.getElementById('setup-screen-reports').classList.add('hidden');
                document.getElementById('output-report').classList.remove('hidden');

                // Auto-resize all textareas in the report
                document.querySelectorAll('#report-page-content textarea').forEach(textarea => {
                    autoGrowTextarea(textarea);
                    textarea.addEventListener('input', () => autoGrowTextarea(textarea));
                });
            }
            
            const parseDateForSorting = (dateString) => { const parts = dateString.split(' '); return parseInt(parts[3], 10) * 100 + parseInt(parts[1], 10); };
            const formatFullDate = (dateString) => { const p = dateString.split(' '); return `${p[1].padStart(2, '0')} / ${p[3].padStart(2, '0')} / 1447 هـ`; };
            const saveState = () => { 
                state.objective = objectiveSelect.value; 
                localStorage.setItem('planGeneratorState', JSON.stringify(state)); 
            };
            
            function autoGrowTextarea(element) {
                element.style.height = "auto";
                element.style.height = (element.scrollHeight) + "px";
            }

            window.previewImage = function(event, imgId) {
                const img = document.getElementById(imgId);
                const input = event.target;
                const slot = input.closest('.image-upload-slot');
                const label = slot.querySelector('label');
                if (input.files && input.files[0]) {
                    img.src = URL.createObjectURL(input.files[0]);
                    img.classList.remove('hidden');
                    label.classList.add('opacity-0', 'hover:opacity-75', 'hover:bg-black/50');
                    label.querySelector('span').textContent = 'تغيير الصورة';
                    slot.classList.add('has-image');
                }
            }
            window.openDatePicker = function() {
                const modal = document.getElementById('date-picker-modal');
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData) return;
                tempSelectedDates = [...(state.planDates || [])].filter(d => d !== 'يحدد لاحقًا');
                const container = document.getElementById('modal-weeks-container');
                container.innerHTML = '';
                document.getElementById('modal-title').textContent = `اختر ${programData.sessions} حصص لبرنامج: ${programData.name}`;
                Object.values(activeWeeksData).forEach(weekData => {
                    const weekDiv = document.createElement('div');
                    weekDiv.className = 'p-2 border rounded-md';
                    weekDiv.innerHTML = `<p class="font-semibold text-center mb-2">${weekData.name}</p>`;
                    const weekGrid = document.createElement('div');
                    weekGrid.className = 'week-grid grid grid-cols-5 gap-2';
                    Object.entries(weekData.days).forEach(([dayName, dayDate]) => {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'day p-2 border rounded-md text-sm';
                        const fullDate = `${dayName} ${dayDate}`;
                        dayButton.dataset.date = fullDate;
                        let buttonText = `${dayName}<br>${dayDate}`;
                        if (weekData.specialDays && weekData.specialDays[dayDate]) {
                            dayButton.classList.add('disabled'); dayButton.disabled = true;
                            buttonText += `<br><span class="text-xs">${weekData.specialDays[dayDate].name}</span>`;
                        } else {
                            dayButton.onclick = () => toggleDateSelection(dayButton);
                        }
                        if (tempSelectedDates.includes(fullDate)) dayButton.classList.add('selected');
                        dayButton.innerHTML = buttonText;
                        weekGrid.appendChild(dayButton);
                    });
                    weekDiv.appendChild(weekGrid);
                    container.appendChild(weekDiv);
                });
                modal.style.display = 'flex';
            }

            window.toggleDateSelection = function(button) {
                const date = button.dataset.date;
                const isSelected = button.classList.contains('selected');
                const programKeyOnly = state.programKey;
                const sessions = fieldsData[programKeyOnly].stages[state.stage].sessions;
                if (isSelected) {
                    tempSelectedDates = tempSelectedDates.filter(d => d !== date);
                    button.classList.remove('selected');
                } else {
                    if (tempSelectedDates.length < sessions) {
                        tempSelectedDates.push(date);
                        button.classList.add('selected');
                    } else {
                        alert(`لا يمكن اختيار أكثر من ${sessions} حصص.`);
                    }
                }
            }

            window.closeDatePicker = function() { document.getElementById('date-picker-modal').style.display = 'none'; tempSelectedDates = []; }
            window.saveDates = function() { state.planDates = [...(tempSelectedDates || [])]; updateDatePickerButton(); saveState(); closeDatePicker(); }

            function generatePlan() {
                state = { ...state, objective: objectiveSelect.value, ...Object.fromEntries(['teacher-name', 'leader-name', 'director-name', 'education-admin', 'school-name', 'strengths', 'difficulties', 'remedial-actions'].map(id => [id.replace(/-(\w)/g, (m, p1) => p1.toUpperCase()), document.getElementById(id).value])), achievements: document.getElementById('additional-achievements').value };
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData || !state.objective) { alert('يرجى التأكد من اختيار جميع الحقول المطلوبة.'); return; }
                if (programData.isPlaceholder){ alert('لا يمكن إنشاء خطة لهذا البرنامج حاليًا.'); return; }
                
                saveState(); 
                if(state.planDates && !state.planDates.includes('يحدد لاحقًا')) {
                    state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                }
                
                document.getElementById('report-education-admin-plan').textContent = state.educationAdmin;
                document.getElementById('report-school-name-plan').textContent = state.schoolName;
                document.getElementById('report-program-name-plan').value = fieldsData[programKeyOnly].name;
                document.getElementById('report-program-details-name-plan').value = programData.name;
                document.getElementById('report-objective-plan').value = state.objective;
                document.getElementById('report-program-target-plan').value = programData.target;
                document.getElementById('report-teacher-name-plan').value = state.teacherName;
                document.getElementById('report-duration-plan').value = programData.duration;
                document.getElementById('report-location-plan').value = programData.location;
                document.getElementById('report-tools-plan').value = programData.tools;
                document.getElementById('report-learning-outcomes-plan').value = programData.learningOutcomes;
                document.getElementById('report-assessment-methods-plan').value = programData.assessmentMethods;
                document.getElementById('report-leader-name-plan').textContent = state.leaderName;
                document.getElementById('report-director-name-plan').textContent = state.directorName;
                document.getElementById('report-additional-achievements-plan').value = state.achievements;
                document.getElementById('report-strengths-plan').value = state.strengths;
                document.getElementById('report-difficulties-plan').value = state.difficulties;
                document.getElementById('report-remedial-actions-plan').value = state.remedialActions;

                const tableBody = document.getElementById('plan-table-body');
                tableBody.innerHTML = '';

                // MODIFIED: Loop over selected dates instead of all program details
                state.planDates.forEach((date, index) => {
                    // Ensure we don't try to access a session that doesn't exist in the definition
                    if (index < programData.details.length) {
                        const session = programData.details[index];
                        let weekName = session.week || '';
                        
                        if (date !== 'يحدد لاحقًا') {
                             for (const key in activeWeeksData) { 
                                if (Object.values(activeWeeksData[key].days).includes(date.split(' ').slice(1).join(' '))) { 
                                    weekName = activeWeeksData[key].name; 
                                    break; 
                                }
                            }
                        }

                        tableBody.innerHTML += `<tr>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${weekName}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${date ? (date === 'يحدد لاحقًا' ? 'يحدد لاحقًا' : formatFullDate(date)) : 'لم يحدد'}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${session.title}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${session.content}</textarea></td>
                            <td class="text-xs">
                                <div class="flex items-center p-1"><span class="inline-block w-4 h-4 border border-slate-400 mr-2 ml-1"></span> نفذ</div>
                                <div class="flex items-center p-1 mt-1"><span class="inline-block w-4 h-4 border border-slate-400 mr-2 ml-1"></span> لم ينفذ</div>
                            </td>
                        </tr>`;
                    }
                });

                document.getElementById('setup-screen-plan').classList.add('hidden');
                document.getElementById('output-plan').classList.remove('hidden');

                // Auto-resize all textareas after generation
                document.querySelectorAll('#output-plan textarea').forEach(textarea => autoGrowTextarea(textarea));
            }
            
            window.printContent = function(elementId) {
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('printable-active'));
                const elementToPrint = document.getElementById(elementId);
                if (elementToPrint && elementToPrint.parentElement.classList.contains('content-section')) {
                     elementToPrint.parentElement.classList.add('printable-active');
                }
                window.print();
            }

            function updateRegionUI() {
                const btnOther = document.getElementById('btn-region-other');
                const btnWestern = document.getElementById('btn-region-western');
                if (state.region === 'western') {
                    activeWeeksData = weeksDataWestern;
                    btnWestern.classList.add('bg-teal-600', 'text-white');
                    btnOther.classList.remove('bg-teal-600', 'text-white');
                } else {
                    activeWeeksData = weeksDataDefault;
                    btnOther.classList.add('bg-teal-600', 'text-white');
                    btnWestern.classList.remove('bg-teal-600', 'text-white');
                }
            }
            
            function initializeApp() {
                state = JSON.parse(localStorage.getItem('planGeneratorState')) || { region: 'other' };
                if (state.educationAdmin) document.getElementById('education-admin').value = state.educationAdmin;
                if (state.schoolName) document.getElementById('school-name').value = state.schoolName;
                if (state.teacherName) document.getElementById('teacher-name').value = state.teacherName;
                if (state.leaderName) document.getElementById('leader-name').value = state.leaderName;
                if (state.directorName) document.getElementById('director-name').value = state.directorName;
                if (state.achievements) document.getElementById('additional-achievements').value = state.achievements;
                if (state.strengths) document.getElementById('strengths').value = state.strengths;
                if (state.difficulties) document.getElementById('difficulties').value = state.difficulties;
                if (state.remedialActions) document.getElementById('remedial-actions').value = state.remedialActions;
                
                updateRegionUI();
                setupPlanTab();
                setupReportsTab();

                if(state.fontFamily) {
                    document.body.style.fontFamily = state.fontFamily;
                    fontSelect.value = state.fontFamily;
                } else {
                    fontSelect.value = 'Tajawal';
                }

                if(state.objective) {
                    setTimeout(() => { 
                        objectiveSelect.value = state.objective;
                    }, 100);
                }
            }
            
            initializeApp();
        });
    </script>
</body>
</html>
