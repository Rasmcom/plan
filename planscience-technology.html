<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مجال العلوم والتقنية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f7fafc;
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            border-radius: 8px 8px 0 0;
            background-color: #e2e8f0;
            color: #4a5568;
        }
        .tab-button.active {
            border-color: #38a169;
            background-color: #ffffff;
            color: #2c7a7b;
            font-weight: 700;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 5mm;
            margin: 1cm auto;
            border: 1px #D1D5DB solid;
            border-radius: 5px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        .a4-page main {
            flex-grow: 1;
        }
        .report-label {
            color: #067693;
            background-color: #f0f9ff;
            font-weight: bold;
            padding: 8px;
            border-left: 4px solid #0891b2;
        }
        .table-bordered th, .table-bordered td {
            border: 1px solid #e2e8f0;
            padding: 6px;
            text-align: right;
            vertical-align: middle;
            font-size: 0.8rem;
        }
        #date-picker-modal .week-grid .day.selected {
            background-color: #0d9488;
            color: white;
            border-color: #0f766e;
        }
        #date-picker-modal .week-grid .day.disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }
        .evaluation-table input[type="radio"], .evaluation-table input[type="checkbox"] {
            transform: scale(1.2);
        }

        .print-header-container, .print-footer-container {
            display: none;
        }

        .gradient-line {
            height: 5px;
            background: linear-gradient(to left, #28a745, #007bff);
            border-radius: 2.5px;
        }

        @media print {
            @page {
                size: A4 portrait;
                margin: 0;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            .no-print {
                display: none !important;
            }

            body,
            html {
                background: white !important;
                margin: 0;
                padding: 0;
                font-size: 9pt;
            }
            
            textarea {
                overflow: hidden !important;
                height: auto !important;
                resize: none;
            }

            .a4-page {
                box-shadow: none !important;
                max-width: 100% !important;
                margin: 0 !important;
                border: none !important;
                padding: 1cm 5mm;
                page-break-inside: avoid;
                height: auto;
                min-height: 0; 
            }

            .content-section {
                display: none !important;
            }

            .content-section.printable-active {
                display: block !important;
            }
            
            .table-bordered, .table-bordered th, .table-bordered td {
                padding: 4px;
                font-size: 8pt;
            }
            
            h2 { font-size: 14pt; }
            
            #image-upload-grid {
                grid-template-columns: repeat(3, 1fr) !important;
            }
            .image-upload-slot {
                height: 5cm;
                aspect-ratio: auto;
            }
             .image-upload-slot img {
                object-fit: contain;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-8 pb-4 border-b-2 border-teal-600 no-print">
            <div class="flex items-center gap-4">
                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                <div>
                    <h1 class="text-3xl font-bold text-teal-800">مجال العلوم والتقنية</h1>
                    <p class="text-slate-600">إدارة خطط وتقارير برامج المجال</p>
                </div>
            </div>
        </header>

        <div class="flex justify-center gap-2 mb-8 no-print">
            <button id="tab-btn-plan" class="tab-button active flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                خطة برامج النشاط
            </button>
            <button id="tab-btn-reports" class="tab-button flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 17h20"></path><path d="M6 17v-7a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v7"></path><path d="M12 7V4H8v3"></path><path d="M18 17v-5a2 2 0 0 0-2-2h-4"></path></svg>
                التقارير
            </button>
        </div>

        <main>
            <div id="content-plan" class="content-section active">
                <div id="setup-screen-plan" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <input type="text" id="education-admin" placeholder="الإدارة التعليمية: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                            <input type="text" id="school-name" placeholder="المدرسة: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                        </div>

                        <div class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">1. اختر المنطقة</h3>
                                    <div class="flex gap-3">
                                        <button id="btn-region-other" class="w-full p-3 border rounded-lg transition">باقي المناطق</button>
                                        <button id="btn-region-western" class="w-full p-3 border rounded-lg transition">المنطقة الغربية</button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">2. اختر المرحلة</h3>
                                    <select id="stage-select-plan" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <option value="">-- اختر مرحلة دراسية --</option>
                                        <option value="primary">الابتدائية (الأولية)</option>
                                        <option value="upper-primary">الابتدائية (العليا)</option>
                                        <option value="middle">المتوسطة</option>
                                        <option value="high-2">الثانوية</option>
                                    </select>
                                </div>
                            </div>
                             <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">3. اختر البرنامج</h3>
                                <div class="grid grid-cols-1 gap-4">
                                    <select id="program-select-plan" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                        <option value="">-- اختر البرنامج --</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">4. اختر الهدف من البرنامج</h3>
                                <select id="objective-select" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50" disabled>
                                    <option value="">-- اختر الهدف --</option>
                                </select>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">5. حدد تواريخ التنفيذ</h3>
                                    <button id="date-picker-btn" class="w-full p-3 border border-slate-300 rounded-lg text-right text-slate-500 hover:bg-slate-50 transition" disabled>اختر تواريخ الحصص</button>
                                    <div id="program-details-plan" class="border-2 border-teal-100 bg-teal-50/50 p-3 rounded-lg mt-4 text-sm min-h-[60px]"></div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">6. أدخل البيانات الأساسية</h3>
                                    <div class="space-y-4">
                                        <input type="text" id="teacher-name" placeholder="المعلم/ة المنفذ/ة" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="leader-name" placeholder="رائد/ة النشاط: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="director-name" placeholder="مدير/ة المدرسة: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                    </div>
                                </div>
                            </div>
                             <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">7. تفاصيل إضافية (مقترحة)</h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <textarea id="additional-achievements" placeholder="الإنجازات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="strengths" placeholder="نقاط القوة" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="difficulties" placeholder="الصعوبات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="remedial-actions" placeholder="الإجراءات العلاجية" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="mt-10 text-center flex gap-4">
                            <button id="generate-plan-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg">إعداد الخطة للطباعة</button>
                             <button id="reset-plan-btn" class="w-auto bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition">إعادة تعيين</button>
                        </div>
                    </div>
                </div>

                <div id="output-plan" class="hidden">
                    <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-plan')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة الخطة</button>
                        <button onclick="document.getElementById('output-plan').classList.add('hidden'); document.getElementById('setup-screen-plan').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page">
                        <header class="mb-4">
                            <div class="flex justify-between items-center pb-2">
                                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                                <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                     <p id="report-education-admin-plan" class="font-bold"></p>
                                     <p id="report-school-name-plan" class="font-bold"></p>
                                </div>
                            </div>
                            <div class="gradient-line mt-2"></div>
                            <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">خطة تنفيذ برنامج النشاط الطلابي</h2>
                        </header>
                        <main>
                            <table class="w-full mb-4 text-sm border-collapse">
                                <tbody>
                                    <tr>
                                        <td class="report-label w-1/5">اسم البرنامج:</td>
                                        <td id="report-program-name-plan" class="p-2 border border-slate-200 w-3/10"></td>
                                        <td class="report-label w-1/5">تفاصيل البرنامج:</td>
                                        <td id="report-program-details-name-plan" class="p-2 border border-slate-200 w-3/10"></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">الهدف من البرنامج:</td>
                                        <td id="report-objective-plan" class="p-2 border border-slate-200"></td>
                                        <td class="report-label">الفئة المستهدفة:</td>
                                        <td id="report-program-target-plan" class="p-2 border border-slate-200"></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">المعلم/ة المنفذ/ة:</td>
                                        <td id="report-teacher-name-plan" class="p-2 border border-slate-200"></td>
                                        <td class="report-label">مدة التنفيذ:</td>
                                        <td id="report-duration-plan" class="p-2 border border-slate-200"></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">مكان التنفيذ:</td>
                                        <td id="report-location-plan" class="p-2 border border-slate-200 whitespace-pre-line"></td>
                                        <td class="report-label">أدوات التنفيذ:</td>
                                        <td id="report-tools-plan" class="p-2 border border-slate-200 whitespace-pre-line"></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label align-top">نواتج التعلم:</td>
                                        <td id="report-learning-outcomes-plan" class="p-2 border border-slate-200 whitespace-pre-line" colspan="3"></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label w-1/4">أساليب التقويم:</td>
                                        <td id="report-assessment-methods-plan" class="p-2 border border-slate-200 whitespace-pre-line" colspan="3"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w-full table-bordered mb-6">
                                <thead class="bg-teal-50 font-bold">
                                    <tr><th class="w-[15%]">الأسبوع</th><th class="w-[20%]">التاريخ</th><th class="w-[25%]">عنوان الحصة</th><th class="w-[40%]">المحتوى والإجراءات</th></tr>
                                </thead>
                                <tbody id="plan-table-body"></tbody>
                            </table>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><h4 class="report-label mb-1">الإنجازات</h4><p id="report-additional-achievements-plan" class="p-2 border border-slate-200 min-h-[40px] whitespace-pre-wrap"></p></div>
                                <div><h4 class="report-label mb-1">نقاط القوة</h4><p id="report-strengths-plan" class="p-2 border border-slate-200 min-h-[40px] whitespace-pre-wrap"></p></div>
                                <div><h4 class="report-label mb-1">الصعوبات</h4><p id="report-difficulties-plan" class="p-2 border border-slate-200 min-h-[40px] whitespace-pre-wrap"></p></div>
                                <div><h4 class="report-label mb-1">الإجراءات العلاجية</h4><p id="report-remedial-actions-plan" class="p-2 border border-slate-200 min-h-[40px] whitespace-pre-wrap"></p></div>
                            </div>
                        </main>
                        <footer class="pt-8 text-center text-xs">
                            <div class="gradient-line mb-4"></div>
                            <div class="grid grid-cols-2 gap-16">
                                <div class="pt-2 mt-2"><p id="report-leader-name-plan" class="font-bold h-6"></p></div>
                                <div class="pt-2 mt-2"><p id="report-director-name-plan" class="font-bold h-6"></p></div>
                            </div>
                        </footer>
                    </div>
                </div>
            </div>

            <div id="content-reports" class="content-section">
                <div id="setup-screen-reports" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <h2 class="text-2xl font-bold text-teal-800 mb-6">إعداد تقرير برنامج النشاط</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <select id="stage-select-reports" class="w-full p-3 border border-slate-300 rounded-lg">
                                 <option value="">-- اختر المرحلة الدراسية --</option>
                            </select>
                            <select id="program-select-reports" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                <option value="">-- اختر البرنامج --</option>
                            </select>
                        </div>
                        <div id="report-dates-display" class="mt-4 text-center text-slate-600 bg-slate-100 p-3 rounded-lg">اختر مرحلة وبرنامج لعرض التواريخ</div>
                         <div class="mt-6 text-center">
                            <button id="generate-report-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg" disabled>إنشاء نموذج التقرير</button>
                        </div>
                    </div>
                </div>
                <div id="output-report" class="hidden">
                     <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-report')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة التقرير</button>
                        <button onclick="document.getElementById('output-report').classList.add('hidden'); document.getElementById('setup-screen-reports').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page" id="report-page-content">
                        </div>
                </div>
            </div>

        </main>
    </div>
<footer class="text-center py-6 mt-12 border-t border-slate-200 no-print">
    <a href="https://www.rasmcom.com" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-3 text-sm text-gray-600 hover:text-teal-700 transition" style="text-decoration: none;">
        <img src="https://e.top4top.io/p_3463x5tj40.png" alt="شعار رسم" class="h-10 w-auto" style="height: 2.5rem; width: auto; border: none;">
        <span>جميع الحقوق محفوظة لقناة رسم للتصميم والخدمات التعليمية 2025</span>
    </a>
</footer>
    <div id="date-picker-modal" class="fixed inset-0 z-50 items-center justify-center p-4 bg-black bg-opacity-50 hidden no-print">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full">
            <h3 id="modal-title" class="text-xl font-bold mb-4">اختر تواريخ التنفيذ</h3>
            <div id="modal-weeks-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeDatePicker()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">إلغاء</button>
                <button onclick="saveDates()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">حفظ التواريخ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const programDefinitions = {
                'science_tech': {
                    field: "العلوم والتقنية",
                    programs: {
                        'iot_challenge': "برنامج تحدي إنترنت الأشياء",
                        'ai_program': "برنامج الذكاء الاصطناعي",
                        'sci_tech_designs': "برنامج التصاميم العلمية التقنية",
                        'stem_apps': "برنامج تطبيقات STEAM",
                        'future_space_pioneers': "برنامج رواد فضاء المستقبل",
                        'future_cities': "برنامج مدن المستقبل"
                    }
                }
            };
            
            let fieldsData = {};

            fieldsData.iot_challenge = {
                name: "برنامج تحدي إنترنت الأشياء",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج تحدي إنترنت الأشياء – الصفوف الأولية", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات بسيطة، صور، فيديو",
                        learningOutcomes: "• التمييز بين استخدامات جهازين ذكيين شائعين في بيئته.\n• التعبير عن فكرة «المنزل الذكي».\n• مناقشة فائدة تطبيق تقني واحد في حياته اليومية.\n• المشاركة في تصميم نموذج ذكي ضمن مجموعة صغيرة.\n• المشاركة في تحدٍ صفي مبسط.",
                        assessmentMethods: "الملاحظة، المشاركة الصفية",
                        details: [
                            { title: "الأجهزة الذكية في حياتنا", content: "تمهيد ومناقشة حول الأجهزة الذكية المستخدمة يوميًا." },
                            { title: "ما هو المنزل الذكي؟", content: "عرض فيديو وشرح مفهوم المنزل الذكي وأمثلته." },
                            { title: "تطبيقات تقنية في حياتنا", content: "مناقشة حول التطبيقات المستخدمة وفوائدها." },
                            { title: "تصميم جماعي لنموذج ذكي", content: "نشاط جماعي لرسم أو بناء نموذج ذكي بسيط." },
                            { title: "التحدي الصفي: منزل ذكي مبسط", content: "عرض المجموعات لنماذجها وتلقي التغذية الراجعة." }
                        ],
                        strengths: "تفاعل الطلاب مع مفهوم التكنولوجيا الحديثة.", difficulties: "الحاجة إلى تبسيط المفاهيم التقنية.", achievements: "تصميم الطلاب لنماذج مبتكرة للمنازل الذكية.", remedial_actions: "استخدام المزيد من الوسائل البصرية والأمثلة الملموسة."
                    },
                    'upper-primary': {
                        name: "برنامج تحدي إنترنت الأشياء – الصفوف العليا", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف العليا", location: "معمل الحاسب/نادي العلوم", tools: "مجسمات، أدوات بناء",
                        learningOutcomes: "• مناقشة فكرتين جديدتين لتطوير المنزل الذكي.\n• تحديد وظيفة ثلاثة أجهزة ذكية في مجسم.\n• تطبيق مفهومين أساسيين في الكهرباء أو التقنية.\n• تحليل أدوار الأجهزة الذكية في نموذج منزله.\n• عرض مشروعه في فعالية مدرسية.\n• المشاركة بفكرته في منافسة مدرسية.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                           { title: "أفكار لتطوير المنزل الذكي", content: "عصف ذهني لأفكار تطويرية مثل الإضاءة الموفرة للطاقة." },
                           { title: "وظائف الأجهزة الذكية", content: "تحديد وشرح وظائف الأجهزة الذكية في المجسم." },
                           { title: "تطبيق مفاهيم الكهرباء والتقنية", content: "ربط مفاهيم الدوائر الكهربائية والمستشعرات بالأجهزة الذكية." },
                           { title: "تحليل الأدوار وتحسين النموذج", content: "تحليل دور كل جهاز في المشروع واقتراح تحسينات." },
                           { title: "العرض في معرض مدرسي", content: "تقديم المشاريع أمام الصف وتلقي التغذية الراجعة." },
                           { title: "المنافسة المدرسية للمشاريع", content: "عرض نهائي للمشاريع أمام لجنة وتقييمها." }
                        ],
                        strengths: "قدرة الطلاب على الربط بين المفاهيم النظرية والتطبيق العملي.", difficulties: "توفير الأدوات والمكونات الإلكترونية اللازمة.", achievements: "بناء نماذج عملية للمنازل الذكية.", remedial_actions: "البحث عن بدائل منخفضة التكلفة للمكونات الإلكترونية."
                    },
                    'middle': {
                        name: "برنامج تحدي إنترنت الأشياء – المرحلة المتوسطة", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب", tools: "أدوات برمجة، حساسات",
                        learningOutcomes: "• مناقشة أثر تقنيات المنزل الذكي في تقليل استهلاك الطاقة.\n• تصميم نموذج أولي لمنزل ذكي.\n• تحليل الظاهرة التقنية التي يتحكم بها مشروعه.\n• تطبيق مهارات رياضية وعلمية في برمجة جهاز ذكي.\n• عرض مشروعه ضمن مسابقة مدرسية.\n• المشاركة في فعالية محلية وكتابة تقرير.",
                        assessmentMethods: "تقييم النماذج الأولية، تقارير المشاريع",
                        details: [
                            { title: "تقنيات المنزل الذكي وأثرها", content: "مناقشة أثر الأجهزة الذكية على استهلاك الطاقة والبيئة." },
                            { title: "تصميم نموذج أولي لمنزل ذكي", content: "رسم مخطط أولي يدمج بين التقنية والهندسة." },
                            { title: "تحليل الظاهرة التقنية", content: "شرح آلية عمل جهاز ذكي وكيفية استجابته للبيئة." },
                            { title: "برمجة سلوك الجهاز الذكي", content: "تطبيق برمجي مبسط للتحكم في سلوك الجهاز." },
                            { title: "عرض المشروع في مسابقة مدرسية", content: "تقديم المشاريع وشرح مكوناتها وآلية عملها." },
                            { title: "المعرض المحلي والتقرير النهائي", content: "المشاركة في فعالية وكتابة تقرير عن المشروع." }
                        ],
                        strengths: "قدرة الطلاب على التعامل مع البرمجة البسيطة.", difficulties: "فهم المفاهيم البرمجية المتقدمة.", achievements: "برمجة سلوكيات معقدة للأجهزة الذكية.", remedial_actions: "توفير ورش عمل إضافية في البرمجة."
                    },
                    'high-2': {
                        name: "برنامج تحدي إنترنت الأشياء – المرحلة الثانوية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/قاعة النشاط", tools: "عتاد مفتوح المصدر, أدوات برمجة",
                        learningOutcomes: "• عرض مشكلة محلية واقتراح حل تقني يعتمد على إنترنت الأشياء.\n• توظيف خطوات البحث العلمي في اقتراح حل.\n• تحليل أثر الحل التقني المقترح على جودة الحياة.\n• تطوير نموذج أولي باستخدام أدوات برمجة وعتاد مفتوح المصدر.\n• إظهار مهارات التفكير النقدي والقيادة ضمن فريق العمل.\n• المشاركة في مسابقة علمية أو تقنية.",
                        assessmentMethods: "تقييم المشاريع، البحث العلمي",
                        details: [
                           { title: "تحديد مشكلة محلية وحل تقني", content: "اختيار مشكلة واقتراح حل باستخدام إنترنت الأشياء." },
                           { title: "خطوات البحث العلمي المبسط", content: "تطبيق خطوات البحث العلمي على مشروع صغير." },
                           { title: "تحليل أثر الحل التقني", content: "تحليل كيف يمكن للحل المقترح تحسين جودة الحياة." },
                           { title: "تطوير النموذج الأولي", content: "استخدام أدوات برمجة وعتاد مفتوح المصدر لبناء النموذج." },
                           { title: "التفكير النقدي والقيادة في المشروع", content: "العمل الجماعي وتوزيع الأدوار وتوثيق مراحل العمل." },
                           { title: "المسابقة والعرض النهائي", content: "محاكاة مسابقة علمية وتقديم المشروع أمام لجنة تقييم." }
                        ],
                        strengths: "قدرة الطلاب على البحث العلمي وتطوير حلول مبتكرة.", difficulties: "الحاجة إلى دعم تقني متخصص.", achievements: "تطوير حلول تقنية لمشكلات واقعية.", remedial_actions: "التواصل مع خبراء في مجال إنترنت الأشياء."
                    }
                }
            };
            
            fieldsData.ai_program = {
                name: "برنامج الذكاء الاصطناعي",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج الذكاء الاصطناعي – الصفوف الأولية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف الأولية", location: "معمل الحاسب", tools: "مساعد صوتي، صور",
                        learningOutcomes: "• معرفة المفاهيم الأساسية للذكاء الاصطناعي.\n• التمييز بين البرمجة التقليدية والذكاء الاصطناعي.\n• الربط بين الحواس البشرية ومدخلات الذكاء الاصطناعي.\n• استخدام أداة مبنية على الذكاء الاصطناعي.\n• تطبيق خوارزميات بسيطة.\n• إدراك أهمية الاستخدام الأخلاقي.",
                        assessmentMethods: "الملاحظة، المشاركة",
                        details: [
                            { title: "تمهيد المفاهيم + الأمان", content: "تقديم مبسط لمفهوم الذكاء الاصطناعي وأهمية الأمان." },
                            { title: "مهمة 1 — استخدام المساعد الذكي", content: "طرح أسئلة على مساعد صوتي وملاحظة الاستجابات." },
                            { title: "مهمة 2 — الروبوتات حولنا", content: "عرض صور لروبوتات وربط مدخلاتها بالحواس البشرية." },
                            { title: "مهمة 3 — أرسم روبوتي", content: "رسم روبوت خيالي ووصف وظيفته." },
                            { title: "مقدمة لتعلم الآلة", content: "نشاط فرز صور لاستنتاج أهمية البيانات المتنوعة." },
                            { title: "هل الذكاء الاصطناعي ذكي؟", content: "عرض أمثلة لنجاح وفشل الأنظمة الذكية وتحليل الأخطاء." }
                        ],
                        strengths: "اهتمام الطلاب بموضوع الذكاء الاصطناعي.", difficulties: "شرح المفاهيم المجردة.", achievements: "فهم الطلاب للمفاهيم الأساسية للذكاء الاصطناعي.", remedial_actions: "استخدام الألعاب والأنشطة التفاعلية."
                    },
                    'upper-primary': {
                        name: "برنامج الذكاء الاصطناعي – الصفوف العليا", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف العليا", location: "معمل الحاسب", tools: "منصة Teachable Machine",
                        learningOutcomes: "• شرح مفاهيم الذكاء الاصطناعي وتعلم الآلة.\n• التمييز بين طرق تمثيل البيانات.\n• تطبيق خطوات التدريب والتوقع.\n• تصميم نظام تصنيف مبسط.\n• احترام الخصوصية وحقوق البيانات.\n• ملاحظة أخطاء النتائج وتبعاتها.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "اختبار تورنج — محادثة إنسان أم آلة؟", content: "محادثة مع أداة ذكاء اصطناعي ومقارنتها بالإنسان." },
                            { title: "تخزين الصور بالحاسب", content: "نشاط لتمثيل الصور كبكسلات لفهم كيفية تخزينها." },
                            { title: "Teachable Machine", content: "تدريب نموذج تصنيف بسيط بصور واختبار دقته." },
                            { title: "إنسان أم روبوت؟", content: "مقارنة مهام وتحديد الأصلح لتنفيذها (إنسان أم روبوت)." },
                            { title: "هل الذكاء الاصطناعي دائمًا ذكي؟", content: "عرض أمثلة لتصنيف خاطئ وتحليل أسباب الخطأ." },
                            { title: "أهمية تمثيل البيانات", content: "نشاط يوضح كيف يؤثر تمثيل البيانات على دقة النتائج." }
                        ],
                        strengths: "قدرة الطلاب على فهم مفاهيم تعلم الآلة.", difficulties: "التعامل مع البيانات وتحضيرها.", achievements: "بناء نماذج تصنيف بسيطة.", remedial_actions: "التركيز على مشاريع عملية ومبسطة."
                    },
                    'middle': {
                        name: "برنامج الذكاء الاصطناعي – المرحلة المتوسطة", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب", tools: "أدوات برمجية، روبوتات بسيطة",
                        learningOutcomes: "• معرفة استراتيجيات تعلم الآلة.\n• وصف خوارزميات البحث وإيجاد المسار الأفضل.\n• استخدام منصات تدريب النماذج.\n• تطبيق خطوات التدريب وحساب الدقة.\n• مناقشة التحديات والأخلاقيات.",
                        assessmentMethods: "تقييم المشاريع، عروض تقديمية",
                        details: [
                            { title: "تمهيد وإثراءات مفاهيمية", content: "تقديم أمثلة تطبيقية متعددة لتهيئة المفاهيم." },
                            { title: "تجربة السرعة بالروبوت", content: "حساب سرعة روبوت ومناقشة العوامل المؤثرة." },
                            { title: "برمجة وتطبيق", content: "صياغة خطوات وتنفيذ أوامر برمجية بسيطة." },
                            { title: "تصميم حل تقني", content: "اختيار مشكلة مجتمعية ورسم مخطط لنظام ذكي لحلها." },
                            { title: "تطوير النموذج", content: "تحسين التصميم السابق بناءً على التغذية الراجعة." },
                            { title: "عرض المشروع", content: "تجهيز عرض قصير وتقديمه أمام الزملاء." }
                        ],
                        strengths: "قدرة الطلاب على تصميم حلول تقنية.", difficulties: "تطبيق الخوارزميات المعقدة.", achievements: "تصميم وتنفيذ حلول بسيطة لمشكلات واقعية.", remedial_actions: "البدء بمشاريع موجهة وتوفير الدعم المستمر."
                    },
                    'high-2': {
                        name: "برنامج الذكاء الاصطناعي – المرحلة الثانوية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب", tools: "مصادر بحث، أدوات برمجية",
                        learningOutcomes: "• توضيح مجالات الذكاء الاصطناعي وتطبيقاته.\n• مناقشة إمكاناته وتحدياته.\n• تصميم برنامج بسيط بخوارزمية ذكاء اصطناعي.\n• تقييم جودة النماذج بمبادئ رياضية/إحصائية.\n• البحث في مصادر موثوقة.\n• المشاركة في مسابقات علمية.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "البحث والتفسير", content: "جمع معلومات وتلخيصها في خريطة مفاهيم." },
                            { title: "الربط البيني مع العلوم والتقنية", content: "تحليل كيف تدعم الفيزياء وإنترنت الأشياء الأنظمة الذكية." },
                            { title: "خطة مشروع لحل محلي", content: "تحديد مشكلة ووضع فرضية وتحديد المدخلات والمخرجات." },
                            { title: "النموذج الأولي + دعم العربية", content: "تطوير نموذج أولي وتجربة أدوات تدعم اللغة العربية." },
                            { title: "تقييم وتحسين", content: "حساب دقة النموذج واقتراح تحسينات." },
                            { title: "المشاركة التنافسية", content: "تقديم المشروع أمام لجنة ومراجعة معايير المسابقات." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتحليل.", difficulties: "فهم الجوانب الرياضية والإحصائية.", achievements: "تطوير مشاريع متكاملة وتقديمها في مسابقات.", remedial_actions: "تنظيم ورش عمل متخصصة."
                    }
                }
            };

            fieldsData.sci_tech_designs = {
                name: "برنامج التصاميم العلمية والتقنية",
                field: "العلوم والتقنية",
                 stages: {
                    'primary': {
                        name: "برنامج التصاميم العلمية والتقنية – الصفوف الأولية", sessions: 2, duration: "90 دقيقة (حصتان)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات فنية بسيطة",
                        learningOutcomes: "• التمييز بين مادتين أو أكثر في بناء نموذج.\n• وصف وظيفة أداة تقنية واحدة.\n• رسم صورة لأداة من تصميمه.\n• شرح كيفية استخدام الأشكال أو الأعداد في التصميم.\n• طرح سؤال واحد على الأقل حول كيفية عمل أداة.\n• المشاركة في تصميم نموذج ضمن مجموعة.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات",
                        details: [
                            { title: "أتعرف الأدوات وأصنّف المواد", content: "تصنيف أدوات حسب المادة المصنوعة منها ومناقشة استخداماتها." },
                            { title: "شكل الأداة ووظيفتها ثم ابتكار بسيط", content: "مناقشة كيف يؤثر الشكل على الوظيفة ورسم أداة مبتكرة." }
                        ],
                        strengths: "إبداع الطلاب في تصميم أدوات جديدة.", difficulties: "ربط التصميم بالوظيفة بشكل دقيق.", achievements: "فهم الطلاب للعلاقة بين المواد والأدوات.", remedial_actions: "عرض المزيد من الأمثلة العملية."
                    },
                    'upper-primary': {
                        name: "برنامج التصاميم العلمية والتقنية – الصفوف العليا", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "الصفوف العليا", location: "معمل العلوم", tools: "أدوات بناء بسيطة",
                        learningOutcomes: "• وصف تصميم أداة تقنية بسيطة.\n• الربط بين الأداة المصممة ومشكلة من واقعه.\n• استخدام قياسات وأشكال هندسية بسيطة.\n• استنتاج العلاقة بين شكل التصميم والوظيفة.\n• المشاركة في مناقشة حول أهمية العلوم والتقنية.\n• إظهار سلوك قيادي أثناء العمل في المجموعة.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "مفاهيم أساسية للتصاميم العلمية", content: "مناقشة مفهوم الأدوات التقنية وأهميتها." },
                            { title: "المشكلة ومتطلبات التصميم", content: "اختيار مشكلة يومية وتحديد معايير التصميم." },
                            { title: "بناء النموذج الأولي", content: "بناء نموذج مصغر باستخدام مواد بسيطة." },
                            { title: "التجريب والتحسين", content: "اختبار النموذج وتحديد المشكلات وإجراء التحسينات." },
                            { title: "نقود ونشارك (العرض المصغر)", content: "تجهيز عرض قصير وتقديمه أمام الصف." }
                        ],
                        strengths: "قدرة الطلاب على حل المشكلات.", difficulties: "الحاجة إلى مهارات يدوية دقيقة.", achievements: "بناء نماذج أولية فعالة.", remedial_actions: "توفير تدريب على استخدام الأدوات."
                    },
                    'middle': {
                        name: "برنامج التصاميم العلمية والتقنية – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب/المكتبة", tools: "أدوات برمجية، مصادر بحث",
                        learningOutcomes: "• تحليل مشكلة بيئية أو اجتماعية واقتراح حل تقني.\n• توظيف مصدرين علميين موثوقين لدعم فكرة المشروع.\n• دمج مفاهيم من البرمجة والعلوم والهندسة في التصميم.\n• اقتراح تحسين واحد على الأقل بناءً على الملاحظة.\n• توضيح إسهام المشروع في خدمة المجتمع.\n• عرض النتائج بشكل منظم.",
                        assessmentMethods: "تقييم المشاريع، البحث العلمي",
                        details: [
                            { title: "أعرّف المشكلة", content: "اختيار مشكلة محلية وصياغة سؤال بحثي." },
                            { title: "البحث عن مصادر", content: "التدريب على البحث في مصادر موثوقة وتوثيقها." },
                            { title: "من الفكرة إلى التصميم", content: "رسم مخطط وتحديد الأدوات وتوزيع الأدوار." },
                            { title: "النمذجة الأولية", content: "بناء نموذج باستخدام خامات بسيطة وتجربته." },
                            { title: "البرمجة والتطبيق", content: "برمجة سلوك بسيط للنموذج واختباره." },
                            { title: "التحسينات", content: "تحليل النتائج واقتراح تحسينات على التصميم." },
                            { title: "العرض المنظم", content: "تجهيز عرض يوضح المشكلة والحل والأثر المجتمعي." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتصميم.", difficulties: "دمج البرمجة في المشاريع.", achievements: "تطوير حلول تقنية لمشكلات مجتمعية.", remedial_actions: "تنظيم ورش عمل في البرمجة والتصميم."
                    },
                    'high-2': {
                        name: "برنامج التصاميم العلمية والتقنية – المرحلة الثانوية", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/قاعة النشاط", tools: "منصات برمجة، أدوات عرض",
                        learningOutcomes: "• استعراض نموذجين عالميين لحلول تقنية والمقارنة بينهما.\n• اختيار قضية محلية وتطوير حل تقني مبتكر.\n• توظيف خطوات التصميم الهندسي ومهارات البرمجة.\n• اقتراح تطوير للمشروع بناء على الملاحظات.\n• عرض المشروع يوضح تكامل التخصصات العلمية.\n• تقديم المشروع بثقة أمام لجنة.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                            { title: "حلول عالمية وقضية محلية", content: "عرض نماذج عالمية واختيار قضية محلية." },
                            { title: "تحديد المشكلة والمتطلبات", content: "صياغة المشكلة وتحديد معايير النجاح." },
                            { title: "النمذجة والتصميم الهندسي", content: "رسم مخطط للنظام باستخدام برامج محاكاة." },
                            { title: "التكامل البرمجي", content: "استخدام منصات برمجة وبرمجة سلوك أولي." },
                            { title: "الاختبار والتحسين", content: "تجربة الحل عمليًا وتحليل نقاط القوة والضعف." },
                            { title: "تجهيز العرض والتوثيق", content: "إعداد عرض يوضح المشكلة والحل والأثر." },
                            { title: "العرض النهائي", content: "تقديم المشروع أمام لجنة ومناقشة الأسئلة." }
                        ],
                        strengths: "قدرة الطلاب على تطوير حلول مبتكرة.", difficulties: "الحاجة إلى مهارات برمجية متقدمة.", achievements: "تطوير مشاريع تقنية متكاملة.", remedial_actions: "الاستعانة بخبراء لتقديم الدعم الفني."
                    }
                }
            };
            
            fieldsData.stem_apps = {
                name: "برنامج تطبيقات STEAM",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج تطبيقات STEAM – المرحلة الأولية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات تجارب بسيطة",
                        learningOutcomes: "• رسم مشهد يعبر عن ظاهرة طبيعية.\n• ذكر ثلاثة عناصر طبيعية في بيئته.\n• وصف تجربة حسية مبسطة.\n• شرح مبدأ علمي بسيط.\n• المشاركة في تنفيذ تجربة ضمن مجموعة.\n• التعبير عن نتيجة تجربة بالرسم.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات",
                        details: [
                            { title: "استكشاف الظواهر الطبيعية", content: "عرض صور وفيديو لظواهر طبيعية ورسمها." },
                            { title: "عناصر الطبيعة في بيئتي", content: "جولة صفية أو عرض صور لعناصر طبيعية ومناقشة أهميتها." },
                            { title: "تجربة حسية مبسطة", content: "تنفيذ تجربة بسيطة ووصف نتائجها." },
                            { title: "المبدأ العلمي في حياتي", content: "تجربة قصيرة لشرح مبدأ علمي بسيط." },
                            { title: "نشاط جماعي استكشافي", content: "نشاط جماعي لتصنيف المواد وتبادل الأدوار." },
                            { title: "التعبير عن النتائج", content: "رسم أو كتابة نتائج النشاط ومشاركتها." }
                        ],
                        strengths: "فضول الطلاب ورغبتهم في الاستكشاف.", difficulties: "الحفاظ على تركيز الطلاب لفترات طويلة.", achievements: "فهم الطلاب للمفاهيم العلمية البسيطة.", remedial_actions: "استخدام أنشطة قصيرة ومتنوعة."
                    },
                    'upper-primary': {
                        name: "برنامج تطبيقات STEAM – المرحلة العليا", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف العليا", location: "معمل العلوم", tools: "أدوات بناء دوائر كهربائية",
                        learningOutcomes: "• شرح كيفية عمل جهاز بسيط.\n• تصنيف ثلاثة استخدامات للكهرباء.\n• الربط بين المواد المستخدمة وموارد البيئة.\n• تنفيذ خطوات لإنشاء مشروع إلكتروني.\n• تقديم فكرة جديدة لتطوير المشروع.\n• المشاركة الفعالة ضمن فريق.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "الكهرباء في حياتي", content: "مناقشة الأجهزة البسيطة وتجربة تشغيل دائرة كهربائية." },
                            { title: "استخدامات الكهرباء", content: "تصنيف استخدامات الكهرباء وتقديم أمثلة." },
                            { title: "مواد من البيئة", content: "مناقشة المواد المحلية وربطها بالمشاريع." },
                            { title: "مشروع إلكتروني بسيط", content: "بناء دائرة كهربائية بسيطة واختبارها." },
                            { title: "تطوير الفكرة", content: "مناقشة كيفية تحسين الدائرة واقتراح تطويرات." },
                            { title: "العمل الجماعي", content: "تنفيذ مشروع مشترك وتبادل الأدوار." }
                        ],
                        strengths: "قدرة الطلاب على بناء دوائر كهربائية.", difficulties: "فهم المفاهيم الكهربائية المجردة.", achievements: "تنفيذ مشاريع إلكترونية بسيطة.", remedial_actions: "استخدام محاكاة الدوائر الكهربائية."
                    },
                    'middle': {
                        name: "برنامج تطبيقات STEAM – المرحلة المتوسطة", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب/المكتبة", tools: "أدوات برمجية، مصادر بحث",
                        learningOutcomes: "• توضيح إسهامات عالم أو مخترع.\n• تطبيق خطوات علمية باستخدام أداة برمجية.\n• مناقشة استخدام مورد محلي في تصميم نموذج بيئي.\n• شرح تكامل العلوم والرياضيات والتقنية في المشروع.\n• التعاون مع الزملاء ضمن فريق.\n• عرض المشروع أمام لجنة.",
                        assessmentMethods: "تقييم المشاريع، البحث العلمي",
                        details: [
                            { title: "العلماء والابتكار", content: "عرض سيرة عالم وربط إسهاماته بحل بيئي." },
                            { title: "خطوات المشروع التطبيقي", content: "اختيار فكرة مشروع وتطبيق خطوات علمية." },
                            { title: "الموارد المحلية", content: "مناقشة الموارد المحلية وتصميم مشروع بيئي ذكي." },
                            { title: "تكامل العلوم والتقنية", content: "توضيح كيفية تكامل التخصصات في المشروع." },
                            { title: "العمل الجماعي", content: "تقسيم الطلاب إلى فرق وتوزيع الأدوار." },
                            { title: "عرض المشاريع", content: "تقديم المشاريع أمام الزملاء وتلقي الأسئلة." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتصميم.", difficulties: "دمج البرمجة في المشاريع.", achievements: "تطوير حلول تقنية لمشكلات مجتمعية.", remedial_actions: "تنظيم ورش عمل في البرمجة والتصميم."
                    },
                    'high-2': {
                        name: "برنامج تطبيقات STEAM – المرحلة الثانوية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/قاعات النشاط", tools: "أدوات عرض، نماذج عمل",
                        learningOutcomes: "• تحليل مشكلة مجتمعية واقتراح حل مبتكر.\n• تحليل الأثر الإيجابي/السلبي للفكرة.\n• البحث في المصادر الرقمية والمقارنة عالميًا ومحليًا.\n• التخطيط لمشروع متكامل.\n• عرض المشروع باستخدام أدوات احترافية.\n• المشاركة في منافسة علمية.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "مشكلات المجتمع", content: "اختيار مشكلة ومناقشة حلول تقنية محتملة." },
                            { title: "أثر الحل", content: "تحليل الفوائد والأضرار باستخدام معايير علمية." },
                            { title: "البحث والمقارنة", content: "البحث عن تقنية ومقارنتها عالميًا ومحليًا." },
                            { title: "التخطيط للمشروع", content: "إعداد نموذج عمل وتحديد الأدوات الرقمية." },
                            { title: "عرض احترافي", content: "التدريب على أدوات العرض وإعداد عرض واضح." },
                            { title: "المنافسة العلمية", content: "محاكاة منافسة علمية وتقديم المشروع." }
                        ],
                        strengths: "قدرة الطلاب على التخطيط والتنفيذ.", difficulties: "الحاجة إلى مهارات عرض متقدمة.", achievements: "تطوير مشاريع متكاملة وتقديمها بشكل احترافي.", remedial_actions: "تنظيم ورش عمل في مهارات العرض والتقديم."
                    }
                }
            };
            
            fieldsData.future_space_pioneers = {
                name: "برنامج رواد فضاء المستقبل",
                field: "العلوم والتقنية",
                stages: {
                    'primary': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة الأولية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "قصص، صور، أدوات رسم",
                        learningOutcomes: "• التحدث عن رائد فضاء أو عالم بطريقة قصصية.\n• التمييز بين الفضاء والأرض.\n• وصف فكرته في تصميم صاروخ فضائي.\n• التعبير عن الفضول العلمي بسؤال.\n• رسم صاروخ وتوضيح استخدام الأشكال والألوان.\n• المشاركة في تصميم صاروخ ضمن فريق.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات",
                        details: [
                            { title: "قصة رائد الفضاء", content: "قراءة قصة أو مشاهدة مقطع عن رائد فضاء." },
                            { title: "الفرق بين الأرض والفضاء", content: "عرض صور ومقارنة بين الأرض والفضاء." },
                            { title: "فكرة صاروخي", content: "وصف فكرة صاروخ وربطها بموارد محلية." },
                            { title: "فضولي العلمي", content: "تشجيع الطلاب على طرح أسئلة عن الفضاء." },
                            { title: "رسم وتصميم صاروخ", content: "رسم صاروخ باستخدام أشكال هندسية وألوان." },
                            { title: "بناء صاروخ جماعي", content: "بناء نماذج صواريخ في مجموعات صغيرة." }
                        ],
                        strengths: "شغف الطلاب بموضوع الفضاء.", difficulties: "تبسيط المفاهيم الفلكية المعقدة.", achievements: "تنمية خيال الطلاب وإبداعهم.", remedial_actions: "استخدام القصص والأفلام الوثائقية المبسطة."
                    },
                    'upper-primary': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة العليا", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف العليا", location: "معمل العلوم", tools: "أدوات بناء نماذج",
                        learningOutcomes: "• تمييز ثلاث من خصائص الفضاء.\n• تصميم نموذج مبسط لبدلة أو مركبة فضائية.\n• توظيف أدوات بسيطة ومحلية في التصميم.\n• المشاركة في نشاط تمثيلي بدور رائد فضاء.\n• مناقشة جهود عالم أو مهندس فضاء.\n• التعاون مع الزملاء في تنفيذ تصميم مشترك.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "خصائص الفضاء", content: "مناقشة خصائص الفضاء وأهمية الرحلات الفضائية." },
                            { title: "تصميم بدلة فضائية", content: "رسم نموذج لبدلة أو مركبة وشرح وظيفة أجزائها." },
                            { title: "أدوات بسيطة للتصميم", content: "استخدام مواد محلية لبناء فكرة مبتكرة." },
                            { title: "رائد فضاء في مهمة", content: "نشاط تمثيلي لوصف مهام رواد الفضاء." },
                            { title: "جهود علماء الفضاء", content: "عرض إنجازات علماء الفضاء ومناقشة أثرها." },
                            { title: "تصميم جماعي", content: "تنفيذ تصميم مشترك في مجموعات وتوزيع الأدوار." }
                        ],
                        strengths: "قدرة الطلاب على التصميم والبناء.", difficulties: "توفير مواد متنوعة للبناء.", achievements: "تصميم نماذج مبتكرة للمركبات الفضائية.", remedial_actions: "تشجيع استخدام المواد المعاد تدويرها."
                    },
                    'middle': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة المتوسطة", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة المتوسطة", location: "معمل العلوم/المكتبة", tools: "أدوات تجارب، مصادر بحث",
                        learningOutcomes: "• تفسير ظاهرة تقنية مرتبطة بالفضاء.\n• المقارنة بين بيئة الأرض والفضاء.\n• تصميم تجربة مبسطة توضح أثر الجاذبية.\n• تطبيق خطوات البحث العلمي.\n• توضيح العلاقة بين الرياضيات والعلوم.\n• المشاركة في معرض مدرسي أو مسابقة علمية.",
                        assessmentMethods: "تقييم المشاريع، التقارير العلمية",
                        details: [
                            { title: "تفسير ظاهرة فضائية", content: "مناقشة ظاهرة تقنية وربطها بمفهوم علمي." },
                            { title: "مقارنة الأرض والفضاء", content: "عمل جدول للمقارنة بين بيئة الأرض والفضاء." },
                            { title: "تجربة أثر الجاذبية", content: "تنفيذ تجربة لملاحظة أثر الجاذبية." },
                            { title: "خطوات البحث العلمي", content: "التدريب على تسجيل الملاحظات وكتابة التقارير." },
                            { title: "الرياضيات في الفضاء", content: "استخدام الجداول والقياسات لتوضيح العلاقة بين الرياضيات والعلوم." },
                            { title: "عرض مشروع الفضاء", content: "تجهيز الطلاب لمعرض أو مسابقة وعرض أعمالهم." }
                        ],
                        strengths: "قدرة الطلاب على إجراء التجارب والبحث.", difficulties: "فهم المفاهيم الفيزيائية المعقدة.", achievements: "تنفيذ تجارب علمية ناجحة وتقديم تقارير عنها.", remedial_actions: "استخدام برامج المحاكاة لتوضيح المفاهيم."
                    },
                    'high-2': {
                        name: "برنامج رواد فضاء المستقبل – المرحلة الثانوية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "المرحلة الثانوية", location: "معمل الحاسب/المكتبة الرقمية", tools: "مصادر بحث، أدوات تصميم",
                        learningOutcomes: "• توظيف مهارات البحث لشرح خصائص بيئة الفضاء.\n• تحديد مشكلة حقيقية واقتراح حل تقني مبتكر.\n• تطبيق مفاهيم من العلوم والتقنية والهندسة في التصميم.\n• تصميم نموذج أولي أو عرض رقمي.\n• المشاركة في منافسة علمية.\n• إظهار مهارات القيادة والتخطيط.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "خصائص الفضاء وتأثيرها", content: "بحث في مصادر موثوقة وإعداد ملخص." },
                            { title: "مشكلة في الفضاء", content: "تحديد مشكلة واقتراح حل تقني مبتكر." },
                            { title: "تكامل العلوم في المشروع", content: "دمج مفاهيم متعددة في تصميم المشروع." },
                            { title: "تصميم النموذج الأولي", content: "استخدام أدوات حديثة لبناء نموذج أولي أو عرض رقمي." },
                            { title: "الاستعداد للمنافسة", content: "التدريب على عرض المشاريع وفق معايير التقييم." },
                            { title: "القيادة والتخطيط", content: "تنظيم فرق عمل وتقديم عرض نهائي احترافي." }
                        ],
                        strengths: "قدرة الطلاب على البحث والتصميم المتقدم.", difficulties: "الحاجة إلى دعم تقني متخصص.", achievements: "تطوير حلول مبتكرة لمشكلات فضائية.", remedial_actions: "التواصل مع خبراء في مجال الفضاء."
                    }
                }
            };
            
            fieldsData.future_cities = {
                name: "برنامج مدن المستقبل",
                field: "العلوم والتقنية",
                 stages: {
                    'primary': {
                        name: "برنامج مدن المستقبل – الصفوف الأولية", sessions: 3, duration: "135 دقيقة (3 حصص)", target: "الصفوف الأولية", location: "الصف/ركن العلوم", tools: "أدوات فنية، أدوات تقنية بسيطة",
                        learningOutcomes: "• مناقشة دور التقنية في تحسين الحياة.\n• تسمية ثلاثة موارد طبيعية في بيئته.\n• رسم نموذج لمدينة المستقبل.\n• استخدام أدوات بسيطة لتصميم أولي لمدينة.\n• المشاركة في بناء مجسم جماعي.\n• عرض مجسمه وشرح حل بسيط لمدينته.",
                        assessmentMethods: "الملاحظة، تقييم الرسومات والمجسمات",
                        details: [
                            { title: "استكشاف «مدينتي الذكية»", content: "تمهيد بصور ومناقشة موارد البيئة المحلية." },
                            { title: "«كنز بلادي»: تخطيط أولي لمدينة المستقبل", content: "رسم مخطط لمدينة يتضمن عناصر طبيعية وتقنية." },
                            { title: "نبني مجسّم «مدينة المستقبل» + العرض", content: "عمل جماعي لبناء مجسم وعرضه في معرض صفي." }
                        ],
                        strengths: "إبداع الطلاب في تخيل مدن المستقبل.", difficulties: "توفير أدوات تقنية بسيطة.", achievements: "بناء مجسمات مبتكرة للمدن الذكية.", remedial_actions: "تشجيع استخدام المواد المعاد تدويرها."
                    },
                    'upper-primary': {
                        name: "برنامج مدن المستقبل – الصفوف العليا", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف العليا", location: "معمل الحاسب/نادي العلوم", tools: "أدوات بناء، برمجيات تصميم",
                        learningOutcomes: "• تحديد ثلاثة موارد طبيعية ووصف دورها.\n• مقارنة تقنية واحدة في المدن الحالية والمستقبلية.\n• الربط بين مفاهيم العلوم والرياضيات والتقنية.\n• تنفيذ تصميم أولي لمدينة ذكية.\n• المشاركة في مناقشة جماعية واقتراح حل مبتكر.\n• عرض مشروعه أمام زملائه.",
                        assessmentMethods: "تقييم المشاريع، الملاحظة",
                        details: [
                            { title: "موارد مدينتي وتقنياتها", content: "مناقشة الموارد الطبيعية والمقارنة بين التقنيات." },
                            { title: "مخطط أوّلي لمدينة ذكية", content: "تصميم ورقي لمدينة مستقبلية وتحديد العناصر الذكية." },
                            { title: "تصميم رقمي/نمذجة أولية", content: "تحويل المخطط الورقي إلى نموذج ثلاثي الأبعاد." },
                            { title: "تحسينات ذكية + عرض أولي", content: "اقتراح تحسينات وعرض سريع للمشروع." }
                        ],
                        strengths: "قدرة الطلاب على استخدام برامج التصميم.", difficulties: "الحاجة إلى أجهزة حاسوب بمواصفات جيدة.", achievements: "تصميم نماذج رقمية للمدن الذكية.", remedial_actions: "استخدام برامج تصميم مجانية ومفتوحة المصدر."
                    },
                    'middle': {
                        name: "برنامج مدن المستقبل – المرحلة المتوسطة", sessions: 7, duration: "315 دقيقة (7 حصص)", target: "المرحلة المتوسطة", location: "معمل الحاسب/المكتبة", tools: "برامج تصميم، وسائل عرض",
                        learningOutcomes: "• إعداد عرض قصير لسيرة عالم تقني.\n• مناقشة أثر استخدام موردين طبيعيين في التصميم.\n• التقييم لتأثير 3 تقنيات ذكية على جودة الحياة.\n• استخدام برنامج تصميم رقمي لرسم نموذج أولي.\n• تقديم مشروع يوظف مفاهيم متعددة.\n• المشاركة في نقد بنّاء وإظهار قيادة.",
                        assessmentMethods: "تقييم المشاريع، العروض التقديمية",
                        details: [
                            { title: "ملهمون في التقنية + احتياجات المدينة", content: "إعداد ملصق عن عالم تقني وتحديد احتياجات المدينة." },
                            { title: "مقارنة الموارد + اختيار التحدي", content: "مقارنة الموارد الطبيعية واختيار تحدٍ حضري." },
                            { title: "تقييم تقنيات ذكية", content: "تقييم تقنيات ذكية من حيث أثرها على جودة الحياة." },
                            { title: "تخطيط المدينة الرقمية", content: "بناء مخطط أولي لمدينة مستقبلية باستخدام برامج التصميم." },
                            { title: "دمج المفاهيم المتعددة", content: "إبراز التكامل بين العلوم والرياضيات والتقنية والهندسة." },
                            { title: "تطوير النموذج + وثائق العرض", content: "تحسين التصميم وتجهيز شرائح العرض." },
                            { title: "معرض «مدينتنا الذكية»", content: "عرض النماذج في معرض صفي وتبادل النقد البناء." }
                        ],
                        strengths: "قدرة الطلاب على التقييم والتحليل.", difficulties: "الحاجة إلى وقت كافٍ لتطوير المشاريع.", achievements: "تقديم عروض متكاملة للمشاريع.", remedial_actions: "تنظيم وقت العمل وتوزيع المهام بشكل فعال."
                    },
                    'high-2': {
                        name: "برنامج مدن المستقبل – المرحلة الثانوية", sessions: 9, duration: "405 دقيقة (9 حصص)", target: "المرحلة الثانوية", location: "معامل الحاسب/قاعات النشاط", tools: "أدوات بناء نماذج، أدوات رقمية",
                        learningOutcomes: "• إعداد عرض تقديمي لسيرة عالم.\n• تحليل مدى توافق تصميم مدينة ذكية مع معايير الاستدامة.\n• تحليل نموذج حقيقي/افتراضي لمدينة ذكية.\n• تطوير نموذج أولي باستخدام أدوات التصميم والبرمجة.\n• إظهار روح التعاون والمسؤولية ضمن فريق.\n• تقديم عرض بحثي أمام لجنة.",
                        assessmentMethods: "تقييم المشاريع، الأبحاث",
                        details: [
                            { title: "ملهمون ومدن ذكية", content: "عروض خاطفة لسيرة علماء وتحديد تحديات محلية." },
                            { title: "تحليل تصميمات معاصرة", content: "تحليل نموذج لمدينة ذكية وتلخيص نقاط القوة والضعف." },
                            { title: "صياغة مشكلة وأهداف مشروع", content: "تحديد مشكلة ووضع بطاقة مشروع وتوزيع الأدوار." },
                            { title: "تخطيط ونمذجة أولية", content: "إنتاج نموذج أولي يوضح المكونات ومسار الطاقة/البيانات." },
                            { title: "فحص الاستدامة", content: "اختبار النموذج مقابل معايير الاستدامة وتوثيق التعديلات." },
                            { title: "تكامل الذكاء الاصطناعي/إنترنت الأشياء", content: "إدخال عنصر ذكي وشرح تدفق البيانات وقرارات النظام." },
                            { title: "إعداد العرض الاحترافي", content: "بناء عرض تقديمي يوضح تكامل التخصصات." },
                            { title: "تحسين نهائي + توثيق", content: "إدخال التحسينات وتحضير ملف مشروع متكامل." },
                            { title: "المعرض/المسابقة المدرسية", content: "تقديم المشاريع في مسابقة مدرسية وتلقي التقييم." }
                        ],
                        strengths: "قدرة الطلاب على تطوير حلول مستدامة.", difficulties: "الحاجة إلى دعم فني متخصص.", achievements: "تطوير مشاريع متكاملة للمدن الذكية والمستدامة.", remedial_actions: "التواصل مع خبراء في مجال المدن الذكية."
                    }
                }
            };
            
            const weeksDataDefault = {
                'week1': { name: 'الأسبوع الأول', days: { 'الأحد': '1 / 3', 'الاثنين': '2 / 3', 'الثلاثاء': '3 / 3', 'الأربعاء': '4 / 3', 'الخميس': '5 / 3' } },
                'week2': { name: 'الأسبوع الثاني', days: { 'الأحد': '8 / 3', 'الاثنين': '9 / 3', 'الثلاثاء': '10 / 3', 'الأربعاء': '11 / 3', 'الخميس': '12 / 3' } },
                'week3': { name: 'الأسبوع الثالث', days: { 'الأحد': '15 / 3', 'الاثنين': '16 / 3', 'الثلاثاء': '17 / 3', 'الأربعاء': '18 / 3', 'الخميس': '19 / 3' } },
                'week4': { name: 'الأسبوع الرابع', days: { 'الأحد': '22 / 3', 'الاثنين': '23 / 3', 'الثلاثاء': '24 / 3', 'الأربعاء': '25 / 3', 'الخميس': '26 / 3' } },
                'week5': { name: 'الأسبوع الخامس', days: { 'الأحد': '29 / 3', 'الاثنين': '30 / 3', 'الثلاثاء': '1 / 4', 'الأربعاء': '2 / 4', 'الخميس': '3 / 4' }, specialDays: { '1 / 4': { name: 'إجازة' } } },
                'week6': { name: 'الأسبوع السادس', days: { 'الأحد': '6 / 4', 'الاثنين': '7 / 4', 'الثلاثاء': '8 / 4', 'الأربعاء': '9 / 4', 'الخميس': '10 / 4' } },
                'week7': { name: 'الأسبوع السابع', days: { 'الأحد': '13 / 4', 'الاثنين': '14 / 4', 'الثلاثاء': '15 / 4', 'الأربعاء': '16 / 4', 'الخميس': '17 / 4' } },
                'week8': { name: 'الأسبوع الثامن', days: { 'الأحد': '20 / 4', 'الاثنين': '21 / 4', 'الثلاثاء': '22 / 4', 'الأربعاء': '23 / 4', 'الخميس': '24 / 4' } },
                'week9': { name: 'الأسبوع التاسع', days: { 'الأحد': '27 / 4', 'الاثنين': '28 / 4', 'الثلاثاء': '29 / 4', 'الأربعاء': '30 / 4', 'الخميس': '1 / 5' } },
                'week10': { name: 'الأسبوع العاشر', days: { 'الأحد': '4 / 5', 'الاثنين': '5 / 5', 'الثلاثاء': '6 / 5', 'الأربعاء': '7 / 5', 'الخميس': '8 / 5' } },
                'week11': { name: 'الأسبوع الحادي عشر', days: { 'الأحد': '11 / 5', 'الاثنين': '12 / 5', 'الثلاثاء': '13 / 5', 'الأربعاء': '14 / 5', 'الخميس': '15 / 5' } },
                'week12': { name: 'الأسبوع الثاني عشر', days: { 'الأحد': '18 / 5', 'الاثنين': '19 / 5', 'الثلاثاء': '20 / 5', 'الأربعاء': '21 / 5', 'الخميس': '22 / 5' } },
                'week13': { name: 'الأسبوع الثالث عشر', days: { 'الأحد': '25 / 5', 'الاثنين': '26 / 5', 'الثلاثاء': '27 / 5', 'الأربعاء': '28 / 5', 'الخميس': '29 / 5' } },
            };
            const weeksDataWestern = Object.fromEntries(Object.entries(weeksDataDefault).slice(1).map(([k, v], i) => [k, {...v, name: `الأسبوع ${['الأول','الثاني','الثالث','الرابع','الخامس','السادس','السابع','الثامن','التاسع','العاشر','الحادي عشر','الثاني عشر'][i]}` }]));
            
            let activeWeeksData = weeksDataDefault;
            let tempSelectedDates = [];
            let state = {};

            const tabButtons = document.querySelectorAll('.tab-button');
            const contentSections = document.querySelectorAll('.content-section');
            const stageSelectPlan = document.getElementById('stage-select-plan');
            const programSelectPlan = document.getElementById('program-select-plan');
            const objectiveSelect = document.getElementById('objective-select');
            const datePickerBtn = document.getElementById('date-picker-btn');
            const stageSelectReports = document.getElementById('stage-select-reports');
            const programSelectReports = document.getElementById('program-select-reports');
            const generateReportBtn = document.getElementById('generate-report-btn');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(sec => sec.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.id.replace('tab-btn-', 'content-')).classList.add('active');
                });
            });

            function populateStages(selectElement) {
                const stages = { 'primary': 'الابتدائية (الأولية)', 'upper-primary': 'الابتدائية (العليا)', 'middle': 'المتوسطة', 'high-2': 'الثانوية' };
                selectElement.innerHTML = '<option value="">-- اختر المرحلة الدراسية --</option>';
                for (const key in stages) {
                    selectElement.innerHTML += `<option value="${key}">${stages[key]}</option>`;
                }
            }

            function populateProgramsByStage(stage, programSelectElement, useGenericName = false) {
                programSelectElement.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                programSelectElement.disabled = true;
                if (!stage) return;
                
                Object.entries(fieldsData).forEach(([progKey, progData]) => {
                    if (progData.stages && progData.stages[stage]) {
                        const option = document.createElement('option');
                        option.value = `${progKey}|${stage}`;
                        option.textContent = useGenericName ? progData.name : (progData.stages[stage].name || progData.name);
                        programSelectElement.appendChild(option);
                    }
                });
                programSelectElement.disabled = false;
            }

            function setupPlanTab() {
                stageSelectPlan.addEventListener('change', () => {
                    const stage = stageSelectPlan.value;
                    programSelectPlan.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                    programSelectPlan.disabled = true;
                    objectiveSelect.innerHTML = '<option value="">-- اختر الهدف --</option>';
                    objectiveSelect.disabled = true;

                    if (!stage) {
                        return;
                    }

                    const scienceField = "العلوم والتقنية";
                    Object.entries(fieldsData).forEach(([key, program]) => {
                        if (program.field === scienceField && program.stages[stage]) {
                            programSelectPlan.innerHTML += `<option value="${key}">${program.name}</option>`;
                        }
                    });
                    programSelectPlan.disabled = false;

                    const objectives = { 
                        'تعزيز المدرسة للشراكة المجتمعية': '١- تعزيز المدرسة للشراكة المجتمعية',
                        'دعم الأنشطة الطلابية للسلوك الإيجابي': '٢- دعم الأنشطة الطلابية للسلوك الإيجابي',
                        'تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية': '٣- تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية',
                        'زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة': '٤- زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة',
                        'تعزيز الأنشطة الطلابية للانضباط المدرسي': '٥- تعزيز الأنشطة الطلابية للانضباط المدرسي',
                        'أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين': '٦- أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين',
                        'تحسين الأنشطة الطلابية لنواتج التعلم': '٧- تحسين الأنشطة الطلابية لنواتج التعلم',
                        'اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي': '٨- اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي',
                        'تفعيل المناسبات الوطنية والأسابيع والأيام العالمية': '٩- تفعيل المناسبات الوطنية والأسابيع والأيام العالمية'
                    };
                    for (const [value, text] of Object.entries(objectives)) {
                        objectiveSelect.innerHTML += `<option value="${value}">${text}</option>`;
                    }
                });

                programSelectPlan.addEventListener('change', () => {
                    state.programKey = programSelectPlan.value;
                    state.stage = stageSelectPlan.value;
                    state.planDates = [];
                    updateProgramDisplay();
                });
                 ['btn-region-other', 'btn-region-western'].forEach(id => document.getElementById(id).addEventListener('click', (e) => { state.region = id.includes('other') ? 'other' : 'western'; updateRegionUI(); }));
                datePickerBtn.addEventListener('click', () => openDatePicker());
                document.getElementById('reset-plan-btn').addEventListener('click', () => { if(confirm('هل أنت متأكد؟ سيتم حذف جميع البيانات المدخلة.')) { localStorage.removeItem('planGeneratorState'); location.reload(); }});
                document.getElementById('generate-plan-btn').addEventListener('click', generatePlan);
            }
             function updateProgramDisplay() {
                if (!state.programKey || !state.stage) return;
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                document.getElementById('program-details-plan').innerHTML = `<p><strong class="font-semibold">البرنامج:</strong> ${programData.name}</p><p><strong class="font-semibold">عدد الحصص المقترح:</strong> ${programData.sessions} حصص</p>`;
                objectiveSelect.disabled = false;
                if (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة")) {
                    datePickerBtn.disabled = true;
                    datePickerBtn.textContent = 'البرنامج مستمر أو بمدة مرنة';
                    state.planDates = programData.details.map(d => d.date);
                } else {
                    datePickerBtn.disabled = false;
                    updateDatePickerButton();
                }
                ['strengths', 'difficulties', 'remedial_actions', 'achievements'].forEach(key => { 
                    const elementId = key === 'achievements' ? 'additional-achievements' : key.replace('_', '-');
                    const element = document.getElementById(elementId);
                    if (element) element.value = programData[key] || ''; 
                });
            }

            function updateDatePickerButton() {
                if (!state.programKey || !state.stage) { datePickerBtn.textContent = 'اختر تواريخ الحصص'; return; }
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                const count = state.planDates ? state.planDates.filter(d => d !== 'يحدد لاحقًا').length : 0;
                datePickerBtn.textContent = `اختر تواريخ الحصص (${count} / ${programData.sessions})`;
            }

            function setupReportsTab() {
                populateStages(stageSelectReports);
                stageSelectReports.addEventListener('change', () => {
                    populateProgramsByStage(stageSelectReports.value, programSelectReports, true);
                    generateReportBtn.disabled = true;
                    document.getElementById('report-dates-display').textContent = 'اختر مرحلة وبرنامج لعرض التواريخ';
                });
                programSelectReports.addEventListener('change', () => {
                    generateReportBtn.disabled = !programSelectReports.value;
                    const datesDisplay = document.getElementById('report-dates-display');
                    if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                        state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                        const dateRange = `تواريخ الخطة المحددة: من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                        datesDisplay.textContent = dateRange;
                        datesDisplay.classList.remove('text-red-500');
                    } else {
                        datesDisplay.textContent = 'ملاحظة: لم يتم تحديد تواريخ تنفيذ في تبويب الخطة أو أن البرنامج مستمر. سيظهر التاريخ فارغاً في التقرير.';
                        datesDisplay.classList.add('text-red-500');
                    }
                });
                generateReportBtn.addEventListener('click', generateReport);
            }
            
            function generateReport() {
                const [progKey, stageKey] = programSelectReports.value.split('|');
                const programData = fieldsData[progKey].stages[stageKey];
                const leaderName = document.getElementById('leader-name').value;
                const directorName = document.getElementById('director-name').value;
                const educationAdmin = document.getElementById('education-admin').value;
                const schoolName = document.getElementById('school-name').value;

                let dateRange = "لم يتم تحديد التواريخ في الخطة";
                if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                     state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                     dateRange = `من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                } else if (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة")) {
                    dateRange = "على مدار العام الدراسي أو بمدة مرنة";
                }
                
                const locationLines = (programData.location.match(/\n/g) || []).length + 1;

                const reportHTML = `
                    <header class="mb-4">
                        <div class="flex justify-between items-center pb-2">
                            <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                            <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                <p class="font-bold">${educationAdmin}</p>
                                <p class="font-bold">${schoolName}</p>
                            </div>
                        </div>
                        <div class="gradient-line mt-2"></div>
                        <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">تقرير تنفيذ برنامج نشاط</h2>
                    </header>
                    <main>
                        <h3 class="text-xl font-bold mb-3 text-teal-700 text-center">${programData.name}</h3>
                        <table class="w-full mb-4 text-sm border-collapse table-bordered">
                            <tbody>
                                <tr><td class="font-bold bg-slate-50 w-1/5">المرحلة:</td><td colspan="3">${stageSelectReports.options[stageSelectReports.selectedIndex].text}</td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">الهدف من البرنامج:</td><td colspan="3">${state.objective || 'لم يحدد في الخطة'}</td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">تاريخ التنفيذ:</td><td>${dateRange}</td><td class="font-bold bg-slate-50 w-1/5">مكان التنفيذ:</td><td><textarea rows="${locationLines}" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' class="w-full border-none p-1 bg-transparent" style="overflow-y:hidden; resize:none;">${programData.location}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">عدد الطلاب المستفيدين:</td><td><input type="text" class="w-full border-none p-1" placeholder="للتعبئة"></td><td class="font-bold bg-slate-50 w-1/5">المعلم/ة المنفذ/ة:</td><td><input type="text" class="w-full border-none p-1" value="${document.getElementById('teacher-name').value}"></td></tr>
                            </tbody>
                        </table>
                        <div class="space-y-4 text-sm">
                            <div class="grid grid-cols-2 gap-4">
                                <div><h4 class="report-label mb-1">نواتج التعلم المستهدفة</h4><p class="p-2 border border-slate-200 whitespace-pre-wrap">${programData.learningOutcomes}</p></div>
                                <div><h4 class="report-label mb-1">إجراءات التنفيذ (ملخص)</h4><p class="p-2 border border-slate-200 whitespace-pre-wrap">${programData.details.map(d => `- ${d.content}`).join('\n')}</p></div>


                            </div>
                            <div><h4 class="report-label mb-1 mt-8">صور للشواهد</h4>
                                <div id="image-upload-grid" class="grid grid-cols-3 gap-4 mt-2">
                                    ${Array(6).fill(0).map((_, i) => `
                                        <div class="aspect-square border-2 border-dashed rounded-lg flex items-center justify-center text-slate-400 relative image-upload-slot">
                                            <label for="image-input-${i}" class="cursor-pointer absolute inset-0 flex flex-col items-center justify-center z-10">
                                                <svg class="w-8 h-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg><span>إضافة صورة ${i + 1}</span></label>
                                            <input type="file" id="image-input-${i}" class="hidden" accept="image/*" onchange="previewImage(event, 'image-preview-${i}')">
                                            <img id="image-preview-${i}" class="absolute inset-0 w-full h-full object-cover rounded-lg hidden z-0">
                                        </div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer class="pt-8 text-center text-xs">
                        <div class="gradient-line mb-4"></div>
                        <div class="grid grid-cols-2 gap-16">
                            <div class="pt-2 mt-2"><p class="font-bold h-6">${leaderName}</p></div>
                            <div class="pt-2 mt-2"><p class="font-bold h-6">${directorName}</p></div>
                        </div>
                    </footer>`;
                document.getElementById('report-page-content').innerHTML = reportHTML;
                document.getElementById('setup-screen-reports').classList.add('hidden');
                document.getElementById('output-report').classList.remove('hidden');
            }
            
            const parseDateForSorting = (dateString) => { const parts = dateString.split(' '); return parseInt(parts[3], 10) * 100 + parseInt(parts[1], 10); };
            const formatFullDate = (dateString) => { const p = dateString.split(' '); return `${p[1].padStart(2, '0')} / ${p[3].padStart(2, '0')} / 1447 هـ`; };
            const saveState = () => { 
                state.objective = objectiveSelect.value; 
                localStorage.setItem('planGeneratorState', JSON.stringify(state)); 
            };

            window.previewImage = function(event, imgId) {
                const img = document.getElementById(imgId);
                const input = event.target;
                const label = input.closest('.image-upload-slot').querySelector('label');
                if (input.files && input.files[0]) {
                    img.src = URL.createObjectURL(input.files[0]);
                    img.classList.remove('hidden');
                    label.classList.add('opacity-0', 'hover:opacity-75', 'hover:bg-black/50');
                    label.querySelector('span').textContent = 'تغيير الصورة';
                }
            }
            window.openDatePicker = function() {
                const modal = document.getElementById('date-picker-modal');
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData) return;
                tempSelectedDates = [...(state.planDates || [])].filter(d => d !== 'يحدد لاحقًا');
                const container = document.getElementById('modal-weeks-container');
                container.innerHTML = '';
                document.getElementById('modal-title').textContent = `اختر ${programData.sessions} حصص لبرنامج: ${programData.name}`;
                Object.values(activeWeeksData).forEach(weekData => {
                    const weekDiv = document.createElement('div');
                    weekDiv.className = 'p-2 border rounded-md';
                    weekDiv.innerHTML = `<p class="font-semibold text-center mb-2">${weekData.name}</p>`;
                    const weekGrid = document.createElement('div');
                    weekGrid.className = 'week-grid grid grid-cols-5 gap-2';
                    Object.entries(weekData.days).forEach(([dayName, dayDate]) => {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'day p-2 border rounded-md text-sm';
                        const fullDate = `${dayName} ${dayDate}`;
                        dayButton.dataset.date = fullDate;
                        let buttonText = `${dayName}<br>${dayDate}`;
                        if (weekData.specialDays && weekData.specialDays[dayDate]) {
                            dayButton.classList.add('disabled'); dayButton.disabled = true;
                            buttonText += `<br><span class="text-xs">${weekData.specialDays[dayDate].name}</span>`;
                        } else {
                            dayButton.onclick = () => toggleDateSelection(dayButton);
                        }
                        if (tempSelectedDates.includes(fullDate)) dayButton.classList.add('selected');
                        dayButton.innerHTML = buttonText;
                        weekGrid.appendChild(dayButton);
                    });
                    weekDiv.appendChild(weekGrid);
                    container.appendChild(weekDiv);
                });
                modal.style.display = 'flex';
            }

            window.toggleDateSelection = function(button) {
                const date = button.dataset.date;
                const isSelected = button.classList.contains('selected');
                const programKeyOnly = state.programKey;
                const sessions = fieldsData[programKeyOnly].stages[state.stage].sessions;
                if (isSelected) {
                    tempSelectedDates = tempSelectedDates.filter(d => d !== date);
                    button.classList.remove('selected');
                } else {
                    if (tempSelectedDates.length < sessions) {
                        tempSelectedDates.push(date);
                        button.classList.add('selected');
                    } else {
                        alert(`لا يمكن اختيار أكثر من ${sessions} حصص.`);
                    }
                }
            }

            window.closeDatePicker = function() { document.getElementById('date-picker-modal').style.display = 'none'; tempSelectedDates = []; }
            window.saveDates = function() { state.planDates = [...(tempSelectedDates || [])]; updateDatePickerButton(); saveState(); closeDatePicker(); }

            function generatePlan() {
                state = { ...state, objective: objectiveSelect.value, ...Object.fromEntries(['teacher-name', 'leader-name', 'director-name', 'education-admin', 'school-name', 'strengths', 'difficulties', 'remedial-actions'].map(id => [id.replace(/-(\w)/g, (m, p1) => p1.toUpperCase()), document.getElementById(id).value])), achievements: document.getElementById('additional-achievements').value };
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData || !state.objective) { alert('يرجى التأكد من اختيار جميع الحقول المطلوبة.'); return; }
                if (!programData.duration.includes("العام الدراسي") && !programData.duration.includes("مرنة") && (!state.planDates || state.planDates.length !== programData.sessions)) {
                     alert(`يرجى اختيار ${programData.sessions} حصص بالضبط.`); return; 
                }
                saveState(); 
                if(state.planDates && !state.planDates.includes('يحدد لاحقًا')) {
                    state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                }
                
                document.getElementById('report-education-admin-plan').textContent = state.educationAdmin;
                document.getElementById('report-school-name-plan').textContent = state.schoolName;
                document.getElementById('report-program-name-plan').textContent = fieldsData[programKeyOnly].name;
                document.getElementById('report-program-details-name-plan').textContent = programData.name;
                document.getElementById('report-objective-plan').textContent = state.objective;
                document.getElementById('report-program-target-plan').textContent = programData.target;
                document.getElementById('report-teacher-name-plan').textContent = state.teacherName;
                document.getElementById('report-duration-plan').textContent = programData.duration;
                document.getElementById('report-location-plan').textContent = programData.location;
                document.getElementById('report-tools-plan').textContent = programData.tools;
                document.getElementById('report-learning-outcomes-plan').textContent = programData.learningOutcomes;
                document.getElementById('report-assessment-methods-plan').textContent = programData.assessmentMethods;
                document.getElementById('report-leader-name-plan').textContent = state.leaderName;
                document.getElementById('report-director-name-plan').textContent = state.directorName;
                document.getElementById('report-additional-achievements-plan').textContent = state.achievements;
                document.getElementById('report-strengths-plan').textContent = state.strengths;
                document.getElementById('report-difficulties-plan').textContent = state.difficulties;
                document.getElementById('report-remedial-actions-plan').textContent = state.remedialActions;

                const tableBody = document.getElementById('plan-table-body');
                tableBody.innerHTML = '';
                programData.details.forEach((session, index) => {
                    const date = state.planDates[index];
                    let weekName = session.week || '';
                    if (date && date !== 'يحدد لاحقًا') {
                         for (const key in activeWeeksData) { if (Object.values(activeWeeksData[key].days).includes(date.split(' ').slice(1).join(' '))) { weekName = activeWeeksData[key].name; break; }}
                    }
                    tableBody.innerHTML += `<tr><td>${weekName}</td><td>${date ? (date === 'يحدد لاحقًا' ? 'يحدد لاحقًا' : formatFullDate(date)) : 'لم يحدد'}</td><td>${session.title}</td><td>${session.content}</td></tr>`;
                });
                document.getElementById('setup-screen-plan').classList.add('hidden');
                document.getElementById('output-plan').classList.remove('hidden');
            }
            
            window.printContent = function(elementId) {
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('printable-active'));
                const elementToPrint = document.getElementById(elementId);
                if (elementToPrint && elementToPrint.parentElement.classList.contains('content-section')) {
                     elementToPrint.parentElement.classList.add('printable-active');
                }
                window.print();
            }

            function updateRegionUI() {
                const btnOther = document.getElementById('btn-region-other');
                const btnWestern = document.getElementById('btn-region-western');
                if (state.region === 'western') {
                    activeWeeksData = weeksDataWestern;
                    btnWestern.classList.add('bg-teal-600', 'text-white');
                    btnOther.classList.remove('bg-teal-600', 'text-white');
                } else {
                    activeWeeksData = weeksDataDefault;
                    btnOther.classList.add('bg-teal-600', 'text-white');
                    btnWestern.classList.remove('bg-teal-600', 'text-white');
                }
            }
            
            function initializeApp() {
                state = JSON.parse(localStorage.getItem('planGeneratorState')) || { region: 'other' };
                if (state.educationAdmin) document.getElementById('education-admin').value = state.educationAdmin;
                if (state.schoolName) document.getElementById('school-name').value = state.schoolName;
                if (state.teacherName) document.getElementById('teacher-name').value = state.teacherName;
                if (state.leaderName) document.getElementById('leader-name').value = state.leaderName;
                if (state.directorName) document.getElementById('director-name').value = state.directorName;
                if (state.achievements) document.getElementById('additional-achievements').value = state.achievements;
                if (state.strengths) document.getElementById('strengths').value = state.strengths;
                if (state.difficulties) document.getElementById('difficulties').value = state.difficulties;
                if (state.remedialActions) document.getElementById('remedial-actions').value = state.remedialActions;
                
                updateRegionUI();
                setupPlanTab();
                setupReportsTab();

                if(state.objective) {
                    setTimeout(() => { 
                        objectiveSelect.value = state.objective;
                    }, 100);
                }
            }
            
            initializeApp();
        });
    </script>
</body>
</html>

