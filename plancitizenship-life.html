<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مجال المواطنة والحياة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Sakkal Majalla';
            src: local('Sakkal Majalla'),
                 url('https://fonts.cdnfonts.com/s/72921/Sakkal Majalla.woff') format('woff');
        }

        @font-face {
            font-family: 'AL Mohanad';
            src: local('AL Mohanad'),
                 url('https://alfont.net/fonts/a-l-mohanad-340/AL-Mohanad-Light.woff') format('woff');
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f7fafc;
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            border-radius: 8px 8px 0 0;
            background-color: #e2e8f0;
            color: #4a5568;
        }
        .tab-button.active {
            border-color: #38a169;
            background-color: #ffffff;
            color: #2c7a7b;
            font-weight: 700;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 12mm 5mm;
            margin: 1cm auto;
            border: 1px #D1D5DB solid;
            border-radius: 5px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        .a4-page main {
            flex-grow: 1;
        }
        .report-label {
            color: #067693;
            background-color: #f0f9ff;
            font-weight: bold;
            padding: 8px;
            border-left: 4px solid #0891b2;
        }
        /* --- تعديل تنسيق الجداول --- */
        .table-bordered th, .table-bordered td {
            border: 1px solid #ddd;
            padding: 4px; /* تقليل الهوامش الداخلية */
            text-align: right;
            vertical-align: top;
            font-size: 0.8rem;
        }
        .table-bordered th {
            background-color: #2c5aa0;
            color: white;
        }
        /* ------------------------- */
        #date-picker-modal .week-grid .day.selected {
            background-color: #0d9488;
            color: white;
            border-color: #0f766e;
        }
        #date-picker-modal .week-grid .day.disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }
        .evaluation-table input[type="radio"], .evaluation-table input[type="checkbox"] {
            transform: scale(1.2);
        }

        .print-header-container, .print-footer-container {
            display: none;
        }

        .gradient-line {
            height: 5px;
            background: linear-gradient(to left, #28a745, #007bff);
            border-radius: 2.5px;
        }

        /* Responsive Styles for Mobile */
        @media screen and (max-width: 768px) {
            .container {
                padding-left: 0;
                padding-right: 0;
            }
            .a4-page {
                width: 100%;
                min-height: 0;
                padding: 16px;
                margin: 0;
                border: none;
                box-shadow: none;
            }
            .no-print, header.no-print {
                padding-left: 1rem;
                padding-right: 1rem;
            }
             h1 {
                font-size: 1.5rem; /* 24px */
            }
            .tab-button {
                font-size: 0.875rem; /* 14px */
                padding: 8px 12px;
            }
            .table-bordered {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            .a4-page .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            .flex-1 {
                 min-width: 0;
            }
            #output-plan footer .grid-cols-2, #output-report footer .grid-cols-2 {
                 grid-template-columns: repeat(1, minmax(0, 1fr));
                 gap: 1rem;
            }
        }

        /* --- PRINT STYLES --- */
        @page {
            size: A4 portrait;
            margin: 0.3cm;
        }

        @media print {
            .no-print {
                display: none !important;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            html, body {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                font-size: 8pt;
            }
            
            .container, .a4-page {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: 100% !important;
                width: 100% !important; 
                margin: 0 !important;
                border: none !important;
                padding: 1cm 5mm;
                page-break-inside: avoid;
                height: auto;
                min-height: 0;
            }
            
            .a4-page main {
                flex-grow: 1;
            }

            .content-section {
                display: none !important;
            }

            .content-section.printable-active {
                display: block !important;
            }
            
            /* --- توحيد تنسيق الجداول للطباعة --- */
            .table-bordered th, .table-bordered td {
                border: 1px solid #ddd !important;
                padding: 4px !important;
                font-size: 8pt;
                white-space: normal;
                word-wrap: break-word;
                vertical-align: top;
            }
            .table-bordered th {
                background-color: #0c7894 !important; /* اللون الجديد */
                color: white !important;
            }
            /* ---------------------------------- */

            textarea, input[type="text"] {
                overflow: hidden !important;
                height: auto !important;
                resize: none;
                border: none !important;
                background: transparent !important;
                padding: 0 !important; /* لضمان احتواء النص بالكامل */
                font-size: 8pt !important;
                color: #000 !important;
                font-family: inherit !important;
            }

            .report-label {
                background-color: #f0f9ff !important;
                color: #000 !important;
                border-left: 1px solid #000 !important;
            }

            .print-header-container, .print-footer-container {
                display: block !important;
            }
            
            h2 {
                font-size: 14pt;
                color: #000 !important;
            }
            
            .header img {
                height: 50px !important;
            }

            .image-upload-slot {
                height: 5cm;
                aspect-ratio: auto;
            }
            
            .image-upload-slot img {
                object-fit: contain;
            }
            
            .image-upload-slot:not(.has-image) {
                display: none !important;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-8 pb-4 border-b-2 border-teal-600 no-print">
            <div class="flex items-center gap-4">
                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                <div>
                    <h1 class="text-3xl font-bold text-teal-800">مجال المواطنة والحياة</h1>
                    <p class="text-slate-600">إدارة خطط وتقارير برامج المجال</p>
                </div>
            </div>
        </header>

        <div class="flex justify-center gap-2 mb-8 no-print">
            <button id="tab-btn-plan" class="tab-button active flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                خطة برامج النشاط
            </button>
            <button id="tab-btn-reports" class="tab-button flex items-center gap-2 text-lg py-3 px-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 17h20"></path><path d="M6 17v-7a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v7"></path><path d="M12 7V4H8v3"></path><path d="M18 17v-5a2 2 0 0 0-2-2h-4"></path></svg>
                التقارير
            </button>
        </div>

        <main>
            <div id="content-plan" class="content-section active">
                <div id="setup-screen-plan" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <input type="text" id="education-admin" placeholder="الإدارة التعليمية: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                            <input type="text" id="school-name" placeholder="المدرسة: ..." class="w-full p-3 border border-slate-300 rounded-lg">
                        </div>

                        <div class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">1. اختر المنطقة</h3>
                                    <div class="flex gap-3">
                                        <button id="btn-region-other" class="w-full p-3 border rounded-lg transition">باقي المناطق</button>
                                        <button id="btn-region-western" class="w-full p-3 border rounded-lg transition">المنطقة الغربية</button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">2. اختر المرحلة</h3>
                                    <select id="stage-select-plan" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <option value="">-- اختر مرحلة دراسية --</option>
                                        <option value="primary">الابتدائية (الأولية)</option>
                                        <option value="upper-primary">الابتدائية (العليا)</option>
                                        <option value="middle">المتوسطة</option>
                                        <option value="high-2">الثانوية</option>
                                    </select>
                                </div>
                            </div>
                             <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">3. اختر البرنامج</h3>
                                <div class="grid grid-cols-1 gap-4">
                                    <select id="program-select-plan" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                        <option value="">-- اختر البرنامج --</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">4. اختر الهدف من البرنامج</h3>
                                <select id="objective-select" class="w-full p-3 border border-slate-300 rounded-lg bg-slate-50" disabled>
                                    <option value="">-- اختر الهدف --</option>
                                </select>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">5. حدد تواريخ التنفيذ</h3>
                                    <button id="date-picker-btn" class="w-full p-3 border border-slate-300 rounded-lg text-right text-slate-500 hover:bg-slate-50 transition" disabled>اختر تواريخ الحصص</button>
                                    <div id="program-details-plan" class="border-2 border-teal-100 bg-teal-50/50 p-3 rounded-lg mt-4 text-sm min-h-[60px]"></div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-teal-700">6. أدخل البيانات الأساسية</h3>
                                    <div class="space-y-4">
                                        <input type="text" id="teacher-name" placeholder="المعلم/ة المنفذ/ة" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="leader-name" placeholder="رائد/ة النشاط: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                        <input type="text" id="director-name" placeholder="مدير/ة المدرسة: الاسم" class="w-full p-3 border border-slate-300 rounded-lg">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">7. تفاصيل إضافية (مقترحة)</h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <textarea id="additional-achievements" placeholder="الإنجازات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="strengths" placeholder="نقاط القوة" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="difficulties" placeholder="الصعوبات" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                    <textarea id="remedial-actions" placeholder="الإجراءات العلاجية" class="w-full p-3 border border-slate-300 rounded-lg h-24"></textarea>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold mb-3 text-teal-700">8. اختيار الخط</h3>
                                <select id="font-select" class="w-full p-3 border border-slate-300 rounded-lg">
                                    <option value="Tajawal">الخط الافتراضي (Tajawal)</option>
                                    <option value="Sakkal Majalla">Sakkal Majalla</option>
                                    <option value="AL Mohanad">AL Mohanad</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-10 text-center flex gap-4">
                            <button id="generate-plan-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg">إعداد الخطة للطباعة</button>
                             <button id="reset-plan-btn" class="w-auto bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition">إعادة تعيين</button>
                        </div>
                    </div>
                </div>

                <div id="output-plan" class="hidden">
                    <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-plan')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة الخطة</button>
                        <button onclick="document.getElementById('output-plan').classList.add('hidden'); document.getElementById('setup-screen-plan').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page">
                        <header class="mb-4">
                            <div class="flex justify-between items-center pb-2">
                                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                                <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                     <p id="report-education-admin-plan" class="font-bold"></p>
                                     <p id="report-school-name-plan" class="font-bold"></p>
                                </div>
                            </div>
                            <div class="gradient-line mt-2"></div>
                            <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">خطة تنفيذ برنامج النشاط الطلابي</h2>
                        </header>
                        <main>
                            <table class="w-full mb-4 text-sm border-collapse">
                                <tbody>
                                    <tr>
                                        <td class="report-label w-1/5">اسم البرنامج:</td>
                                        <td class="p-0 border border-slate-200 w-3/10"><textarea id="report-program-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label w-1/5">تفاصيل البرنامج:</td>
                                        <td class="p-0 border border-slate-200 w-3/10"><textarea id="report-program-details-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">الهدف من البرنامج:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-objective-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">الفئة المستهدفة:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-program-target-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">المعلم/ة المنفذ/ة:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-teacher-name-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">مدة التنفيذ:</td>
                                        <td class="p-0 border border-slate-200"><textarea id="report-duration-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label">مكان التنفيذ:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line"><textarea id="report-location-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                        <td class="report-label">أدوات التنفيذ:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line"><textarea id="report-tools-plan" class="w-full border-none p-2 resize-none" rows="1"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label align-top">نواتج التعلم:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3"><textarea id="report-learning-outcomes-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></td>
                                    </tr>
                                    <tr>
                                        <td class="report-label w-1/4">أساليب التقويم:</td>
                                        <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3"><textarea id="report-assessment-methods-plan" class="w-full border-none p-2 resize-none" rows="2"></textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w-full table-bordered mb-6">
                                <thead class="bg-teal-50 font-bold">
                                    <tr><th class="w-[15%]">الأسبوع</th><th class="w-[20%]">التاريخ</th><th class="w-[20%]">عنوان الحصة</th><th class="w-[30%]">المحتوى والإجراءات</th><th class="w-[15%]">الحالة</th></tr>
                                </thead>
                                <tbody id="plan-table-body"></tbody>
                            </table>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><h4 class="report-label mb-1">الإنجازات</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-additional-achievements-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">نقاط القوة</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-strengths-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">الصعوبات</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-difficulties-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                                <div><h4 class="report-label mb-1">الإجراءات العلاجية</h4><div class="p-0 border border-slate-200 min-h-[40px] whitespace-pre-wrap"><textarea id="report-remedial-actions-plan" class="w-full border-none p-2 resize-none" rows="3"></textarea></div></div>
                            </div>
                        </main>
                        <footer class="pt-8 text-center text-xs">
                            <div class="gradient-line mb-4"></div>
                            <div class="grid grid-cols-2 gap-16">
                                <div class="pt-2 mt-2"><p id="report-leader-name-plan" class="font-bold h-6"></p></div>
                                <div class="pt-2 mt-2"><p id="report-director-name-plan" class="font-bold h-6"></p></div>
                            </div>

                        </footer>
                    </div>
                </div>
            </div>

            <div id="content-reports" class="content-section">
                <div id="setup-screen-reports" class="no-print">
                    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg border border-slate-200">
                        <h2 class="text-2xl font-bold text-teal-800 mb-6">إعداد تقرير برنامج النشاط</h2>
                        <div class="grid md:grid-cols-2 gap-4">
                            <select id="stage-select-reports" class="w-full p-3 border border-slate-300 rounded-lg">
                                 <option value="">-- اختر المرحلة الدراسية --</option>
                            </select>
                            <select id="program-select-reports" class="w-full p-3 border border-slate-300 rounded-lg" disabled>
                                <option value="">-- اختر البرنامج --</option>
                            </select>
                        </div>
                        <div id="report-dates-display" class="mt-4 text-center text-slate-600 bg-slate-100 p-3 rounded-lg">اختر مرحلة وبرنامج لعرض التواريخ</div>
                         <div class="mt-6 text-center">
                            <button id="generate-report-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-10 rounded-lg hover:bg-teal-700 transition text-lg" disabled>إنشاء نموذج التقرير</button>
                        </div>
                    </div>
                </div>
                <div id="output-report" class="hidden">
                     <div class="text-center mb-6 no-print">
                        <button onclick="printContent('output-report')" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">🖨️ طباعة التقرير</button>
                        <button onclick="document.getElementById('output-report').classList.add('hidden'); document.getElementById('setup-screen-reports').classList.remove('hidden');" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition">🔄 العودة</button>
                    </div>
                    <div class="a4-page" id="report-page-content">
                        </div>
                </div>
            </div>

        </main>
    </div>
<footer class="text-center py-6 mt-12 border-t border-slate-200 no-print">
    <a href="https://www.rasmcom.com" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-3 text-sm text-gray-600 hover:text-teal-700 transition" style="text-decoration: none;">
        <img src="https://e.top4top.io/p_3463x5tj40.png" alt="شعار رسم" class="h-10 w-auto" style="height: 2.5rem; width: auto; border: none;">
        <span>جميع الحقوق محفوظة لقناة رسم للتصميم والخدمات التعليمية 2025</span>
    </a>
</footer>
    <div id="date-picker-modal" class="fixed inset-0 z-50 items-center justify-center p-4 bg-black bg-opacity-50 hidden no-print">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full">
            <h3 id="modal-title" class="text-xl font-bold mb-4">اختر تواريخ التنفيذ</h3>
            <div id="modal-weeks-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeDatePicker()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">إلغاء</button>
                <button onclick="saveDates()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">حفظ التواريخ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const programDefinitions = {
                'citizen_life': {
                    field: "المواطنة والحياة",
                    programs: {
                        'student_volunteering': "التطوع الطلابي",
                        'ambitious_skills': "مهارات طموحة",
                        'our_values': "قيمنا حياة"
                    }
                }
            };
            
            let fieldsData = {};
         
            fieldsData.student_volunteering = {
                name: "التطوع الطلابي",
                field: "المواطنة والحياة",
                stages: {
                    'primary': {
                        name: "برنامج التطوع الطلابي – الصفوف الأولية", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف الأولية", location: "فناء المدرسة / الفصل الدراسي", tools: "فيديو تعليمي، لوحات، شتلات زراعية، أدوات نظافة، تطبيقات رسم رقمية",
                        learningOutcomes: "• المشاركة في أنشطة تطوعية تعزز من قيم الولاء والانتماء.\n• التعاون مع زملائه في تخطيط وتنفيذ نشاط تطوعي بيئي.\n• تنفيذ مبادرات بيئية داخل الأسرة ويشاركها مع زملائه.\n• استخدام التوثيق الرقمي لأنشطة التشجير التطوعية.\n• المشاركة في إعداد رسائل توعوية للحفاظ على البيئة موجهة للجيران وللأصدقاء.",
                        assessmentMethods: "الملاحظة، ملف الإنجاز، المشاركة في الأنشطة",
                        details: [
                            { title: 'المشاركة في أنشطة تطوعية تعزز من قيم الولاء والانتماء', content: 'عرض فيديو تعليمي عن البيئة – شرح مفهوم البيئة وأهميته – أنشطة صفية (لوحات: ما يضر/ما ينفع البيئة).' },
                            { title: 'التعاون مع زملائه في تخطيط وتنفيذ نشاط تطوعي بيئي', content: 'تشكيل مجموعات (أصدقاء الأرض) – زراعة شتلات – نشاط عملي للنظافة – ترتيب الفصل.' },
                            { title: 'تنفيذ مبادرات بيئية داخل الأسرة ويشاركها مع زملائه', content: 'مشاركة الأسرة في تنظيف المنزل/الحديقة – رسم الأرض السعيدة – مناقشة أثر المبادرات الأسرية.' },
                            { title: 'استخدام التوثيق الرقمي لأنشطة التشجير التطوعية', content: 'استخدام تطبيقات رسم رقمية – توثيق الصور والأنشطة – إعداد ملف إنجاز (يوميات أصدقاء الأرض).' }
                        ],
                        achievements: "مشاركة الطلاب في أنشطة تطوعية مبسطة (تشجير – نظافة – رسم توعوي).\nتعاون جماعي في تكوين مجموعات \"أصدقاء الأرض\".\nتنفيذ مبادرات منزلية بمشاركة الأسرة (تنظيف الحديقة – إعادة التدوير).\nاستخدام الطلاب للتوثيق الرقمي (صور ورسومات).",
                        strengths: "حماس عالي لدى الطلاب للمشاركة في الأنشطة العملية.\nمشاركة الأسرة في دعم المبادرات.\nسهولة الأنشطة وارتباطها ببيئة الطفل.",
                        difficulties: "قلة وعي بعض الطلاب بمفهوم \"التطوع\".\nمحدودية مهاراتهم التقنية في التوثيق الرقمي.\nتباين مشاركة الأسر (البعض متفاعل والبعض أقل).",
                        remedial_actions: "تبسيط مفهوم \"التطوع\" عبر القصص المصورة.\nتدريب مبسط على استخدام تطبيق واحد فقط للتوثيق.\nتحفيز الأسر عبر رسائل تواصل منزلي (صور، ملاحظات)."
                    },
                    'upper-primary': {
                        name: "برنامج التطوع الطلابي – الصفوف العليا (الابتدائية العليا)", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف العليا", location: "المدرسة / الأسرة", tools: "فيديو تعليمي، حاسب آلي، تطبيقات رقمية",
                        learningOutcomes: "• التعبير عن تقديره لقيمة التعاون والمسؤولية الوطنية في مواقف مختلفة.\n• المشاركة في مناقشة قواعد تنظيم العمل الجماعي مع زملائه.\n• المشاركة في بعض المسؤوليات والأدوار في الأسرة، ويشاركها زملاؤه.\n• استخدام أدوات رقمية لتوثيق التجارب التطوعية ومشاركتها مع الآخرين لنشر ثقافة التطوع.\n• المشاركة في بعض المسؤوليات داخل المدرسة (الإشراف على النظام والانضباط، الإذاعة المدرسية، النظافة).",
                        assessmentMethods: "الملاحظة، تقييم الأداء، ملف الإنجاز الرقمي",
                        details: [
                            { title: 'قيمة التعاون والمسؤولية الوطنية', content: 'مشاهدة فيديو (فواز ونورة – التعاون/المسؤولية) – مناقشة قصة "قادة الغد".' },
                            { title: 'مناقشة قواعد تنظيم العمل الجماعي', content: 'تقسيم الطلاب إلى مجموعات – وضع قواعد تنظيم العمل – مناقشة أدوار القائد والأعضاء.' },
                            { title: 'المشاركة في بعض المسؤوليات والأدوار في الأسرة', content: 'سرد قصص قصيرة – تكليف عملي بمسؤوليات منزلية – مشاركة النتائج مع الزملاء.' },
                            { title: 'استخدام أدوات رقمية لتوثيق التجارب التطوعية', content: 'تدريب على استخدام الحاسب/التطبيقات – رفع وتوثيق صور مبادرات – مشاركة النتائج رقمياً.' },
                            { title: 'المشاركة في المسؤوليات داخل المدرسة', content: 'نشاط إشرافي (النظام/النظافة/الإذاعة) – تنظيم دوري بين الطلاب – توثيق النتائج.' },
                            { title: 'مبادرة "اصنع أثراً"', content: 'تخطيط وتنفيذ مبادرة صغيرة داخل المدرسة – مشاركة النتائج وعرض الأثر.' }
                        ],
                        achievements: "مناقشات جماعية حول قواعد العمل الجماعي.\nمشاركة الطلاب في الإذاعة المدرسية والنظام والنظافة.\nتنفيذ مبادرة \"اصنع أثراً\" داخل المدرسة.\nاستخدام أدوات رقمية لتوثيق التجارب.",
                        strengths: "وعي الطلاب بأهمية التعاون والمسؤولية الوطنية.\nمهارات تنظيم الأدوار وتقسيم العمل واضحة.\nوجود رغبة في إبراز أثر المبادرات.",
                        difficulties: "ضعف بعض الطلاب في الالتزام بالأدوار.\nتفاوت مستوى المهارة التقنية في التوثيق الرقمي.\nمحدودية الوقت المتاح لبعض المبادرات.",
                        remedial_actions: "وضع آلية متابعة دورية للأدوار داخل المجموعات.\nعقد ورش قصيرة لتدريب الطلاب على التوثيق الرقمي.\nتبسيط المبادرات بحيث تناسب وقت الحصة."
                    },
                    'middle': {
                        name: "برنامج التطوع الطلابي – المرحلة المتوسطة", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "المرحلة المتوسطة", location: "المدرسة / المنصات الرقمية", tools: "فيديوهات تعليمية، حاسب آلي، أدوات تصميم رقمي (عروض، مطويات)",
                        learningOutcomes: "• دور توعوي يعكس فهمًا لقيمة المواطنة الرقمية والالتزام بالسلوك الأخلاقي الآمن.\n• المشاركة في تعزيز مفهوم الأمان الرقمي مع زملائه.\n• المشاركة في التوعية عن مشكلة التنمر الإلكتروني وفي الحياة الواقعية وأضرارها على المجتمع.\n• إنتاج مواد تعريفية رقمية عن الاستخدام الفعال والآمن للتقنية.\n• تنظيم فعاليات تطوعية مدرسية عن الأمان الرقمي.",
                        assessmentMethods: "تقييم المنتجات الرقمية، الملاحظة، تقييم الحملات التوعوية",
                        details: [
                            { title: 'المواطنة الرقمية والسلوك الأخلاقي الآمن', content: 'عرض فيديوهات (المواطنة الرقمية/العطاء الرقمي) – نقاش حول الأمان الرقمي.' },
                            { title: 'تعزيز مفهوم الأمان الرقمي', content: 'تكوين مجموعات "سفراء الأمان الرقمي" – تصميم شعارات ورسائل توعوية.' },
                            { title: 'التوعية عن مشكلة التنمر الإلكتروني', content: 'عرض فيديوهات عن التنمر – مناقشة أشكاله وأضراره – نشاط توعوي مدرسي.' },
                            { title: 'إنتاج مواد تعريفية رقمية', content: 'إعداد مطويات/عروض رقمية – نشرها في المنصة/المدرسة – مشاركة المنتجات.' },
                            { title: 'تنظيم فعاليات مدرسية عن الأمان الرقمي', content: 'تنفيذ حملة مدرسية (ركن/لوحات/إذاعة) – مشاركة الأسرة والمجتمع المدرسي.' }
                        ],
                        achievements: "تكوين فرق \"سفراء الأمان الرقمي\".\nإنتاج مواد تعريفية رقمية (مطويات – عروض).\nتنفيذ فعاليات مدرسية للتوعية الرقمية.\nمناقشة التنمر الإلكتروني وأشكاله.",
                        strengths: "وعي الطلاب بقيمة المواطنة الرقمية.\nقدرة الطلاب على إنتاج محتوى رقمي إبداعي.\nتفاعلهم في الأنشطة الجماعية والحملات.",
                        difficulties: "ضعف بعض الطلاب في مهارات العرض الرقمي.\nصعوبة إيصال مفهوم \"المواطنة الرقمية\" للبعض.\nمحدودية الأجهزة/الاتصال أحيانًا.",
                        remedial_actions: "تدريب عملي قصير على استخدام برامج سهلة (Canva/Slides).\nتبسيط المصطلحات باستخدام قصص وأمثلة واقعية.\nتشجيع مشاركة العمل عبر مجموعات صغيرة باستخدام جهاز مشترك."
                    },
                    'high-2': {
                        name: "برنامج التطوع الطلابي – المرحلة الثانوية", sessions: 5, duration: "225 دقيقة (5 حصص)", target: "المرحلة الثانوية", location: "المدرسة / المجتمع المحلي", tools: "فيديوهات إثرائية، حاسب آلي، تطبيقات (Google Slides/Sheets, PowerPoint)",
                        learningOutcomes: "• المشاركة في أنشطة تطوعية تعزز من قيمة الإتقان والطموح.\n• تنفيذ مبادرات تطوعية ريادية في خدمة مجتمعهم، وتوظيف الثقافة المالية.\n• تنفيذ مشاريع ريادية تطوعية تعزز العلاقات الأسرية والمجتمعية انطلاقًا من إدراكه لمسؤوليته تجاه وطنه.\n• توظيف الأدوات والتطبيقات الرقمية في إدارة المشاريع الريادية التطوعية.\n• التعاون مع المدرسة في تعزيز الشراكة مع الأسرة أو المجتمع المحلي في سياق العمل الريادي التطوعي.",
                        assessmentMethods: "تقييم المشاريع الريادية، العروض التقديمية، الملاحظة",
                        details: [
                            { title: 'المشاركة في أنشطة تطوعية تعزز الإتقان والطموح', content: 'فيديو إثرائي عن ريادة الأعمال – نقاش مفهوم الإتقان والطموح – نشاط تصنيفي (ريادة/رتابة).' },
                            { title: 'تنفيذ مبادرات تطوعية ريادية', content: 'تكوين مجموعات تعاونية – توزيع أدوار (قائد/مالي/مصمم… إلخ) – اختيار فكرة مبادرة.' },
                            { title: 'مشاريع ريادية تعزز العلاقات الأسرية والمجتمعية', content: 'عرض قصص نجاح سعودية – تحليل التحديات – تصميم مشروع يخدم الأسرة/المجتمع.' },
                            { title: 'توظيف الأدوات والتطبيقات الرقمية', content: 'تدريب عملي على (Google Slides/Sheets – PowerPoint) – إعداد خطة مشروع رقمية.' },
                            { title: 'التعاون مع المدرسة في تعزيز الشراكة', content: 'عرض مشاريع المجموعات – نقاش مع الإدارة/المعلمين – مشاركة مع الأسرة/المجتمع.' }
                        ],
                        achievements: "تنفيذ مبادرات ريادية تطوعية (أسرية/مجتمعية).\nتدريب الطلاب على توظيف الأدوات الرقمية في إدارة المشاريع.\nمشاركة مع المدرسة لتعزيز الشراكة مع الأسرة والمجتمع.\nتقديم عروض للمشاريع الريادية.",
                        strengths: "وعي الطلاب بمسؤوليتهم المجتمعية.\nوجود مهارات قيادية وتقسيم أدوار واضحة.\nاستعداد عالي لاستخدام التقنية في التوثيق والإدارة.",
                        difficulties: "ضعف بعض الطلاب في مهارات التخطيط المالي للمشاريع.\nتفاوت مستوى القيادة داخل الفرق.\nالحاجة لدعم خارجي من المدرسة أو الأسرة لإنجاح بعض المبادرات.",
                        remedial_actions: "تدريب مبسط في الثقافة المالية (ميزانية مصغرة للمشروع).\nتعيين مشرف لكل فريق لمتابعة القائد والأعضاء.\nتوسيع الشراكة مع أولياء الأمور لدعم المشاريع."
                    }
                }
            };

            fieldsData.ambitious_skills = {
                name: "مهارات طموحة",
                field: "المواطنة والحياة",
                stages: {
                    'primary': {
                        name: "برنامج مهارات طموحة – الصفوف الأولية", sessions: 6, duration: "270 دقيقة (6 حصص)", target: "الصفوف الأولية", location: "الفصل الدراسي / قاعة النشاط", tools: "صور، خرائط، فيديوهات، تطبيقات رقمية بسيطة",
                        learningOutcomes: "• إعداد مواد بصرية تعبر عن اعتزازه برموز وطنه ومنجزاته المحلية والعالمية، في خدمة الحرمين الشريفين باستخدام وسائل متنوعة.\n• التمييز بين أنواع التعامل المالي في المواقف المختلفة.\n• التعبير بثقة عند الحديث عن منجزات وطنه.\n• توظيف مهارات استخدام الوسائل الرقمية عند المشاركة في النشاط الطلابي.\n• التعاون مع زملائه لتشكيل فريق وتحديد الأدوار لتنظيم وترتيب المعارض المدرسية.",
                        assessmentMethods: "الملاحظة، تقييم المواد البصرية، المشاركة في الأنشطة",
                        details: [
                            { title: 'مفهوم الوطن والمنجزات الوطنية', content: 'تعريف الوطن – عرض صور الرموز الوطنية – خريطة المملكة – مناقشة الانتماء.' },
                            { title: 'الأماكن المقدسة', content: 'عرض صور الحرمين والمشاعر – توضيح مفهوم الأماكن المقدسة – نقاش مبسط.' },
                            { title: 'منجزات الوطن في خدمة الحرمين', content: 'عرض فيديو/صور للتوسعات – مناقشة جهود المملكة في خدمة الحرمين.' },
                            { title: 'التعامل المالي', content: 'شرح مبسط للميزانية – أنشطة تمييز بين الضروري والكمالي – لعبة تعليمية.' },
                            { title: 'الوسائل الرقمية', content: 'تدريب على استخدام تطبيق بسيط لتوثيق النشاط – عرض مشاركات الطلاب.' },
                            { title: 'تنظيم معرض', content: 'تقسيم الطلاب إلى فرق – تحديد أدوار (عارض/مصور/منظم) – تنفيذ مصغر لمعرض.' }
                        ],
                        achievements: "تنظيم معرض مبسط بمشاركة الطلاب.\nاستخدام الوسائل الرقمية في عرض منجزاتهم.\nأنشطة ممتعة حول الوطن والحرمين.",
                        strengths: "حماس عالي لدى الطلاب للمشاركة في الأنشطة العملية.\nمشاركة الأسرة في دعم المبادرات.\nسهولة الأنشطة وارتباطها ببيئة الطفل.",
                        difficulties: "قلة وعي بعض الطلاب بمفهوم \"التطوع\".\nمحدودية مهاراتهم التقنية في التوثيق الرقمي.\nتباين مشاركة الأسر (البعض متفاعل والبعض أقل).",
                        remedial_actions: "تبسيط مفهوم \"التطوع\" عبر القصص المصورة.\nتدريب مبسط على استخدام تطبيق واحد فقط للتوثيق.\nتحفيز الأسر عبر رسائل تواصل منزلي (صور، ملاحظات)."
                    },
                    'upper-primary': {
                        name: "برنامج مهارات طموحة – الصفوف العليا", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف العليا", location: "الفصل الدراسي / مصادر التعلم", tools: "فيديو وصور، برامج تقنية لتوثيق الصوت",
                        learningOutcomes: "• التعبير عن اعتزاز المملكة بمواقفها العالمية في مساعدة الدول الشقيقة والصديقة بطرق متعددة.\n• استخدام مهارات التواصل اللفظي بكفاءة أثناء أداء النشاط الطلابي.\n• إظهار الثقة بنفسه أثناء تعبيره عن علاقاته الجيدة مع زملائه.\n• توظيف البرامج التقنية لتوثيق مشاركات زملائه الوطنية الصوتية.\n• تحديد المسؤوليات الفردية والجماعية عند أداء المهام التعاونية.",
                        assessmentMethods: "الملاحظة، تقييم الأداء الشفهي، تقييم المحتوى الرقمي",
                        details: [
                            { title: 'مساعدات المملكة للدول', content: 'عرض فيديو وصور لمساعدات السعودية – نقاش دور مركز الملك سلمان – نشاط “بذل وعطاء”.' },
                            { title: 'مواقف إغاثية سعودية', content: 'عرض قصص ومواقف حقيقية – تحليل دور المملكة الإنساني – نقاش جماعي.' },
                            { title: 'العمل التعاوني', content: 'تقسيم الطلاب إلى مجموعات – تحديد أدوار – إعداد محتوى يعزز قيمة البذل والعطاء.' },
                            { title: 'عرض نتاج المجموعات', content: 'تقديم أعمال المجموعات أمام الزملاء – توثيق صوتي/رقمي – تقييم الأداء.' }
                        ],
                        achievements: "عرض قصص واقعية عن مواقف المملكة الإنسانية.\nتنفيذ أنشطة جماعية تعاونية.\nتوثيق رقمي للأعمال الطلابية.",
                        strengths: "ارتفاع وعي الطلاب بمكانة المملكة عالميًا.\nمهارات التعاون والتواصل جيدة.\nقدرة على التعبير الكتابي والشفهي.",
                        difficulties: "ضعف بعض الطلاب في الثقة بالنفس أثناء العرض.\nتفاوت مشاركة الطلاب في الأدوار.",
                        remedial_actions: "تدريب على مهارات العرض والإلقاء.\nمتابعة أداء الأدوار وتبديلها بين الحصص."
                    },
                    'middle': {
                        name: "برنامج مهارات طموحة – المرحلة المتوسطة", sessions: 3, duration: "135 دقيقة (3 حصص)", target: "المرحلة المتوسطة", location: "الفصل الدراسي / قاعة النشاط", tools: "قصص وفيديوهات، وسائل رقمية",
                        learningOutcomes: "• المشاركة في توعية مجتمعه المدرسي حول قيم الأمانة والصدق والسلوك الوطني المسؤول عند التعاملات المالية.\n• استخدام التعلم الذاتي في اكتساب مهارات إدارة الميزانية الشهرية، ومشاركة ما تعلمه مع زملائه.\n• توظيف فهمه للثقافة المالية في مواقف متنوعة عبر النشاط الطلابي.\n• التوعية عن إدارة الميزانية الشهرية بمشاركة زملائه عبر التقنيات الحديثة.\n• المشاركة في تقديم حلول مقترحة لإدارة الميزانية الشهرية.",
                        assessmentMethods: "الملاحظة، المشاركة في النقاش، تقييم خطط الميزانية",
                        details: [
                            { title: 'الأمانة والصدق في التعامل المالي', content: 'عرض قصص وفيديوهات (الأمانة/الصدق) – نقاش دور الأخلاق في التعامل المالي.' },
                            { title: 'إدارة الميزانية الشهرية', content: 'تعريف المفاهيم (الإدارة – الميزانية – إدارة المصروفات) – نشاط الأظرف.' },
                            { title: 'تطبيقات عملية على الميزانية', content: 'مناقشة حلول مقترحة – تصميم خطة ميزانية – مشاركة عبر الوسائل الرقمية.' }
                        ],
                        achievements: "مناقشة الأمانة والصدق في التعامل المالي.\nإعداد خطط مبسطة لإدارة الميزانية الشهرية.\nتقديم حلول عملية باستخدام التقنية.",
                        strengths: "إدراك الطلاب لأهمية القيم في التعامل المالي.\nقدرتهم على تطبيق عملي عبر النشاط.",
                        difficulties: "ضعف بعض الطلاب في فهم مفهوم الميزانية.\nصعوبة ربط النظرية بالتطبيق.",
                        remedial_actions: "تبسيط مفهوم الميزانية عبر ألعاب تعليمية.\nتدريب عملي إضافي على خطط مصغرة (مصروف يومي/أسبوعي)."
                    },
                    'high-2': {
                        name: "برنامج مهارات طموحة – المرحلة الثانوية", sessions: 2, duration: "90 دقيقة (حصتان)", target: "المرحلة الثانوية", location: "قاعة النشاط / مصادر التعلم", tools: "فيديوهات، استبيانات، حاسب آلي",
                        learningOutcomes: "• التعبير عن وعيه بتأثير اختياراته المهنية في مستقبله ومستقبل وطنه.\n• مناقشة أثر اختيار التخصص الجامعي المناسب لقدراته واهتماماته على مستقبله، ودور ذلك في رفع كفاءته الوطنية.\n• التعبير عن أهمية الذكاء العاطفي ودوره في النجاح في البيئات الأكاديمية والحياتية والمهنية.\n• المشاركة مع زملائه في تحليل متطلبات سوق العمل، وتوظيف التقنية لنقل المعرفة بطرق مبتكرة.\n• تحليل متطلبات سوق العمل، واختيار التخصص الجامعي المناسب مع زملائه، وتوزيع الأدوار المختلفة عليهم.",
                        assessmentMethods: "المشاركة في النقاش، تقييم العروض التقديمية، تحليل الخطط",
                        details: [
                            { title: 'التخصص الجامعي وسوق العمل', content: '- نقاش تفاعلي حول أهمية اختيار التخصص المناسب. \n- نشاط (ما أحب؟ ما أجيد؟ ما قيمتي؟). \n- عرض قصص وتجارب واقعية لطلاب جامعيين أو موظفين. \n- نشاط جماعي: مطابقة التخصصات مع مجالات العمل.' },
                            { title: 'سوق العمل والمهارات المستقبلية', content: '- عرض فيديو قصير عن الذكاء العاطفي وأثره في النجاح. \n- تحليل متطلبات سوق العمل (محلي وعالمي). \n- ورشة عمل: تصميم خطة تخصص شخصية مرتبطة بسوق العمل. \n- تقديم العروض ومناقشتها ضمن مجموعات.' }
                        ],
                        achievements: "مناقشة التخصصات الجامعية وسوق العمل.\nعرض فيديوهات وتجارب ملهمة.\nإعداد خطط تخصصية وتقديم عروض جماعية.",
                        strengths: "وعي الطلاب بعلاقتهم بمستقبل الوطن.\nقدرة على استخدام التقنية في العروض.",
                        difficulties: "حيرة بعض الطلاب في تحديد اهتماماتهم.\nضعف فهم البعض لمتطلبات سوق العمل.",
                        remedial_actions: "تطبيق استبيانات ميول مهنية مبسطة.\nدعوة مختصين/خريجين لمشاركة تجاربهم."
                    }
                }
            };

            fieldsData.our_values = {
                name: "قيمنا حياة",
                field: "المواطنة والحياة",
                stages: {
                    'upper-primary': {
                        name: "برنامج قيمنا حياة – الصفوف العليا", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "الصفوف العليا", location: "الفصل / فناء المدرسة", tools: "أدوات ألعاب تعاونية، قصص نجاح، نماذج خطط يومية",
                        learningOutcomes: "• التعبير عن اعتزازه بالقيم الإسلامية والوطنية من خلال أنشطة عملية.\n• ممارسة مهارات التعاون – العزيمة – الأمانة – الانضباط في مواقف حياتية.\n• المشاركة في مشروعات طلابية تعزز الهوية الوطنية والانتماء.\n• توظيف الأدوات والتقنيات الحديثة لتوثيق الأنشطة القيمية.\n• إبراز أثر القيم في تحسين السلوك الفردي والجماعي داخل المدرسة وخارجها.",
                        assessmentMethods: "الملاحظة المباشرة، قوائم الشطب، متابعة التطبيق العملي",
                        details: [
                            { title: 'التعاون', content: 'نشاط جماعي (ألعاب تعاونية – تقسيم أدوار لإنجاز مهمة) – نقاش أثر التعاون في الأسرة والمدرسة.' },
                            { title: 'العزيمة', content: 'عرض قصة نجاح بسيطة – نقاش كيف يحقق الطالب هدفه – تكليف عملي صغير (إكمال مهمة).' },
                            { title: 'الأمانة', content: 'محاكاة مواقف (رد الأمانة – الصدق في القول والعمل) – مناقشة أثر الأمانة.' },
                            { title: 'الانضباط', content: 'مناقشة أهمية الالتزام بالوقت والنظام – نشاط “خطة يومي” – متابعة التطبيق.' }
                        ],
                        achievements: "ممارسة القيم (تعاون – عزيمة – أمانة – انضباط) بأنشطة عملية.\nمشاركة الطلاب في مشروعات جماعية تعزز الهوية الوطنية.\nتوثيق الأنشطة باستخدام التقنية.",
                        strengths: "ارتفاع تقبل الطلاب للقيم من خلال الأنشطة العملية.\nمشاركة فعّالة في الأنشطة الجماعية.",
                        difficulties: "صعوبة قياس أثر القيم مباشرة.\nضعف بعض الطلاب في ربط القيم بسلوكهم اليومي.",
                        remedial_actions: "متابعة فردية للطلاب من خلال مواقف حياتية.\nتحفيز الطلاب بأمثلة واقعية من حياتهم اليومية.\nاستخدام قصص نجاح لشخصيات وطنية ملهمة."
                    },
                    'middle': {
                        name: "برنامج قيمنا حياة – المرحلة المتوسطة", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "المرحلة المتوسطة", location: "قاعة النشاط / الفصل", tools: "دراسات حالة، فيديوهات، نماذج جداول يومية",
                        learningOutcomes: "• التعبير عن اعتزازه بالقيم الإسلامية والوطنية من خلال أنشطة عملية.\n• ممارسة مهارات التعاون – العزيمة – الأمانة – الانضباط في مواقف حياتية.\n• المشاركة في مشروعات طلابية تعزز الهوية الوطنية والانتماء.\n• توظيف الأدوات والتقنيات الحديثة لتوثيق الأنشطة القيمية.\n• إبراز أثر القيم في تحسين السلوك الفردي والجماعي داخل المدرسة وخارجها.",
                        assessmentMethods: "الملاحظة، المناقشات الجماعية، تقييم الخطط الشخصية",
                        details: [
                            { title: 'التعاون', content: 'نشاط جماعي (حل مشكلة مدرسية – تنظيم مهمة مشتركة) – نقاش النتائج.' },
                            { title: 'العزيمة', content: 'عرض قصص أو فيديو عن العزيمة – مناقشة التحديات – كتابة خطة قصيرة لهدف شخصي.' },
                            { title: 'الأمانة', content: 'دراسة حالة (الأمانة في الاختبارات أو المعاملات) – نقاش جماعي.' },
                            { title: 'الانضباط', content: 'ورشة صغيرة حول الانضباط في الدراسة والحياة – إعداد جدول يومي – عرض النتائج.' }
                        ],
                        achievements: "ممارسة القيم (تعاون – عزيمة – أمانة – انضباط) بأنشطة عملية.\nمشاركة الطلاب في مشروعات جماعية تعزز الهوية الوطنية.\nتوثيق الأنشطة باستخدام التقنية.",
                        strengths: "ارتفاع تقبل الطلاب للقيم من خلال الأنشطة العملية.\nمشاركة فعّالة في الأنشطة الجماعية.",
                        difficulties: "صعوبة قياس أثر القيم مباشرة.\nضعف بعض الطلاب في ربط القيم بسلوكهم اليومي.",
                        remedial_actions: "متابعة فردية للطلاب من خلال مواقف حياتية.\nتحفيز الطلاب بأمثلة واقعية من حياتهم اليومية.\nاستخدام قصص نجاح لشخصيات وطنية ملهمة."
                    },
                    'high-2': {
                        name: "برنامج قيمنا حياة – المرحلة الثانوية", sessions: 4, duration: "180 دقيقة (4 حصص)", target: "المرحلة الثانوية", location: "قاعة النشاط / المدرسة", tools: "أدوات تنظيم فعاليات، حاسب آلي، تطبيقات رقمية",
                        learningOutcomes: "• التعبير عن اعتزازه بالقيم الإسلامية والوطنية من خلال أنشطة عملية.\n• ممارسة مهارات التعاون – العزيمة – الأمانة – الانضباط في مواقف حياتية.\n• المشاركة في مشروعات طلابية تعزز الهوية الوطنية والانتماء.\n• توظيف الأدوات والتقنيات الحديثة لتوثيق الأنشطة القيمية.\n• إبراز أثر القيم في تحسين السلوك الفردي والجماعي داخل المدرسة وخارجها.",
                        assessmentMethods: "تقييم الفعاليات، تقييم الخطط الشخصية، العروض التقديمية",
                        details: [
                            { title: 'التعاون', content: 'نشاط جماعي (تنظيم فعالية أو حملة صغيرة) – نقاش أثر التعاون على المجتمع.' },
                            { title: 'العزيمة', content: 'ورشة نقاشية حول أهداف شخصية وأكاديمية – كتابة خطة عمل – متابعة التنفيذ.' },
                            { title: 'الأمانة', content: 'نقاش حالات حياتية (الأمانة العلمية – الأمانة المالية) – إعداد عرض قصير.' },
                            { title: 'الانضباط', content: 'تصميم خطة انضباط ذاتي (وقت الدراسة – الالتزام بالأنشطة) – عرض وتوثيق رقمي.' }
                        ],
                        achievements: "ممارسة القيم (تعاون – عزيمة – أمانة – انضباط) بأنشطة عملية.\nمشاركة الطلاب في مشروعات جماعية تعزز الهوية الوطنية.\nتوثيق الأنشطة باستخدام التقنية.",
                        strengths: "ارتفاع تقبل الطلاب للقيم من خلال الأنشطة العملية.\nمشاركة فعّالة في الأنشطة الجماعية.",
                        difficulties: "صعوبة قياس أثر القيم مباشرة.\nضعف بعض الطلاب في ربط القيم بسلوكهم اليومي.",
                        remedial_actions: "متابعة فردية للطلاب من خلال مواقف حياتية.\nتحفيز الطلاب بأمثلة واقعية من حياتهم اليومية.\nاستخدام قصص نجاح لشخصيات وطنية ملهمة."
                    }
                }
            };

            const weeksDataDefault = {
                'week1': { name: 'الأسبوع الأول', days: { 'الأحد': '1 / 3', 'الاثنين': '2 / 3', 'الثلاثاء': '3 / 3', 'الأربعاء': '4 / 3', 'الخميس': '5 / 3' } },
                'week2': { name: 'الأسبوع الثاني', days: { 'الأحد': '8 / 3', 'الاثنين': '9 / 3', 'الثلاثاء': '10 / 3', 'الأربعاء': '11 / 3', 'الخميس': '12 / 3' } },
                'week3': { name: 'الأسبوع الثالث', days: { 'الأحد': '15 / 3', 'الاثنين': '16 / 3', 'الثلاثاء': '17 / 3', 'الأربعاء': '18 / 3', 'الخميس': '19 / 3' } },
                'week4': { name: 'الأسبوع الرابع', days: { 'الأحد': '22 / 3', 'الاثنين': '23 / 3', 'الثلاثاء': '24 / 3', 'الأربعاء': '25 / 3', 'الخميس': '26 / 3' } },
                'week5': { name: 'الأسبوع الخامس', days: { 'الأحد': '29 / 3', 'الاثنين': '30 / 3', 'الثلاثاء': '1 / 4', 'الأربعاء': '2 / 4', 'الخميس': '3 / 4' }, specialDays: { '1 / 4': { name: 'إجازة' } } },
                'week6': { name: 'الأسبوع السادس', days: { 'الأحد': '6 / 4', 'الاثنين': '7 / 4', 'الثلاثاء': '8 / 4', 'الأربعاء': '9 / 4', 'الخميس': '10 / 4' } },
                'week7': { name: 'الأسبوع السابع', days: { 'الأحد': '13 / 4', 'الاثنين': '14 / 4', 'الثلاثاء': '15 / 4', 'الأربعاء': '16 / 4', 'الخميس': '17 / 4' } },
                'week8': { name: 'الأسبوع الثامن', days: { 'الأحد': '20 / 4', 'الاثنين': '21 / 4', 'الثلاثاء': '22 / 4', 'الأربعاء': '23 / 4', 'الخميس': '24 / 4' }, specialDays: { '20 / 4': { name: 'إجازة إضافية' } } },
                'week9': { name: 'الأسبوع التاسع', days: { 'الأحد': '27 / 4', 'الاثنين': '28 / 4', 'الثلاثاء': '29 / 4', 'الأربعاء': '30 / 4', 'الخميس': '1 / 5' } },
                'week10': { name: 'الأسبوع العاشر', days: { 'الأحد': '4 / 5', 'الاثنين': '5 / 5', 'الثلاثاء': '6 / 5', 'الأربعاء': '7 / 5', 'الخميس': '8 / 5' } },
                'week11': { name: 'الأسبوع الحادي عشر', days: { 'الأحد': '11 / 5', 'الاثنين': '12 / 5', 'الثلاثاء': '13 / 5', 'الأربعاء': '14 / 5', 'الخميس': '15 / 5' } },
                'week12': { name: 'الأسبوع الثاني عشر', days: { 'الأحد': '18 / 5', 'الاثنين': '19 / 5', 'الثلاثاء': '20 / 5', 'الأربعاء': '21 / 5', 'الخميس': '22 / 5' } },
                'week13': { name: 'الأسبوع الثالث عشر', days: { 'الأحد': '25 / 5', 'الاثنين': '26 / 5', 'الثلاثاء': '27 / 5', 'الأربعاء': '28 / 5', 'الخميس': '29 / 5' } },
                'week14': { name: 'الأسبوع الرابع عشر', days: { 'الأحد': '9 / 6', 'الاثنين': '10 / 6', 'الثلاثاء': '11 / 6', 'الأربعاء': '12 / 6', 'الخميس': '13 / 6' } },
                'week15': { name: 'الأسبوع الخامس عشر', days: { 'الأحد': '16 / 6', 'الاثنين': '17 / 6', 'الثلاثاء': '18 / 6', 'الأربعاء': '19 / 6', 'الخميس': '20 / 6' }, specialDays: { '20 / 6': { name: 'إجازة إضافية' } } },
                'week16': { name: 'الأسبوع السادس عشر', days: { 'الأحد': '23 / 6', 'الاثنين': '24 / 6', 'الثلاثاء': '25 / 6', 'الأربعاء': '26 / 6', 'الخميس': '27 / 6' }, specialDays: { '23 / 6': { name: 'إجازة إضافية' } } },
                'week17': { name: 'الأسبوع السابع عشر', days: { 'الأحد': '1 / 7', 'الاثنين': '2 / 7', 'الثلاثاء': '3 / 7', 'الأربعاء': '4 / 7', 'الخميس': '5 / 7' } },
                'week18': { name: 'الأسبوع الثامن عشر', days: { 'الأحد': '8 / 7', 'الاثنين': '9 / 7', 'الثلاثاء': '10 / 7', 'الأربعاء': '11 / 7', 'الخميس': '12 / 7' } }
            };

            const weeksDataWestern = {
                'week1': { name: 'الأسبوع الأول', days: { 'الأحد': '8 / 3', 'الاثنين': '9 / 3', 'الثلاثاء': '10 / 3', 'الأربعاء': '11 / 3', 'الخميس': '12 / 3' } },
                'week2': { name: 'الأسبوع الثاني', days: { 'الأحد': '15 / 3', 'الاثنين': '16 / 3', 'الثلاثاء': '17 / 3', 'الأربعاء': '18 / 3', 'الخميس': '19 / 3' } },
                'week3': { name: 'الأسبوع الثالث', days: { 'الأحد': '22 / 3', 'الاثنين': '23 / 3', 'الثلاثاء': '24 / 3', 'الأربعاء': '25 / 3', 'الخميس': '26 / 3' } },
                'week4': { name: 'الأسبوع الرابع', days: { 'الأحد': '29 / 3', 'الاثنين': '30 / 3', 'الثلاثاء': '1 / 4', 'الأربعاء': '2 / 4', 'الخميس': '3 / 4' }, specialDays: { '1 / 4': { name: 'إجازة' } } },
                'week5': { name: 'الأسبوع الخامس', days: { 'الأحد': '6 / 4', 'الاثنين': '7 / 4', 'الثلاثاء': '8 / 4', 'الأربعاء': '9 / 4', 'الخميس': '10 / 4' } },
                'week6': { name: 'الأسبوع السادس', days: { 'الأحد': '13 / 4', 'الاثنين': '14 / 4', 'الثلاثاء': '15 / 4', 'الأربعاء': '16 / 4', 'الخميس': '17 / 4' } },
                'week7': { name: 'الأسبوع السابع', days: { 'الأحد': '20 / 4', 'الاثنين': '21 / 4', 'الثلاثاء': '22 / 4', 'الأربعاء': '23 / 4', 'الخميس': '24 / 4' }, specialDays: { '20 / 4': { name: 'إجازة إضافية' } } },
                'week8': { name: 'الأسبوع الثامن', days: { 'الأحد': '27 / 4', 'الاثنين': '28 / 4', 'الثلاثاء': '29 / 4', 'الأربعاء': '30 / 4', 'الخميس': '1 / 5' } },
                'week9': { name: 'الأسبوع التاسع', days: { 'الأحد': '4 / 5', 'الاثنين': '5 / 5', 'الثلاثاء': '6 / 5', 'الأربعاء': '7 / 5', 'الخميس': '8 / 5' } },
                'week10': { name: 'الأسبوع العاشر', days: { 'الأحد': '11 / 5', 'الاثنين': '12 / 5', 'الثلاثاء': '13 / 5', 'الأربعاء': '14 / 5', 'الخميس': '15 / 5' } },
                'week11': { name: 'الأسبوع الحادي عشر', days: { 'الأحد': '18 / 5', 'الاثنين': '19 / 5', 'الثلاثاء': '20 / 5', 'الأربعاء': '21 / 5', 'الخميس': '22 / 5' } },
                'week12': { name: 'الأسبوع الثاني عشر', days: { 'الأحد': '25 / 5', 'الاثنين': '26 / 5', 'الثلاثاء': '27 / 5', 'الأربعاء': '28 / 5', 'الخميس': '29 / 5' } },
                'week13': { name: 'الأسبوع الثالث عشر', days: { 'الأحد': '9 / 6', 'الاثنين': '10 / 6', 'الثلاثاء': '11 / 6', 'الأربعاء': '12 / 6', 'الخميس': '13 / 6' } },
                'week14': { name: 'الأسبوع الرابع عشر', days: { 'الأحد': '16 / 6', 'الاثنين': '17 / 6', 'الثلاثاء': '18 / 6', 'الأربعاء': '19 / 6', 'الخميس': '20 / 6' }, specialDays: { '20 / 6': { name: 'إجازة إضافية' } } },
                'week15': { name: 'الأسبوع الخامس عشر', days: { 'الأحد': '23 / 6', 'الاثنين': '24 / 6', 'الثلاثاء': '25 / 6', 'الأربعاء': '26 / 6', 'الخميس': '27 / 6' }, specialDays: { '23 / 6': { name: 'إجازة إضافية' } } },
                'week16': { name: 'الأسبوع السادس عشر', days: { 'الأحد': '1 / 7', 'الاثنين': '2 / 7', 'الثلاثاء': '3 / 7', 'الأربعاء': '4 / 7', 'الخميس': '5 / 7' } },
                'week17': { name: 'الأسبوع السابع عشر', days: { 'الأحد': '8 / 7', 'الاثنين': '9 / 7', 'الثلاثاء': '10 / 7', 'الأربعاء': '11 / 7', 'الخميس': '12 / 7' } }
            };
            
            let activeWeeksData = weeksDataDefault;
            let tempSelectedDates = [];
            let state = {};

            const tabButtons = document.querySelectorAll('.tab-button');
            const contentSections = document.querySelectorAll('.content-section');
            const stageSelectPlan = document.getElementById('stage-select-plan');
            const programSelectPlan = document.getElementById('program-select-plan');
            const objectiveSelect = document.getElementById('objective-select');
            const datePickerBtn = document.getElementById('date-picker-btn');
            const stageSelectReports = document.getElementById('stage-select-reports');
            const programSelectReports = document.getElementById('program-select-reports');
            const generateReportBtn = document.getElementById('generate-report-btn');
            const fontSelect = document.getElementById('font-select');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(sec => sec.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.id.replace('tab-btn-', 'content-')).classList.add('active');
                });
            });

            function populateStages(selectElement) {
                const stages = { 'primary': 'الابتدائية (الأولية)', 'upper-primary': 'الابتدائية (العليا)', 'middle': 'المتوسطة', 'high-2': 'الثانوية' };
                selectElement.innerHTML = '<option value="">-- اختر المرحلة الدراسية --</option>';
                for (const key in stages) {
                    selectElement.innerHTML += `<option value="${key}">${stages[key]}</option>`;
                }
            }

            function populateProgramsByStage(stage, programSelectElement, useGenericName = false) {
                programSelectElement.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                programSelectElement.disabled = true;
                if (!stage) return;
                
                Object.entries(fieldsData).forEach(([progKey, progData]) => {
                    if (progData.stages && progData.stages[stage]) {
                        const option = document.createElement('option');
                        option.value = `${progKey}|${stage}`;
                        option.textContent = useGenericName ? progData.name : (progData.stages[stage].name || progData.name);
                        programSelectElement.appendChild(option);
                    }
                });
                programSelectElement.disabled = false;
            }

            function setupPlanTab() {
                stageSelectPlan.addEventListener('change', () => {
                    const stage = stageSelectPlan.value;
                    programSelectPlan.innerHTML = '<option value="">-- اختر البرنامج --</option>';
                    objectiveSelect.innerHTML = '<option value="">-- اختر الهدف --</option>';
                    objectiveSelect.disabled = true;
                    document.getElementById('program-details-plan').innerHTML = '';
                    datePickerBtn.disabled = true;
                    
                    if (!stage) {
                        programSelectPlan.disabled = true;
                        return;
                    }

                    const citizenField = "المواطنة والحياة";
                    Object.entries(fieldsData).forEach(([key, program]) => {
                        if (program.field === citizenField && program.stages[stage]) {
                            programSelectPlan.innerHTML += `<option value="${key}">${program.name}</option>`;
                        }
                    });
                    programSelectPlan.disabled = false;

                    const objectives = { 
                        'تعزيز المدرسة للشراكة المجتمعية': '١- تعزيز المدرسة للشراكة المجتمعية',
                        'دعم الأنشطة الطلابية للسلوك الإيجابي': '٢- دعم الأنشطة الطلابية للسلوك الإيجابي',
                        'تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية': '٣- تعزيز مشاركة أولياء الأمور في الأنشطة الطلابية',
                        'زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة': '٤- زيادة جاذبية البيئة المدرسية رضى الطالب عن الحياة',
                        'تعزيز الأنشطة الطلابية للانضباط المدرسي': '٥- تعزيز الأنشطة الطلابية للانضباط المدرسي',
                        'أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين': '٦- أنشطة تعلم تطبيقية ترتبط بحياة المتعلمين',
                        'تحسين الأنشطة الطلابية لنواتج التعلم': '٧- تحسين الأنشطة الطلابية لنواتج التعلم',
                        'اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي': '٨- اعتزاز الطلبة بثقافتهم واحترامهم للتنوع الثقافي',
                        'تفعيل المناسبات الوطنية والأسابيع والأيام العالمية': '٩- تفعيل المناسبات الوطنية والأسابيع والأيام العالمية'
                    };
                    for (const [value, text] of Object.entries(objectives)) {
                        objectiveSelect.innerHTML += `<option value="${value}">${text}</option>`;
                    }
                });
                
                programSelectPlan.addEventListener('change', () => {
                    state.programKey = programSelectPlan.value;
                    state.stage = stageSelectPlan.value;
                    state.planDates = [];
                    updateProgramDisplay();
                });


                 ['btn-region-other', 'btn-region-western'].forEach(id => document.getElementById(id).addEventListener('click', (e) => { state.region = id.includes('other') ? 'other' : 'western'; updateRegionUI(); }));
                datePickerBtn.addEventListener('click', () => openDatePicker());
                document.getElementById('reset-plan-btn').addEventListener('click', () => { if(confirm('هل أنت متأكد؟ سيتم حذف جميع البيانات المدخلة.')) { localStorage.removeItem('planGeneratorState'); location.reload(); }});
                document.getElementById('generate-plan-btn').addEventListener('click', generatePlan);
                fontSelect.addEventListener('change', (e) => {
                    document.body.style.fontFamily = e.target.value;
                    state.fontFamily = e.target.value;
                    saveState();
                });
            }

             function updateProgramDisplay() {
                if (!state.programKey || !state.stage) return;
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                document.getElementById('program-details-plan').innerHTML = `<p><strong class="font-semibold">البرنامج:</strong> ${programData.name}</p><p><strong class="font-semibold">عدد الحصص المقترح:</strong> ${programData.sessions} حصص</p>`;
                objectiveSelect.disabled = false;
                if (programData.duration && (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة"))) {
                    datePickerBtn.disabled = true;
                    datePickerBtn.textContent = 'البرنامج مستمر أو بمدة مرنة';
                    state.planDates = programData.details.map(d => d.date);
                } else {
                    datePickerBtn.disabled = false;
                    updateDatePickerButton();
                }
                ['strengths', 'difficulties', 'remedial_actions', 'achievements'].forEach(key => { 
                    const elementId = key === 'achievements' ? 'additional-achievements' : key.replace('_', '-');
                    const element = document.getElementById(elementId);
                    if (element) element.value = programData[key] || ''; 
                });
            }

            function updateDatePickerButton() {
                if (!state.programKey || !state.stage) { datePickerBtn.textContent = 'اختر تواريخ الحصص'; return; }
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly].stages[state.stage];
                if (!programData) return;
                const count = state.planDates ? state.planDates.filter(d => d !== 'يحدد لاحقًا').length : 0;
                datePickerBtn.textContent = `اختر تواريخ الحصص (${count} / ${programData.sessions})`;
            }

            function setupReportsTab() {
                populateStages(stageSelectReports);
                stageSelectReports.addEventListener('change', () => {
                    populateProgramsByStage(stageSelectReports.value, programSelectReports, true);
                    generateReportBtn.disabled = true;
                    document.getElementById('report-dates-display').textContent = 'اختر مرحلة وبرنامج لعرض التواريخ';
                });
                programSelectReports.addEventListener('change', () => {
                    generateReportBtn.disabled = !programSelectReports.value;
                    const datesDisplay = document.getElementById('report-dates-display');
                    const [progKey, stageKey] = programSelectReports.value.split('|');
                    const programDefinition = fieldsData[progKey];

                    if (programDefinition && programDefinition.isPlaceholder) {
                        datesDisplay.textContent = 'هذا البرنامج سيتم تحديثه لاحقًا.';
                        datesDisplay.classList.add('text-red-500');
                        generateReportBtn.disabled = true; // Can't generate report for placeholder
                        return;
                    }
                    
                    if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                        state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                        const dateRange = `تواريخ الخطة المحددة: من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                        datesDisplay.textContent = dateRange;
                        datesDisplay.classList.remove('text-red-500');
                    } else {
                        datesDisplay.textContent = 'ملاحظة: لم يتم تحديد تواريخ تنفيذ في تبويب الخطة أو أن البرنامج مستمر. سيظهر التاريخ فارغاً في التقرير.';
                        datesDisplay.classList.add('text-red-500');
                    }
                });
                generateReportBtn.addEventListener('click', generateReport);
            }
            
            function generateReport() {
                const [progKey, stageKey] = programSelectReports.value.split('|');
                const programData = fieldsData[progKey].stages[stageKey];
                const leaderName = document.getElementById('leader-name').value;
                const directorName = document.getElementById('director-name').value;
                const educationAdmin = document.getElementById('education-admin').value;
                const schoolName = document.getElementById('school-name').value;

                let dateRange = "لم يتم تحديد التواريخ في الخطة";
                if (state.planDates && state.planDates.length > 0 && !state.planDates.includes('يحدد لاحقًا')) {
                     state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                     dateRange = `من ${formatFullDate(state.planDates[0])} إلى ${formatFullDate(state.planDates[state.planDates.length - 1])}`;
                } else if (programData.duration && (programData.duration.includes("العام الدراسي") || programData.duration.includes("مرنة"))) {
                    dateRange = "على مدار العام الدراسي أو بمدة مرنة";
                }
                
                const locationLines = (programData.location.match(/\n/g) || []).length + 1;

                const reportHTML = `
                    <header class="mb-4">
                        <div class="flex justify-between items-center pb-2">
                            <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="شعار وزارة التعليم" class="h-20">
                            <div class="flex-1 mr-4 space-y-2 text-base text-right">
                                <p class="font-bold">${educationAdmin}</p>
                                <p class="font-bold">${schoolName}</p>
                            </div>
                        </div>
                        <div class="gradient-line mt-2"></div>
                        <h2 class="text-2xl font-bold text-teal-800 text-center mt-4">تقرير تنفيذ برنامج نشاط</h2>
                    </header>
                    <main>
                        <h3 class="text-xl font-bold mb-3 text-teal-700 text-center">${programData.name}</h3>
                        <table class="w-full mb-4 text-sm border-collapse table-bordered">
                            <tbody>
                                <tr><td class="font-bold bg-slate-50 w-1/5">المرحلة:</td><td colspan="3"><textarea id="report-stage-report" class="w-full border-none p-2 resize-none" rows="1">${stageSelectReports.options[stageSelectReports.selectedIndex].text}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">الهدف من البرنامج:</td><td colspan="3"><textarea id="report-objective-report" class="w-full border-none p-2 resize-none" rows="1">${state.objective || 'لم يحدد في الخطة'}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">تاريخ التنفيذ:</td><td><textarea id="report-date-report" class="w-full border-none p-2 resize-none" rows="1">${dateRange}</textarea></td><td class="font-bold bg-slate-50 w-1/5">مكان التنفيذ:</td><td><textarea id="report-location-report" rows="${locationLines}" oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' class="w-full border-none p-1 bg-transparent" style="overflow-y:hidden; resize:none;">${programData.location}</textarea></td></tr>
                                <tr><td class="font-bold bg-slate-50 w-1/5">عدد الطلاب المستفيدين:</td><td><input type="text" class="w-full border-none p-1" placeholder="للتعبئة"></td><td class="font-bold bg-slate-50 w-1/5">المعلم/ة المنفذ/ة:</td><td><input type="text" class="w-full border-none p-1" value="${document.getElementById('teacher-name').value}"></td></tr>
                                <tr>
                                    <td class="report-label align-top">نواتج التعلم:</td>
                                    <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3">
                                        <textarea id="report-learning-outcomes-report" class="w-full border-none p-2 resize-none" rows="3">${programData.learningOutcomes}</textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="report-label align-top">إجراءات التنفيذ (ملخص):</td>
                                    <td class="p-0 border border-slate-200 whitespace-pre-line" colspan="3">
                                        <textarea id="report-details-report" class="w-full border-none p-2 resize-none" rows="3">${programData.details.map(d => `- ${d.content}`).join('\n')}</textarea>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="space-y-4 text-sm">
                            <div>
                                <h4 class="report-label mb-1 mt-8">صور للشواهد</h4>
                                <div id="image-upload-grid" class="grid grid-cols-3 gap-4 mt-2">
                                    ${Array(6).fill(0).map((_, i) => `
                                        <div class="aspect-square border-2 border-dashed rounded-lg flex items-center justify-center text-slate-400 relative image-upload-slot">
                                            <label for="image-input-${i}" class="cursor-pointer absolute inset-0 flex flex-col items-center justify-center z-10">
                                                <svg class="w-8 h-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg><span>إضافة صورة ${i + 1}</span></label>
                                            <input type="file" id="image-input-${i}" class="hidden" accept="image/*" onchange="previewImage(event, 'image-preview-${i}')">
                                            <img id="image-preview-${i}" class="absolute inset-0 w-full h-full object-cover rounded-lg hidden z-0">
                                        </div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer class="pt-8 text-center text-xs">
                        <div class="gradient-line mb-4"></div>
                        <div class="grid grid-cols-2 gap-16">
                            <div class="pt-2 mt-2"><p id="report-leader-name-report" class="font-bold h-6">${leaderName}</p></div>
                            <div class="pt-2 mt-2"><p id="report-director-name-report" class="font-bold h-6">${directorName}</p></div>
                        </div>
                    </footer>`;
                document.getElementById('report-page-content').innerHTML = reportHTML;
                document.getElementById('setup-screen-reports').classList.add('hidden');
                document.getElementById('output-report').classList.remove('hidden');

                // Auto-resize all textareas in the report
                document.querySelectorAll('#report-page-content textarea').forEach(textarea => {
                    autoGrowTextarea(textarea);
                    textarea.addEventListener('input', () => autoGrowTextarea(textarea));
                });
            }
            
            const parseDateForSorting = (dateString) => { const parts = dateString.split(' '); return parseInt(parts[3], 10) * 100 + parseInt(parts[1], 10); };
            const formatFullDate = (dateString) => { const p = dateString.split(' '); return `${p[1].padStart(2, '0')} / ${p[3].padStart(2, '0')} / 1447 هـ`; };
            const saveState = () => { 
                state.objective = objectiveSelect.value; 
                localStorage.setItem('planGeneratorState', JSON.stringify(state)); 
            };
            
            function autoGrowTextarea(element) {
                element.style.height = "auto";
                element.style.height = (element.scrollHeight) + "px";
            }

            window.previewImage = function(event, imgId) {
                const img = document.getElementById(imgId);
                const input = event.target;
                const slot = input.closest('.image-upload-slot');
                const label = slot.querySelector('label');
                if (input.files && input.files[0]) {
                    img.src = URL.createObjectURL(input.files[0]);
                    img.classList.remove('hidden');
                    label.classList.add('opacity-0', 'hover:opacity-75', 'hover:bg-black/50');
                    label.querySelector('span').textContent = 'تغيير الصورة';
                    slot.classList.add('has-image');
                }
            }
            window.openDatePicker = function() {
                const modal = document.getElementById('date-picker-modal');
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData) return;
                tempSelectedDates = [...(state.planDates || [])].filter(d => d !== 'يحدد لاحقًا');
                const container = document.getElementById('modal-weeks-container');
                container.innerHTML = '';
                document.getElementById('modal-title').textContent = `اختر ${programData.sessions} حصص لبرنامج: ${programData.name}`;
                Object.values(activeWeeksData).forEach(weekData => {
                    const weekDiv = document.createElement('div');
                    weekDiv.className = 'p-2 border rounded-md';
                    weekDiv.innerHTML = `<p class="font-semibold text-center mb-2">${weekData.name}</p>`;
                    const weekGrid = document.createElement('div');
                    weekGrid.className = 'week-grid grid grid-cols-5 gap-2';
                    Object.entries(weekData.days).forEach(([dayName, dayDate]) => {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'day p-2 border rounded-md text-sm';
                        const fullDate = `${dayName} ${dayDate}`;
                        dayButton.dataset.date = fullDate;
                        let buttonText = `${dayName}<br>${dayDate}`;
                        if (weekData.specialDays && weekData.specialDays[dayDate]) {
                            dayButton.classList.add('disabled'); dayButton.disabled = true;
                            buttonText += `<br><span class="text-xs">${weekData.specialDays[dayDate].name}</span>`;
                        } else {
                            dayButton.onclick = () => toggleDateSelection(dayButton);
                        }
                        if (tempSelectedDates.includes(fullDate)) dayButton.classList.add('selected');
                        dayButton.innerHTML = buttonText;
                        weekGrid.appendChild(dayButton);
                    });
                    weekDiv.appendChild(weekGrid);
                    container.appendChild(weekDiv);
                });
                modal.style.display = 'flex';
            }

            window.toggleDateSelection = function(button) {
                const date = button.dataset.date;
                const isSelected = button.classList.contains('selected');
                const programKeyOnly = state.programKey;
                const sessions = fieldsData[programKeyOnly].stages[state.stage].sessions;
                if (isSelected) {
                    tempSelectedDates = tempSelectedDates.filter(d => d !== date);
                    button.classList.remove('selected');
                } else {
                    if (tempSelectedDates.length < sessions) {
                        tempSelectedDates.push(date);
                        button.classList.add('selected');
                    } else {
                        alert(`لا يمكن اختيار أكثر من ${sessions} حصص.`);
                    }
                }
            }

            window.closeDatePicker = function() { document.getElementById('date-picker-modal').style.display = 'none'; tempSelectedDates = []; }
            window.saveDates = function() { state.planDates = [...(tempSelectedDates || [])]; updateDatePickerButton(); saveState(); closeDatePicker(); }

            function generatePlan() {
                state = { ...state, objective: objectiveSelect.value, ...Object.fromEntries(['teacher-name', 'leader-name', 'director-name', 'education-admin', 'school-name', 'strengths', 'difficulties', 'remedial-actions'].map(id => [id.replace(/-(\w)/g, (m, p1) => p1.toUpperCase()), document.getElementById(id).value])), achievements: document.getElementById('additional-achievements').value };
                const programKeyOnly = state.programKey;
                const programData = fieldsData[programKeyOnly]?.stages[state.stage];
                if (!programData || !state.objective) { alert('يرجى التأكد من اختيار جميع الحقول المطلوبة.'); return; }
                if (programData.isPlaceholder){ alert('لا يمكن إنشاء خطة لهذا البرنامج حاليًا.'); return; }
                
                saveState(); 
                if(state.planDates && !state.planDates.includes('يحدد لاحقًا')) {
                    state.planDates.sort((a, b) => parseDateForSorting(a) - parseDateForSorting(b));
                }
                
                document.getElementById('report-education-admin-plan').textContent = state.educationAdmin;
                document.getElementById('report-school-name-plan').textContent = state.schoolName;
                document.getElementById('report-program-name-plan').value = fieldsData[programKeyOnly].name;
                document.getElementById('report-program-details-name-plan').value = programData.name;
                document.getElementById('report-objective-plan').value = state.objective;
                document.getElementById('report-program-target-plan').value = programData.target;
                document.getElementById('report-teacher-name-plan').value = state.teacherName;
                document.getElementById('report-duration-plan').value = programData.duration;
                document.getElementById('report-location-plan').value = programData.location;
                document.getElementById('report-tools-plan').value = programData.tools;
                document.getElementById('report-learning-outcomes-plan').value = programData.learningOutcomes;
                document.getElementById('report-assessment-methods-plan').value = programData.assessmentMethods;
                document.getElementById('report-leader-name-plan').textContent = state.leaderName;
                document.getElementById('report-director-name-plan').textContent = state.directorName;
                document.getElementById('report-additional-achievements-plan').value = state.achievements;
                document.getElementById('report-strengths-plan').value = state.strengths;
                document.getElementById('report-difficulties-plan').value = state.difficulties;
                document.getElementById('report-remedial-actions-plan').value = state.remedialActions;

                const tableBody = document.getElementById('plan-table-body');
                tableBody.innerHTML = '';

                // MODIFIED: Loop over selected dates instead of all program details
                state.planDates.forEach((date, index) => {
                    // Ensure we don't try to access a session that doesn't exist in the definition
                    if (index < programData.details.length) {
                        const session = programData.details[index];
                        let weekName = session.week || '';
                        
                        if (date !== 'يحدد لاحقًا') {
                             for (const key in activeWeeksData) { 
                                if (Object.values(activeWeeksData[key].days).includes(date.split(' ').slice(1).join(' '))) { 
                                    weekName = activeWeeksData[key].name; 
                                    break; 
                                }
                            }
                        }

                        tableBody.innerHTML += `<tr>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${weekName}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${date ? (date === 'يحدد لاحقًا' ? 'يحدد لاحقًا' : formatFullDate(date)) : 'لم يحدد'}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${session.title}</textarea></td>
                            <td><textarea class="w-full h-auto p-1 border-none resize-none" oninput="autoGrowTextarea(this)">${session.content}</textarea></td>
                            <td class="text-xs">
                                <div class="flex items-center p-1"><span class="inline-block w-4 h-4 border border-slate-400 mr-2 ml-1"></span> نفذ</div>
                                <div class="flex items-center p-1 mt-1"><span class="inline-block w-4 h-4 border border-slate-400 mr-2 ml-1"></span> لم ينفذ</div>
                            </td>
                        </tr>`;
                    }
                });

                document.getElementById('setup-screen-plan').classList.add('hidden');
                document.getElementById('output-plan').classList.remove('hidden');

                // Auto-resize all textareas after generation
                document.querySelectorAll('#output-plan textarea').forEach(textarea => autoGrowTextarea(textarea));
            }
            
            window.printContent = function(elementId) {
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('printable-active'));
                const elementToPrint = document.getElementById(elementId);
                if (elementToPrint && elementToPrint.parentElement.classList.contains('content-section')) {
                     elementToPrint.parentElement.classList.add('printable-active');
                }
                window.print();
            }

            function updateRegionUI() {
                const btnOther = document.getElementById('btn-region-other');
                const btnWestern = document.getElementById('btn-region-western');
                if (state.region === 'western') {
                    activeWeeksData = weeksDataWestern;
                    btnWestern.classList.add('bg-teal-600', 'text-white');
                    btnOther.classList.remove('bg-teal-600', 'text-white');
                } else {
                    activeWeeksData = weeksDataDefault;
                    btnOther.classList.add('bg-teal-600', 'text-white');
                    btnWestern.classList.remove('bg-teal-600', 'text-white');
                }
            }
            
            function initializeApp() {
                state = JSON.parse(localStorage.getItem('planGeneratorState')) || { region: 'other' };
                if (state.educationAdmin) document.getElementById('education-admin').value = state.educationAdmin;
                if (state.schoolName) document.getElementById('school-name').value = state.schoolName;
                if (state.teacherName) document.getElementById('teacher-name').value = state.teacherName;
                if (state.leaderName) document.getElementById('leader-name').value = state.leaderName;
                if (state.directorName) document.getElementById('director-name').value = state.directorName;
                if (state.achievements) document.getElementById('additional-achievements').value = state.achievements;
                if (state.strengths) document.getElementById('strengths').value = state.strengths;
                if (state.difficulties) document.getElementById('difficulties').value = state.difficulties;
                if (state.remedialActions) document.getElementById('remedial-actions').value = state.remedialActions;
                
                updateRegionUI();
                setupPlanTab();
                setupReportsTab();

                if(state.fontFamily) {
                    document.body.style.fontFamily = state.fontFamily;
                    fontSelect.value = state.fontFamily;
                } else {
                    fontSelect.value = 'Tajawal';
                }

                if(state.objective) {
                    setTimeout(() => { 
                        objectiveSelect.value = state.objective;
                    }, 100);
                }
            }
            
            initializeApp();
        });
    </script>
</body>
</html>
